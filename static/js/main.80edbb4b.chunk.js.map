{"version":3,"sources":["modules/display/model.ts","modules/display/constants.ts","modules/display/actionTypes.ts","shared/utils.ts","modules/display/selectors.ts","modules/display/actions.ts","modules/text/constants.ts","modules/text/components/NewNoteCardTooltip.tsx","modules/text/components/AddQAButtonTooltip.tsx","modules/text/components/DeleteCardButtonTooltip.tsx","modules/text/index.ts","modules/display/components/NavigationButtons.tsx","modules/display/components/PageChooser/PageChooser.tsx","modules/display/components/PDFDocument/PageKeyboardControl.tsx","modules/display/components/PDFDocument/HTMLElementMeasurer.tsx","modules/display/components/OriginMarkedSnackbar.tsx","modules/river/constants.ts","modules/river/model.ts","modules/cards/constants.ts","modules/cards/actionTypes.ts","modules/cards/model/permutation.ts","modules/cards/model/content.ts","modules/cards/model/config.ts","modules/cards/selectors.ts","modules/cards/actions.ts","modules/cards/model/payload.ts","modules/cards/components/AddNoteButton.tsx","modules/cards/components/AddQAButton.tsx","modules/cards/components/DeleteCardButton.tsx","modules/cards/model/origin.ts","modules/cards/model/state.ts","modules/db/constants.ts","modules/db/actionTypes.ts","modules/db/actions.ts","modules/db/model.ts","modules/db/reducer.ts","modules/db/selectors.ts","modules/db/index.ts","modules/cards/reducer.ts","modules/cards/index.ts","modules/river/selectors.ts","modules/river/actionTypes.ts","modules/river/actions.ts","shared/GreenCheckbox.tsx","modules/river/components/RiverContentFormGroup.tsx","modules/selection/constants.ts","modules/selection/actionTypes.ts","modules/selection/selectors.ts","modules/selection/services/use-selection.ts","modules/selection/model.ts","modules/selection/services/get-selection.ts","modules/selection/actions.ts","modules/selection/reducer.ts","modules/selection/components/SelectionSnackbar.tsx","modules/selection/components/MaterialMouseUp.tsx","modules/selection/components/CardMouseUp.tsx","modules/selection/components/AppendButton.tsx","modules/selection/components/ContextMenu.tsx","modules/selection/components/ReplaceButton.tsx","modules/selection/index.ts","modules/river/components/CardRiver/Cards/ClayCardField.tsx","modules/river/components/CardRiver/Cards/JumpToOriginButton.tsx","modules/river/components/CardRiver/Cards/ClayCardFieldButtons.tsx","modules/river/components/CardRiver/Cards/QACard.tsx","modules/river/components/CardRiver/Cards/NoteCard.tsx","modules/river/components/CardRiver/Cards/ClayCard.tsx","modules/river/components/CardRiver/ClayCardGridItems.tsx","modules/river/services/filterCardConfigs.tsx","modules/river/components/CardRiver/CardRiver.tsx","modules/river/components/SwitchActiveRiver.tsx","modules/river/reducer.ts","modules/river/index.ts","modules/display/components/PageSpanControl.tsx","modules/display/components/PDFDocument/PDFPage.tsx","modules/display/components/PDFDocument/RiverMaterialPair.tsx","modules/display/components/PDFDocument/PageScrollControl.tsx","modules/display/components/PDFDocument/RiverMaterialPairList.tsx","modules/display/components/PDFDocument/PDFDocument.tsx","modules/display/components/PDFDocument/cachePageDimensions.tsx","modules/display/components/RiverExplorer.tsx","modules/display/components/Display.tsx","modules/display/components/ViewTabs.tsx","modules/display/reducer.ts","modules/display/index.ts","modules/control/constants.ts","modules/control/selectors.ts","modules/control/actionTypes.ts","modules/control/actions.ts","modules/control/components/Options/DeleteDocumentButton.tsx","modules/control/components/Options/InputDataSets.tsx","modules/control/components/Options/InputDocument.tsx","modules/control/components/Options/LoadDocumentDataButton.tsx","modules/control/components/Options/DocumentOptionItem.tsx","modules/control/components/Options/Options.tsx","modules/control/components/ClayMemorySearchBar.tsx","modules/control/components/UndoRedoButtons.tsx","modules/control/components/ShowHideButton.tsx","modules/control/components/ControlBar.tsx","modules/control/model.ts","modules/control/reducer.ts","modules/control/index.ts","scene/ReaderScene.tsx","persist.ts","store.ts","index.tsx"],"names":["View","NAME","PDF_UPLOADED","MATERIAL_LOADED","DISPLAY_STATUS","PAGE_UPDATE","SPAN_ORIGIN","DOCUMENT_SEARCH","WINDOW_LAYOUT","TOP_OFFSET","VIEW_CHANGE","LOAD_EXISTING_DOCUMENT","keyMap","pageCorrections","newPage","totalPages","getAll","state","getPDF","createSelector","pdf","getWindowMeasurements","windowMeasurements","getPDFName","pdfName","getTotalPages","getCurrentPage","currentPage","getScrollToPage","scrollToPage","getPageControlData","getDisplayStatus","displayStatus","displayStatusIsShow","status","getSpanOrigin","spanOrigin","getDocumentSearch","documentSearch","getTopOffset","topOffset","getCurrentView","currentView","incrementer","counter","curCounter","widthPixels","type","t","payload","pdfUpload","materialLoaded","setPage","page","shouldScroll","movePage","dispatch","getState","nextPage","previousPage","pageControlKeyMap","ArrowLeft","ArrowRight","pageControlDispatcher","event","action","key","preventDefault","toggleDisplayState","displayState","setSpanOrigin","origin","resetSpanOrigin","setDocumentSearch","search","resetDocumentSearch","setTopOffset","offset","setView","view","loadExistingDocument","switchToActiveRiverTooltip","switchToSummaryRiverTooltip","undoTooltip","redoTooltip","nextPageTooltip","previousPageTooltip","deleteCardTooltip","jumpToOriginTooltip","ChoiceCardAsAppendGoal","AppendToCardTooltip","CardIsAppendGoalTooltip","ChoiceCardAsReplaceGoal","ReplaceCardTooltip","CardIsReplaceGoalTooltip","newQACardTooltip","newNoteCardTooltip","deleteDocumentTooltip","loadSavedDocumentTooltip","noMaterialText","loadingMaterialText","activeDocumentText","existingDataText","loadMaterialText","downloadDatasetsText","uploadDatasetsText","noteText","questionText","answerText","defaultEnterDelay","defaultEnterNextDelay","NewNoteCardTooltip","children","Tooltip","title","enterDelay","enterNextDelay","AddQAButtonTooltip","DeleteCardButtonTooltip","components","constants","PreviousButton","useDispatch","text","IconButton","onClick","NextButton","PageNavigation","Card","variant","Grid","container","direction","item","Divider","orientation","nonDigitRegEx","PageNumberTextField","useSelector","useState","error","value","toString","userInput","setState","TextField","inputProps","style","padding","fontSize","fontFamily","fontWeight","lineHeight","letterSpacing","onKeyDown","submittedValue","target","parseInt","onChange","possiblePage","trim","match","asInt","validatePageChoice","TotalPagesIndicator","Typography","PageChooser","alignItems","justify","width","PageKeyboardControl","ref","useRef","tabIndex","HTMLElementMeasurer","measure","debounce","htmlElement","document","documentElement","currentWidth","clientWidth","currentHeight","clientHeight","height","useLayoutEffect","useEffect","window","addEventListener","removeEventListener","OriginMarkedSnackbar","open","setOpen","handleDismiss","escPress","Snackbar","anchorOrigin","vertical","horizontal","onClose","reason","message","Button","color","size","pageNumberToRiverMakeUpID","riverMakeUpIDToPageNumber","riverID","replace","emptyCardRiver","cardIDs","updateStateWithMakeUps","updatedState","makeUps","forEach","makeUp","riverMakeUps","removeCardFromRivers","cardID","Object","fromEntries","entries","map","entry","filter","id","length","CARD_REPLACE","CARD_PUSH","CARD_REMOVE","CARDS_REPLACE","CARDS_RESET","FieldValueAccessorMap","note","cardObject","q","a","toFieldValue","field","FieldValueModifierMap","modify","createReplace","inputValue","_","changeCardObject","spec","inputField","inputObject","createModify","modifyFieldValue","fieldToBeChanged","objectToBeChanged","emptyQAContent","EmptyContentMap","emptyContent","noteContentIsEmpty","content","qaContentIsNotFull","UpdateTypeCreateModifyMap","APPEND","oldValue","REPLACE","updateTypeToCreateModify","updateType","strToCardContent","contentStr","outputField","existingContent","changeSpec","strToNewCardContent","empty","noteContentContainsStringOrEmpty","noteConfig","str","includes","qaContentContainsStringOrEmpty","qaConfig","cardIDToNumber","nextCardID","lastCardIDNumber","CardIsFullMap","Note","config","cardIsNotFull","strToCardConfig","baseCard","changedContent","CardFieldToTypeMap","cardFieldToType","present","getLastCardIDNumber","getCards","cards","getCardByID","cardPush","cardPayload","emptyNoteCard","emptyQACard","cardReplace","card","replaceCardFieldContent","cardField","cardConfig","newValue","removeCard","resetCards","createAction","replaceCards","cardsState","AddNoteButton","AddQAButton","DeleteCardButton","emptyQAOrigin","EmptyOriginMap","emptyOrigin","singleOriginToCardOrigin","singleOrigin","baseOrigin","removeCardFromCardsState","updateCardInCards","toBeUpdated","cardObj","ARCHIVE_CURRENT_DATA","LOAD_DOCUMENT_DATA_SETS","DELETE_DOCUMENT_DATA_SET","archiveDBData","dbData","loadDocumentDataSets","newActiveDataSet","deleteDocumentDataSet","updateDocumentDataInDocumentDB","documentData","name","updateDocumentDataSetsInDocumentDB","documentDataSets","reduce","prev","removeDocumentDataFromDocumentDB","arr","initialState","documentDB","getDocumentNames","db","keys","getDocumentDataSets","values","actions","actionTypes","reducer","selectors","intialState","model","getRiverMakeUps","getNonEmptyRiverIDs","getNonEmptyRiverIDsSorted","ids","sort","b","getNonEmptyRiverMakeUpsSorted","getNonEmptyRiverCardsSorted","cardObjects","push","getActiveRiverMakeUpID","activeRiverMakeUpID","getActiveRiverMakeUp","getActiveRiverCardIDs","getActiveRiverCards","makeUpCardIDs","getRiverShowState","riverShowState","riverShowStateIsShow","getRiverContentState","riverContentState","getRiverContentFilter","contentFilter","getOriginRequest","requestedOrigin","RIVER_ACTIVE_ID","RIVER_SHOW_STATE","RIVER_CONTENT_STATE","RIVER_CONTENT_FILTER","ORIGIN_REQUEST","RIVER_RESET","RIVER_REPLACE","toggleRiverShowState","setRiverContentState","setActiveRiver","trySetActiveRiver","setContentFilter","resetContentFilter","setOriginRequest","resetOriginRequest","resetRivers","replaceRivers","GreenCheckbox","withStyles","root","green","checked","props","Checkbox","RiverContentFormGroup","showQAs","showNotes","changeContentState","clickedState","FormGroup","FormControlLabel","control","label","SELECTION_SOURCE","SELECTION_GOAL","getGoalConfig","goalConfig","getSourceConfig","sourceConfig","sourceConfigExists","selectionToCard","goalIsCreation","inputOrigin","contentOrigin","undefined","selectionConfigToCardPayload","existingCard","selectionConfigToActualizedCardConfig","getSelectionWorkaround","selection","getSelection","activeElement","substring","selectionStart","selectionEnd","selStr","e","getSelectionSourceFromMaterial","selectionData","selectedParentStart","anchorNode","parentNode","selectedParentEnd","focusNode","nodeName","divTextLayerParent","spanChildren","Array","from","childNodes","startIndex","indexOf","endIndex","spanIndexStart","spanIndexEnd","materialSelectionDataToSourceConfig","resetSelectionSource","resetSelectionGoal","addSelectionSource","setSelectionSource","addMaterialSelectionSource","addCardSelectionSource","getSelectionSourceFromCard","addSelectionGoal","setSelectionGoal","addCardAppendSelectionGoal","addCardReplaceSelectionGoal","SelectionSnackbar","maxWidth","overflowX","spacing","backgroundColor","square","aria-label","MaterialMouseUp","onMouseUp","materialSelectionSourceAction","onMouseDown","button","CardFieldMouseUp","fieldOrigin","cardSelectionSourceAction","AppendButton","outlined","setOutlined","isGoal","ContextMenu","menuPosition","setMenuPosition","shouldClose","useCallback","current","querySelector","contains","contextMenuContainsTargetNode","doesSourceConfigExists","shouldOpen","left","x","top","y","openState","Menu","keepMounted","anchorReference","anchorPosition","MenuItem","ReplaceButton","services","ClayCardField","storeValue","saveChanges","rest","mutableValue","InputProps","disableUnderline","minWidth","multiline","onBlur","JumpToOriginButton","cardOrigin","ClayCardFieldButtons","permutation","originExists","Paper","QACard","elevation","InputLabelProps","NoteCard","ClayCard","GridItemDivider","qaFilter","noteFilter","filterCardConfigs","inputCards","contentFilterStr","filters","f","combineFilterArr","CardRiver","materialHeight","cardConfigs","riverMakeUp","console","log","riverCards","gridItems","increment","currentCard","index","ClayCardGridItems","Accordion","expanded","defaultExpanded","overflow","AccordionSummary","align","MozUserSelect","WebkitUserSelect","msUserSelect","AccordionDetails","SwitchActiveRiver","onMouseEnter","PageSpanControl","pageRef","count","trier","intervalID","setInterval","clearInterval","textLayer","originSpan","scrollIntoView","behavior","block","inline","makeOriginHighlighter","textItem","itemIndex","highlightOrigin","backgroundStyle","makeTextRenderer","searchText","pattern","textLength","patternLength","markedPattern","slice1","slice","result","secondIndex","slice2Start","slice2","thirdIndex","slice3Start","slice3","stringRest","splitText","split","spliter","highlightPattern","PDFPage","pageNumber","materialWidth","originHighlighter","textRenderer","searchRenderer","originRenderer","combineRenderers","inputRef","instance","MaterialMultiplier","customTextRenderer","renderAnnotationLayer","RiverPairItem","RiverMultiplier","river","RiverMaterialPair","data","materialHeights","showRiver","showMaterial","hidden","get","marginTop","pairTopBottomPadding","PageScrollControl","listRef","scrollToItem","RiverMaterial","Resetter","resetAfterIndex","RiverMaterialPairList","pdfProxyRef","cachedPageDimensions","set","windowWidth","pageDims","pixelPerUserSpaceUnit","calculateMaterialHeight","Map","itemCount","numPages","itemSize","itemData","onItemsRendered","visibleStopIndex","pdfjs","GlobalWorkerOptions","workerSrc","version","options","cMapUrl","cMapPacked","PDFDocument","setPageDimensions","pdfNameRef","loading","noData","file","renderMode","onLoadSuccess","pdfProxy","promises","i","getPage","Promise","all","then","pages","pageDimensions","w","h","_pageIndex","cachePageDimensions","onItemClick","ExplorerRiver","marginBottom","RiverExplorer","riverIDs","xs","Display","ViewTabs","Tabs","Tab","collectCurrentDBData","display","getLastUndoableActionComb","getLastRedoableActionComb","future","REDO_ACTION_HISTORY","UNDO_ACTION_HISTORY","REMOVE_ACTION_HISTORY","archiveCurrentDBData","fileDownload","require","downloadDBData","localString","Date","toLocaleString","JSON","stringify","undoActionHistory","redoActionHistory","removeActionHistory","ActionCreators","clearHistory","resetActiveAppState","replaceActiveAppState","newDocumentData","currentPDFName","loadPDF","newPDFName","loadSavedDocument","deleteDocument","activeDocument","DeleteDocumentDialogAlert","handleClose","Dialog","aria-labelledby","aria-describedby","DialogTitle","DialogContent","DialogContentText","DialogActions","autoFocus","DeleteDocumentButton","InputDataSets","click","disableElevation","startIcon","files","reader","FileReader","readAsText","onload","uploadedDataSets","parse","foundDataSet","find","accept","InputDocument","LoadDocumentDataButton","DocumentOptionItemButtonRow","DocumentOptionItem","ActiveDocumentOptionItem","Options","documents","doc","React","anchorEl","setAnchorEl","currentTarget","Boolean","MenuListProps","paddingLeft","paddingRight","component","listStyleType","ClayMemorySearchBar","contentString","searchFocus","onCancelSearchCards","onCancelSearchDocument","onCancelSearch","onRequestSearch","placeholder","cancelOnEscape","UndoButton","lastUndoableActionComb","actionStr","disabled","RedoButton","lastRedoableActionComb","UndoRedoCard","ShowRiverCheckbox","ShowMaterialCheckbox","displayShowState","ShowHideButton","ControlBar","materialName","currentBottom","getBoundingClientRect","bottom","AppBar","position","Toolbar","disableGutters","selectionActions","riverActions","cardActions","dbActions","undoableActions","flat","undoRedoActionShield","actionList","undo","redo","selectionShield","cardsShield","riverShield","dbShield","past","concat","ReaderScene","displayTransform","createTransform","inboundState","documentRef","materialData","removeDOMObjectsFromDisplayData","outboundState","addDOMObjectsToDisplayData","whitelist","removeContentFilter","riverTransform","persistConfig","storage","transforms","rootReducer","combineReducers","undoable","includeAction","limit","persistedReducer","persistReducer","enhancer","composeWithDevTools","stateSanitizer","displayData","composeEnhancers","applyMiddleware","thunk","store","createStore","persistor","persistStore","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.80edbb4b.chunk.js","sourcesContent":["import { SingleOrigin } from \"../cards/model/origin\";\n\nexport type DisplayStatus = \"SHOW\" | \"HIDE\";\n\nexport enum View {\n\tRiverMaterial,\n\tRiverExplorer,\n\tCardExplorer,\n}\n\nexport type DisplayData = {\n\tpdf?: File;\n\tpdfName?: string;\n\tdisplayStatus: DisplayStatus;\n\tcurrentPage: number;\n\tscrollToPage: number | null;\n\ttotalPages: number;\n\tspanOrigin: SingleOrigin | null;\n\twindowMeasurements: { width: number; height: number } | null;\n\ttopOffset: number;\n\tdocumentSearch: string | \"\";\n\tcurrentView: View;\n};\n\nexport type PageMove = \"PREVIOUS\" | \"NEXT\";\n\nexport const pageCorrections = {\n\tADD: (newPage: number, totalPages: number) => (newPage === totalPages + 1 ? 1 : newPage),\n\tREMOVE: (newPage: number, totalPages: number) => (newPage === 0 ? totalPages : newPage),\n};\n","export const NAME = \"displayData\";\n","import { NAME } from \"./constants\";\n\nexport const PDF_UPLOADED = NAME + \"/PDF_UPLOADED\";\nexport const MATERIAL_LOADED = NAME + \"/MATERIAL_LOADED\";\n\nexport const DISPLAY_STATUS = NAME + \"/DISPLAY_STATUS\";\n\nexport const PAGE_UPDATE = NAME + \"/PAGE_UPDATE\";\nexport const SPAN_ORIGIN = NAME + \"/SPAN_ORIGIN\";\nexport const DOCUMENT_SEARCH = NAME + \"/DOCUMENT_SEARCH\";\n\nexport const WINDOW_LAYOUT = NAME + \"/WINDOW_LAYOUT\";\nexport const TOP_OFFSET = NAME + \"/TOP_OFFSET\";\n\nexport const VIEW_CHANGE = NAME + \"/VIEW_CHANGE\";\n\nexport const LOAD_EXISTING_DOCUMENT = NAME + \"/LOAD_EXISTING_DOCUMENT\";\n","import { KeyboardEvent } from \"react\";\n\nexport const incrementer = () => {\n\tlet counter = 0;\n\treturn () => {\n\t\tconst curCounter = counter;\n\t\tcounter++;\n\t\treturn curCounter;\n\t};\n};\n\nexport type KeyActionMap = { [key: string]: any };\n\ntype KeyEventDispatcher = (event: KeyboardEvent<Element>, dispatch: any, state?: any) => void;\n\nexport const keyEventDispatcherCreator = (keyMap: KeyActionMap): KeyEventDispatcher => (\n\tevent: KeyboardEvent,\n\tdispatch: any\n) => {\n\tconst action = keyMap[event.key];\n\tif (action) {\n\t\tevent.preventDefault();\n\t\tdispatch(action);\n\t}\n};\n\nexport type ClayMemoryAction = { type: string };\nexport type ClayMemoryPayloadAction = { type: string; payload: any };\n\nexport type Filter = (element: any) => boolean;\nexport const combineFilterArr = (filters: Filter[]) => (x: any) => filters.reduce((b, f) => b || f(x), false);\n","import { createSelector } from \"reselect\";\nimport { DisplayData } from \"./model\";\nimport { NAME } from \"./constants\";\n\nexport const getAll = (state: any): DisplayData => state[NAME];\n\nexport const getPDF = createSelector(getAll, (state: DisplayData) => state.pdf);\n\nexport const getWindowMeasurements = createSelector(getAll, (state) => state.windowMeasurements);\n\nexport const getPDFName = createSelector(getAll, (state) => state.pdfName);\n\nexport const getTotalPages = createSelector(getAll, (state: DisplayData) => state.totalPages);\n\nexport const getCurrentPage = createSelector(getAll, (state: DisplayData) => state.currentPage);\n\nexport const getScrollToPage = createSelector(getAll, (state) => state.scrollToPage);\n\nexport const getPageControlData = createSelector(getTotalPages, getCurrentPage, (totalPages, currentPage) => {\n\treturn { currentPage, totalPages };\n});\n\nexport const getDisplayStatus = createSelector(getAll, (state: DisplayData) => state.displayStatus);\n\nexport const displayStatusIsShow = createSelector(getDisplayStatus, (status) => status === \"SHOW\");\n\nexport const getSpanOrigin = createSelector(getAll, (state) => state.spanOrigin);\n\nexport const getDocumentSearch = createSelector(getAll, (state) => state.documentSearch);\n\nexport const getTopOffset = createSelector(getAll, (state) => state.topOffset);\n\nexport const getCurrentView = createSelector(getAll, (state) => state.currentView);\n","import { Dispatch } from \"redux\";\nimport * as t from \"./actionTypes\";\nimport { PageMove, pageCorrections, View, DisplayData } from \"./model\";\nimport { getPageControlData, getDisplayStatus } from \"./selectors\";\nimport { keyEventDispatcherCreator, KeyActionMap, ClayMemoryPayloadAction } from \"../../shared/utils\";\nimport { SingleOrigin } from \"../cards/model/origin\";\n\nexport const widthPixels = (windowMeasurements: { width: number; height: number }): ClayMemoryPayloadAction => {\n\treturn { type: t.WINDOW_LAYOUT, payload: windowMeasurements };\n};\n\nexport const pdfUpload = (pdf: File): ClayMemoryPayloadAction => {\n\treturn { type: t.PDF_UPLOADED, payload: pdf };\n};\n\nexport const materialLoaded = (totalPages: number): ClayMemoryPayloadAction => {\n\treturn { type: t.MATERIAL_LOADED, payload: totalPages };\n};\n\nexport const setPage = (page: number, shouldScroll: boolean): ClayMemoryPayloadAction => {\n\treturn { type: t.PAGE_UPDATE, payload: { page, shouldScroll } };\n};\n\nexport const movePage = (type: PageMove) => {\n\treturn (dispatch: Dispatch, getState: Function) => {\n\t\tconst { currentPage, totalPages } = getPageControlData(getState());\n\t\tswitch (type) {\n\t\t\tcase \"NEXT\":\n\t\t\t\tdispatch(setPage(pageCorrections[\"ADD\"](currentPage + 1, totalPages), true));\n\t\t\t\tbreak;\n\t\t\tcase \"PREVIOUS\":\n\t\t\t\tdispatch(setPage(pageCorrections[\"REMOVE\"](currentPage - 1, totalPages), true));\n\t\t\t\tbreak;\n\t\t}\n\t};\n};\nexport const nextPage = () => movePage(\"NEXT\");\nexport const previousPage = () => movePage(\"PREVIOUS\");\nconst pageControlKeyMap: KeyActionMap = {\n\tArrowLeft: previousPage(),\n\tArrowRight: nextPage(),\n};\nexport const pageControlDispatcher = keyEventDispatcherCreator(pageControlKeyMap);\n\nexport const toggleDisplayState = () => {\n\treturn (dispatch: Dispatch, getState: Function) => {\n\t\tconst displayState = getDisplayStatus(getState()) === \"SHOW\" ? \"HIDE\" : \"SHOW\";\n\n\t\tdispatch({ type: t.DISPLAY_STATUS, payload: displayState } as ClayMemoryPayloadAction);\n\t};\n};\n\nexport const setSpanOrigin = (origin: SingleOrigin | null): ClayMemoryPayloadAction => {\n\treturn { type: t.SPAN_ORIGIN, payload: origin };\n};\n\nexport const resetSpanOrigin = () => {\n\treturn setSpanOrigin(null);\n};\n\nexport const setDocumentSearch = (search: string | null): ClayMemoryPayloadAction => {\n\treturn { type: t.DOCUMENT_SEARCH, payload: search };\n};\n\nexport const resetDocumentSearch = () => {\n\treturn setDocumentSearch(\"\");\n};\n\nexport const setTopOffset = (offset: number): ClayMemoryPayloadAction => {\n\treturn { type: t.TOP_OFFSET, payload: offset };\n};\n\nexport const setView = (view: View): ClayMemoryPayloadAction => {\n\treturn { type: t.VIEW_CHANGE, payload: view };\n};\n\nexport type ExistingDocumentPayload = Pick<DisplayData, \"pdfName\" | \"currentPage\" | \"totalPages\">;\n\nexport const loadExistingDocument = (payload: ExistingDocumentPayload) => {\n\treturn { type: t.LOAD_EXISTING_DOCUMENT, payload };\n};\n","/// Tooltip-Text\n\nexport const switchToActiveRiverTooltip = \"Switch to the Active-River view\";\nexport const switchToSummaryRiverTooltip = \"Switch to the Summary-River view\";\n\nexport const undoTooltip = \"Undo last action\";\nexport const redoTooltip = \"Redo last action\";\n\nexport const nextPageTooltip = \"Next page\";\nexport const previousPageTooltip = \"Previous page\";\n\nexport const deleteCardTooltip = \"Delete this card\";\nexport const jumpToOriginTooltip = \"Jump to the origin of the card content\";\n\nexport const ChoiceCardAsAppendGoal = \"Mark this card field as the goal of the next selection\";\nexport const AppendToCardTooltip = \"Add the current selection to this card field\";\nexport const CardIsAppendGoalTooltip = \"The next selection will be added to this card field (click to unselect)\";\n\nexport const ChoiceCardAsReplaceGoal = \"Mark this card field to be replaced by the next selection\";\nexport const ReplaceCardTooltip = \"Replace this card field with the current selection\";\nexport const CardIsReplaceGoalTooltip = \"The next selection will replace this card field (click to unselect)\";\n\nexport const newQACardTooltip = \"Create new QA-card\";\nexport const newNoteCardTooltip = \"Create new Note-card\";\n\nexport const deleteDocumentTooltip = \"Delete this document and all its corresponding cards\";\nexport const loadSavedDocumentTooltip = \"Load the card data of this document\";\n\n/// Text\n\nexport const noMaterialText = \"No PDF file specified.\";\nexport const loadingMaterialText = \"Loading PDF\";\n\nexport const activeDocumentText = \"Active Document:\";\nexport const existingDataText = \"Inactive documents with existing data:\";\nexport const loadMaterialText = \"Load document\";\nexport const downloadDatasetsText = \"Download document datasets\";\nexport const uploadDatasetsText = \"Upload document datasets\";\n\nexport const noteText = \"Note\";\nexport const questionText = \"Question\";\nexport const answerText = \"Answer\";\n\n/// Delay\n\nexport const defaultEnterDelay = 500;\nexport const defaultEnterNextDelay = 1000;\n","import React, { ReactElement } from \"react\";\nimport { Tooltip } from \"@material-ui/core\";\nimport { newNoteCardTooltip, defaultEnterDelay, defaultEnterNextDelay } from \"../constants\";\n\nexport const NewNoteCardTooltip = ({ children }: { children: ReactElement }) => {\n\treturn (\n\t\t<Tooltip title={newNoteCardTooltip} enterDelay={defaultEnterDelay} enterNextDelay={defaultEnterNextDelay}>\n\t\t\t{children}\n\t\t</Tooltip>\n\t);\n};\n","import React, { ReactElement } from \"react\";\nimport { Tooltip } from \"@material-ui/core\";\nimport { defaultEnterDelay, defaultEnterNextDelay, newQACardTooltip } from \"../constants\";\n\nexport const AddQAButtonTooltip = ({ children }: { children: ReactElement }) => {\n\treturn (\n\t\t<Tooltip title={newQACardTooltip} enterDelay={defaultEnterDelay} enterNextDelay={defaultEnterNextDelay}>\n\t\t\t{children}\n\t\t</Tooltip>\n\t);\n};\n","import React, { ReactElement } from \"react\";\nimport { Tooltip } from \"@material-ui/core\";\nimport { defaultEnterDelay, defaultEnterNextDelay, deleteCardTooltip } from \"../constants\";\n\nexport const DeleteCardButtonTooltip = ({ children }: { children: ReactElement }) => {\n\treturn (\n\t\t<Tooltip title={deleteCardTooltip} enterDelay={defaultEnterDelay} enterNextDelay={defaultEnterNextDelay}>\n\t\t\t{children}\n\t\t</Tooltip>\n\t);\n};\n","import * as components from \"./components\";\nimport * as constants from \"./constants\";\n\nexport default { components, constants };\n","import React from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { IconButton, Card, Grid, Divider, Tooltip } from \"@material-ui/core\";\nimport ArrowForwardIosIcon from \"@material-ui/icons/ArrowForwardIos\";\nimport ArrowBackIosIcon from \"@material-ui/icons/ArrowBackIos\";\nimport { nextPage, previousPage } from \"../actions\";\nimport text from \"../../text\";\n\nconst PreviousButton = () => {\n\tconst dispatch = useDispatch();\n\treturn (\n\t\t<Tooltip\n\t\t\ttitle={text.constants.previousPageTooltip}\n\t\t\tenterDelay={text.constants.defaultEnterDelay}\n\t\t\tenterNextDelay={text.constants.defaultEnterNextDelay}\n\t\t>\n\t\t\t<IconButton\n\t\t\t\ttype=\"button\"\n\t\t\t\tonClick={() => {\n\t\t\t\t\tdispatch(previousPage());\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<ArrowBackIosIcon></ArrowBackIosIcon>\n\t\t\t</IconButton>\n\t\t</Tooltip>\n\t);\n};\n\nconst NextButton = () => {\n\tconst dispatch = useDispatch();\n\treturn (\n\t\t<Tooltip\n\t\t\ttitle={text.constants.nextPageTooltip}\n\t\t\tenterDelay={text.constants.defaultEnterDelay}\n\t\t\tenterNextDelay={text.constants.defaultEnterNextDelay}\n\t\t>\n\t\t\t<IconButton\n\t\t\t\ttype=\"button\"\n\t\t\t\tonClick={() => {\n\t\t\t\t\tdispatch(nextPage());\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<ArrowForwardIosIcon></ArrowForwardIosIcon>\n\t\t\t</IconButton>\n\t\t</Tooltip>\n\t);\n};\n\nexport const PageNavigation = () => {\n\treturn (\n\t\t<Card variant=\"outlined\">\n\t\t\t<Grid container direction=\"row\">\n\t\t\t\t<Grid item>\n\t\t\t\t\t<PreviousButton></PreviousButton>\n\t\t\t\t</Grid>\n\t\t\t\t<Grid item>\n\t\t\t\t\t<Divider orientation=\"vertical\"></Divider>\n\t\t\t\t</Grid>\n\t\t\t\t<Grid item>\n\t\t\t\t\t<NextButton></NextButton>\n\t\t\t\t</Grid>\n\t\t\t</Grid>\n\t\t</Card>\n\t);\n};\n","import React, { useState } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { Typography, TextField, Card, Grid } from \"@material-ui/core\";\nimport { setPage } from \"../../actions\";\nimport { getCurrentPage, getTotalPages } from \"../../selectors\";\n\nconst nonDigitRegEx = /(\\D)/;\n\nexport const validatePageChoice = (possiblePage: string, totalPages: number) => {\n\tif (possiblePage === \"\" || possiblePage.trim().match(nonDigitRegEx) !== null) return false;\n\n\tconst asInt = parseInt(possiblePage);\n\tif (asInt < 1 || totalPages < asInt) return false;\n\n\treturn true;\n};\n\nconst PageNumberTextField = ({ totalPages }: { totalPages: number }) => {\n\tconst dispatch = useDispatch();\n\tconst currentPage = useSelector(getCurrentPage);\n\n\tconst [state, setState] = useState({\n\t\terror: false,\n\t\tvalue: currentPage?.toString(),\n\t\tuserInput: currentPage?.toString(),\n\t});\n\n\t// with this we can trigger a re-render onChange,\n\t// while making sure that if a new currentPage arrives, we reset the component\n\tif (state.value !== currentPage.toString()) {\n\t\tsetState({ error: false, value: currentPage.toString(), userInput: currentPage.toString() });\n\t}\n\n\treturn (\n\t\t<TextField\n\t\t\tinputProps={{\n\t\t\t\tstyle: {\n\t\t\t\t\tpadding: \"0px\",\n\t\t\t\t\t//h6 Typography style\n\t\t\t\t\tfontSize: \"1.25rem\",\n\t\t\t\t\tfontFamily: '\"Roboto\", \"Helvetica\", \"Arial\", sansSerif',\n\t\t\t\t\tfontWeight: 500,\n\t\t\t\t\tlineHeight: 1.6,\n\t\t\t\t\tletterSpacing: \"0.0075em\",\n\t\t\t\t},\n\t\t\t}}\n\t\t\ttype=\"text\"\n\t\t\tvariant=\"filled\"\n\t\t\tvalue={state.userInput}\n\t\t\tonKeyDown={(event) => {\n\t\t\t\tif (event.key === \"Enter\") {\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tconst submittedValue = (event.target as HTMLFormElement).value;\n\t\t\t\t\tif (!state.error) {\n\t\t\t\t\t\tdispatch(setPage(parseInt(submittedValue), true));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}}\n\t\t\tonChange={(event) => {\n\t\t\t\tconst submittedValue = (event.target as HTMLTextAreaElement).value;\n\t\t\t\tif (validatePageChoice(submittedValue, totalPages as number)) {\n\t\t\t\t\tsetState({ ...state, error: false, userInput: submittedValue });\n\t\t\t\t} else {\n\t\t\t\t\tsetState({ ...state, error: true, userInput: submittedValue });\n\t\t\t\t}\n\t\t\t}}\n\t\t\terror={state.error}\n\t\t/>\n\t);\n};\n\nconst TotalPagesIndicator = ({ totalPages }: { totalPages: number }) => (\n\t<Typography variant=\"h6\">of {totalPages}</Typography>\n);\n\nexport const PageChooser = () => {\n\tconst totalPages = useSelector(getTotalPages);\n\n\treturn (\n\t\t<Card variant=\"outlined\">\n\t\t\t<Grid item>\n\t\t\t\t<Grid container direction=\"row\" alignItems=\"center\" justify=\"space-between\">\n\t\t\t\t\t<Grid item style={{ width: \"37%\" }}>\n\t\t\t\t\t\t<PageNumberTextField totalPages={totalPages}></PageNumberTextField>\n\t\t\t\t\t</Grid>\n\n\t\t\t\t\t<Grid item style={{ width: \"61%\" }}>\n\t\t\t\t\t\t<TotalPagesIndicator totalPages={totalPages}></TotalPagesIndicator>\n\t\t\t\t\t</Grid>\n\t\t\t\t</Grid>\n\t\t\t</Grid>\n\t\t</Card>\n\t);\n};\n","import { ReactNode, KeyboardEvent, useRef, MutableRefObject } from \"react\";\nimport { pageControlDispatcher } from \"../../actions\";\nimport React from \"react\";\nimport { useDispatch } from \"react-redux\";\n\n// note to self: prefer to expose components and not implementation details (actions etc.)\n\nexport const PageKeyboardControl = ({ children }: { children: ReactNode }) => {\n\tconst dispatch = useDispatch();\n\tconst ref: MutableRefObject<null | HTMLInputElement> = useRef(null);\n\n\treturn (\n\t\t<span\n\t\t\tref={ref}\n\t\t\tonKeyDown={(event: KeyboardEvent<HTMLSpanElement>) => {\n\t\t\t\tpageControlDispatcher(event, dispatch);\n\t\t\t}}\n\t\t\ttabIndex={0}\n\t\t>\n\t\t\t{children}\n\t\t</span>\n\t);\n};\n","import { useEffect, useLayoutEffect } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { widthPixels } from \"../../actions\";\nimport { debounce } from \"throttle-debounce\";\n\nexport const HTMLElementMeasurer = () => {\n\tconst dispatch = useDispatch();\n\n\tconst measure = debounce(50, () => {\n\t\tconst htmlElement = document.documentElement;\n\t\tconst currentWidth = htmlElement.clientWidth;\n\t\tconst currentHeight = htmlElement.clientHeight;\n\t\tdispatch(widthPixels({ width: currentWidth, height: currentHeight }));\n\t});\n\n\tuseLayoutEffect(() => {\n\t\t//first measurement\n\t\tmeasure();\n\t}, [measure]);\n\n\tuseEffect(() => {\n\t\twindow.addEventListener(\"resize\", measure);\n\t\treturn () => {\n\t\t\twindow.removeEventListener(\"resize\", measure);\n\t\t};\n\t});\n\n\treturn null;\n};\n","import { Button, Snackbar } from \"@material-ui/core\";\nimport React, { useEffect, useState } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { getSpanOrigin } from \"../selectors\";\nimport { resetSpanOrigin } from \"../actions\";\n\n//TODO: think about that SelectionSnackbar and this both are dismissed via Esc\n\nexport const OriginMarkedSnackbar = () => {\n\tconst [open, setOpen] = useState(false);\n\tconst spanOrigin = useSelector(getSpanOrigin);\n\tconst dispatch = useDispatch();\n\n\tif (!!!spanOrigin && open) setOpen(false);\n\n\tif (!!spanOrigin && !open) setOpen(true);\n\n\tconst handleClose = (event: any, reason: string) => {\n\t\tif (reason === \"clickaway\") {\n\t\t\t// do not close on clickaway\n\t\t\tevent.preventDefault();\n\t\t} else {\n\t\t\tsetOpen(false);\n\t\t\tdispatch(resetSpanOrigin());\n\t\t}\n\t};\n\n\tconst handleDismiss = () => {\n\t\tsetOpen(false);\n\t\tdispatch(resetSpanOrigin());\n\t};\n\n\tconst escPress = (event: KeyboardEvent) => {\n\t\tif (open && (event.key === \"Escape\" || event.key === \"Esc\")) {\n\t\t\thandleDismiss();\n\t\t}\n\t};\n\n\tuseEffect(() => {\n\t\tdocument.addEventListener(\"keydown\", escPress);\n\t\treturn () => {\n\t\t\tdocument.removeEventListener(\"keydown\", escPress);\n\t\t};\n\t});\n\n\treturn (\n\t\t<Snackbar\n\t\t\tanchorOrigin={{\n\t\t\t\tvertical: \"bottom\",\n\t\t\t\thorizontal: \"left\",\n\t\t\t}}\n\t\t\topen={open}\n\t\t\tonClose={handleClose}\n\t\t\tmessage=\"Origin is marked\"\n\t\t\taction={\n\t\t\t\t<Button color=\"secondary\" size=\"small\" onClick={handleDismiss}>\n\t\t\t\t\tUNMARK\n\t\t\t\t</Button>\n\t\t\t}\n\t\t/>\n\t);\n};\n","export const NAME = \"cardRiverState\";\n","import { CardID } from \"../cards/model/config\";\nimport { SingleOrigin } from \"../cards/model/origin\";\n\nexport type RiverMakeUp = { riverID: string; cardIDs: CardID[] };\n\nexport type RiverMakeUps = { [riverID: string]: RiverMakeUp };\n\nexport type RiverShowState = \"SHOW\" | \"HIDE\";\n\nexport type RiverContentState = \"ALL\" | \"NOTES\" | \"QAS\" | \"NONE\";\n\nexport type ContentFilter = string;\n\nexport type CardRiverState = {\n\t// works by first setting it here via button\n\t// then we scroll to the page\n\t// then we set the origin in the display-store\n\t// then we scroll to origin\n\t// all happens in the display module\n\t// move this somehow to display?\n\t// problem is that we depend on the display components (list-ref)\n\t// for scrolling\n\trequestedOrigin: SingleOrigin | null;\n\triverMakeUps: RiverMakeUps;\n\tactiveRiverMakeUpID: string;\n\t// show/hide river\n\triverShowState: RiverShowState;\n\t// filter content\n\triverContentState: RiverContentState;\n\tcontentFilter: ContentFilter | \"\";\n};\n\nexport const pageNumberToRiverMakeUpID = (page: number) => \"CardRiver \" + page;\n\nexport const riverMakeUpIDToPageNumber = (riverID: string) => parseInt(riverID.replace(\"CardRiver \", \"\"));\n\nexport const emptyCardRiver = (page: number): RiverMakeUp => {\n\treturn {\n\t\triverID: pageNumberToRiverMakeUpID(page),\n\t\tcardIDs: [],\n\t};\n};\n\nexport const updateStateWithMakeUps = (state: CardRiverState, ...makeUps: RiverMakeUp[]) => {\n\tconst updatedState = { ...state };\n\tmakeUps.forEach((makeUp) => {\n\t\tupdatedState.riverMakeUps[makeUp.riverID] = makeUp;\n\t});\n\treturn updatedState;\n};\n\nexport const removeCardFromRivers = (state: CardRiverState, cardID: CardID): CardRiverState => {\n\tconst riverMakeUps = Object.fromEntries(\n\t\tObject.entries(state.riverMakeUps)\n\t\t\t.map((entry) => [entry[0], { ...entry[1], cardIDs: entry[1].cardIDs.filter((id) => id !== cardID) }])\n\t\t\t.filter((entry) => (entry[1] as RiverMakeUp).cardIDs.length !== 0)\n\t);\n\treturn { ...state, riverMakeUps };\n};\n\n//TODO: make option to not show card instead of delete\n// make nice small option in river to hide / show hidden cards (default: hide)\n","export const NAME = \"cards\";\n","import { NAME } from \"./constants\";\n\nexport const CARD_REPLACE = NAME + \"/CARD_REPLACE\";\nexport const CARD_PUSH = NAME + \"/CARD_PUSH\";\nexport const CARD_REMOVE = NAME + \"/CARD_REMOVE\";\n\nexport const CARDS_REPLACE = NAME + \"/CARDS_REPLACE\";\nexport const CARDS_RESET = NAME + \"/CARDS_RESET\";\n","import { CardField, QACardField } from \"./content\";\n\n// for origin and content the same object structure is used,\n// so same permutation api should be used\n\ntype NoteObject = NonNullable<any>;\ntype QAObject = { [key in QACardField]: NonNullable<any> };\ntype CardObject = NoteObject | QAObject;\n\nconst FieldValueAccessorMap: { [field in CardField]: (cardObject: CardObject) => any } = {\n\tnote: (cardObject) => cardObject,\n\tq: (cardObject) => (cardObject as QAObject).q,\n\ta: (cardObject) => (cardObject as QAObject).a,\n};\nexport const toFieldValue = (field: CardField, cardObject: CardObject) => FieldValueAccessorMap[field](cardObject);\n\ntype Modify = (oldValue: any) => any;\nconst FieldValueModifierMap: { [key in CardField]: (cardObject: CardObject, modify: Modify) => any } = {\n\tnote: (cardObject, modify) => modify(cardObject),\n\tq: (cardObject, modify) => {\n\t\treturn { ...(cardObject as QAObject), q: modify((cardObject as QAObject).q) };\n\t},\n\ta: (cardObject, modify) => {\n\t\treturn { ...(cardObject as QAObject), a: modify((cardObject as QAObject).a) };\n\t},\n};\nconst modifyFieldValue = (field: CardField, cardObject: CardObject, modify: Modify) =>\n\tFieldValueModifierMap[field](cardObject, modify);\n\nexport type CreateModify = (inputValue: any) => Modify;\n\n// this replace is generic, I dont put append here, because that is object specific\nexport const createReplace: CreateModify = (inputValue: any) => (_: any) => inputValue;\n\nexport type CardObjectChangeSpec = {\n\tinputField: CardField;\n\tinputObject: CardObject;\n\tfieldToBeChanged: CardField;\n\tobjectToBeChanged: CardObject;\n\tcreateModify: CreateModify;\n};\nexport const changeCardObject = (spec: CardObjectChangeSpec) => {\n\tconst inputValue = toFieldValue(spec.inputField, spec.inputObject);\n\tconst modify = spec.createModify(inputValue);\n\treturn modifyFieldValue(spec.fieldToBeChanged, spec.objectToBeChanged, modify);\n};\n","import { CreateModify, changeCardObject, createReplace } from \"./permutation\";\nimport { NoteConfig, QAConfig, UpdateType } from \"./config\";\n\nexport type QACardField = \"q\" | \"a\";\nexport type CardField = \"note\" | QACardField;\n\nexport type StringCardContent = string;\nexport type NoteCardContent = StringCardContent;\nexport type QACardContent = {\n\t[field in QACardField]: StringCardContent;\n};\nexport type CardContent = NoteCardContent | QACardContent;\n\ntype EmptyContent = { q: \"\"; a: \"\" } | \"\";\nconst emptyQAContent = (): EmptyContent => {\n\treturn { q: \"\", a: \"\" };\n};\nconst EmptyContentMap: { [field in CardField]: () => EmptyContent } = {\n\tq: emptyQAContent,\n\ta: emptyQAContent,\n\tnote: () => \"\",\n};\nexport const emptyContent = (field: CardField) => {\n\treturn EmptyContentMap[field]();\n};\n\nexport const noteContentIsEmpty = (content: string) => content === \"\";\nexport const qaContentIsNotFull = (content: QACardContent) =>\n\t(content as QACardContent).q === \"\" || (content as QACardContent).a === \"\";\n\nconst createAppendStr: CreateModify = (inputValue: string) => (oldValue: string) =>\n\t(oldValue + \" \" + inputValue).trim();\nconst UpdateTypeCreateModifyMap: { [updateType in UpdateType]: CreateModify } = {\n\tAPPEND: createAppendStr,\n\tREPLACE: createReplace,\n};\nconst updateTypeToCreateModify = (updateType: UpdateType) => UpdateTypeCreateModifyMap[updateType];\n\n// noteObjects are a single value like the selectedString, so we use them as a field for convenience\nconst inputField: CardField = \"note\";\n\nexport const strToCardContent = (\n\tcontentStr: string,\n\toutputField: CardField,\n\tupdateType: UpdateType,\n\texistingContent: CardContent\n): CardContent => {\n\tconst changeSpec = {\n\t\tinputObject: contentStr,\n\t\tinputField,\n\t\tfieldToBeChanged: outputField,\n\t\tobjectToBeChanged: existingContent,\n\t\tcreateModify: updateTypeToCreateModify(updateType),\n\t};\n\treturn changeCardObject(changeSpec);\n};\n\nexport const strToNewCardContent = (contentStr: string, outputField: CardField) => {\n\t// new is always empty and we replace the input in the empty shell\n\tconst empty = emptyContent(outputField);\n\treturn strToCardContent(contentStr, outputField, \"REPLACE\", empty);\n};\n\nexport const noteContentContainsStringOrEmpty = (noteConfig: NoteConfig, str: string) =>\n\tnoteConfig.content === \"\" || noteConfig.content.includes(str);\n\nexport const qaContentContainsStringOrEmpty = (qaConfig: QAConfig, str: string) =>\n\tqaConfig.content.a === \"\" ||\n\tqaConfig.content.q === \"\" ||\n\tqaConfig.content.a.includes(str) ||\n\tqaConfig.content.q.includes(str);\n","import { NoteOrigin, QAOrigin } from \"./origin\";\nimport {\n\tNoteCardContent,\n\tQACardContent,\n\tnoteContentIsEmpty,\n\tqaContentIsNotFull,\n\tstrToCardContent,\n\tCardField,\n} from \"./content\";\n\nexport type CardID = string;\nexport const cardIDToNumber = (cardID: CardID) => parseInt(cardID);\nexport const nextCardID = (lastCardIDNumber: number) => (lastCardIDNumber + 1).toString();\n\nexport type CardType = \"Note\" | \"Q-A\";\nexport type NoteConfig = { cardID: CardID; type: CardType; content: NoteCardContent; origin?: NoteOrigin };\nexport type QAConfig = { cardID: CardID; type: CardType; content: QACardContent; origin?: QAOrigin };\nexport type CardConfig = NoteConfig | QAConfig;\n\nconst CardIsFullMap: { [card in CardType]: (config: CardConfig) => boolean } = {\n\tNote: (config) => noteContentIsEmpty(config.content as NoteCardContent),\n\t\"Q-A\": (config) => qaContentIsNotFull(config.content as QACardContent),\n};\nexport const cardIsNotFull = (config: CardConfig) => CardIsFullMap[config.type](config);\n\nexport type UpdateType = \"REPLACE\" | \"APPEND\";\n\nexport const strToCardConfig = (\n\tcontentStr: string,\n\toutputField: CardField,\n\tupdateType: UpdateType,\n\tbaseCard: CardConfig\n): CardConfig => {\n\tconst changedContent = strToCardContent(contentStr, outputField, updateType, baseCard.content);\n\treturn { ...baseCard, content: changedContent } as CardConfig;\n};\n\nconst CardFieldToTypeMap: { [field in CardField]: CardType } = {\n\tq: \"Q-A\",\n\ta: \"Q-A\",\n\tnote: \"Note\",\n};\n\nexport const cardFieldToType = (field: CardField) => CardFieldToTypeMap[field];\n","import { createSelector } from \"reselect\";\nimport { CardsState } from \"./model/state\";\nimport { NAME } from \"./constants\";\n\nexport const getAll = (state: any) => state[NAME].present;\n\nexport const getLastCardIDNumber = createSelector(getAll, (state) => state.lastCardIDNumber);\n\nexport const getCards = createSelector(getAll, (state: CardsState) => state.cards);\n\nexport const getCardByID = (state: any, cardID: string) => getCards(state)[cardID];\n","import { CardConfig, CardID, strToCardConfig } from \"./model/config\";\nimport { CardPayload, cardPayloadToCardConfig, emptyNotePayload, emptyQAPayload } from \"./model/payload\";\nimport * as t from \"./actionTypes\";\nimport { CardField } from \"./model/content\";\nimport { ClayMemoryPayloadAction } from \"../../shared/utils\";\nimport { Dispatch } from \"redux\";\nimport { createAction } from \"@reduxjs/toolkit\";\nimport { CardsState } from \"./model/state\";\n\nexport const cardPush = (cardPayload: CardPayload) => {\n\treturn (dispatch: Dispatch, getState: Function) => {\n\t\tdispatch({\n\t\t\ttype: t.CARD_PUSH,\n\t\t\tpayload: cardPayloadToCardConfig(cardPayload, getState()),\n\t\t} as ClayMemoryPayloadAction);\n\t};\n};\nexport const emptyNoteCard = () => cardPush(emptyNotePayload());\nexport const emptyQACard = () => cardPush(emptyQAPayload());\n\nexport const cardReplace = (card: CardConfig): ClayMemoryPayloadAction => {\n\treturn { type: t.CARD_REPLACE, payload: card };\n};\nexport const replaceCardFieldContent = (cardField: CardField, cardConfig: CardConfig, newValue: string) => {\n\treturn cardReplace(strToCardConfig(newValue, cardField, \"REPLACE\", cardConfig));\n};\n\nexport const removeCard = (cardID: CardID): ClayMemoryPayloadAction => {\n\treturn { type: t.CARD_REMOVE, payload: cardID };\n};\n\nexport const resetCards = createAction(t.CARDS_RESET);\nexport const replaceCards = (cardsState: CardsState) => {\n\treturn { type: t.CARDS_REPLACE, payload: cardsState };\n};\n","import { CardField, strToCardContent } from \"./content\";\nimport { getLastCardIDNumber } from \"../selectors\";\nimport { CardConfig, nextCardID, UpdateType } from \"./config\";\nimport { CardsState } from \"./state\";\n\nexport type CardPayload = Omit<CardConfig, \"cardID\">;\nexport const emptyNotePayload = (): CardPayload => {\n\treturn { type: \"Note\", content: \"\" };\n};\nexport const emptyQAPayload = (): CardPayload => {\n\treturn { type: \"Q-A\", content: { q: \"\", a: \"\" } };\n};\n\nexport const strToCardPayload = (\n\tcontentStr: string,\n\toutputField: CardField,\n\tupdateType: UpdateType,\n\tbaseCard: CardPayload\n): CardPayload => {\n\tconst changedContent = strToCardContent(contentStr, outputField, updateType, baseCard.content);\n\treturn { ...baseCard, content: changedContent };\n};\n\nconst EmptyPayloadFieldMap: {\n\t[key in CardField]: () => CardPayload;\n} = {\n\tnote: emptyNotePayload,\n\tq: emptyQAPayload,\n\ta: emptyQAPayload,\n};\nexport const cardFieldToEmptyPayload = (field: CardField) => EmptyPayloadFieldMap[field]();\n\nexport const cardPayloadToCardConfig = (payload: CardPayload, state: CardsState) => {\n\treturn { ...payload, cardID: nextCardID(getLastCardIDNumber(state)) } as CardConfig;\n};\n","import FeaturedVideoIcon from \"@material-ui/icons/FeaturedVideo\";\nimport React from \"react\";\nimport { IconButton } from \"@material-ui/core\";\nimport { useDispatch } from \"react-redux\";\nimport text from \"../../text\";\nimport { emptyNoteCard } from \"../actions\";\n\nexport const AddNoteButton = () => {\n\tconst dispatch = useDispatch();\n\treturn (\n\t\t<text.components.NewNoteCardTooltip>\n\t\t\t<IconButton\n\t\t\t\ttype=\"button\"\n\t\t\t\tonClick={() => {\n\t\t\t\t\tdispatch(emptyNoteCard());\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<FeaturedVideoIcon></FeaturedVideoIcon>\n\t\t\t</IconButton>\n\t\t</text.components.NewNoteCardTooltip>\n\t);\n};\n","import FeaturedPlayListIcon from \"@material-ui/icons/FeaturedPlayList\";\nimport React from \"react\";\nimport { IconButton } from \"@material-ui/core\";\nimport { useDispatch } from \"react-redux\";\nimport text from \"../../text\";\nimport { emptyQACard } from \"../actions\";\n\nexport const AddQAButton = () => {\n\tconst dispatch = useDispatch();\n\treturn (\n\t\t<text.components.AddQAButtonTooltip>\n\t\t\t<IconButton\n\t\t\t\ttype=\"button\"\n\t\t\t\tonClick={() => {\n\t\t\t\t\tdispatch(emptyQACard());\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<FeaturedPlayListIcon></FeaturedPlayListIcon>\n\t\t\t</IconButton>\n\t\t</text.components.AddQAButtonTooltip>\n\t);\n};\n","import DeleteForeverIcon from \"@material-ui/icons/DeleteForever\";\nimport React from \"react\";\nimport { IconButton } from \"@material-ui/core\";\nimport { useDispatch } from \"react-redux\";\nimport { CardID } from \"../model/config\";\nimport text from \"../../text\";\nimport { removeCard } from \"../actions\";\n\nexport const DeleteCardButton = ({ cardID }: { cardID: CardID }) => {\n\tconst dispatch = useDispatch();\n\treturn (\n\t\t<text.components.DeleteCardButtonTooltip>\n\t\t\t<IconButton\n\t\t\t\ttype=\"button\"\n\t\t\t\tonClick={() => {\n\t\t\t\t\tdispatch(removeCard(cardID));\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<DeleteForeverIcon fontSize=\"small\"></DeleteForeverIcon>\n\t\t\t</IconButton>\n\t\t</text.components.DeleteCardButtonTooltip>\n\t);\n};\n","import { CardField } from \"./content\";\nimport { createReplace, changeCardObject } from \"./permutation\";\n\nexport type SingleOrigin = { spanIndexStart: number; spanIndexEnd: number; page: number };\nexport type QOnlyQAOrigin = { q: SingleOrigin; a: {} };\nexport type AOnlyQAOrigin = { q: {}; a: SingleOrigin };\nexport type PartialQAOrigin = QOnlyQAOrigin | AOnlyQAOrigin;\nconst emptyQAOrigin = () => {\n\treturn { q: {}, a: {} };\n};\ntype EmptyOrigin = { q: {}; a: {} } | \"\";\nconst EmptyOriginMap: { [field in CardField]: () => EmptyOrigin } = {\n\tq: emptyQAOrigin,\n\ta: emptyQAOrigin,\n\tnote: () => \"\",\n};\nexport const emptyOrigin = (field: CardField) => {\n\treturn EmptyOriginMap[field]();\n};\ntype FullQAOrigin = { q: SingleOrigin; a: SingleOrigin };\nexport type QAOrigin = FullQAOrigin | PartialQAOrigin;\nexport type NoteOrigin = SingleOrigin;\nexport type CardOrigin = NoteOrigin | QAOrigin;\n\nexport const singleOriginToCardOrigin = (\n\tsingleOrigin: SingleOrigin,\n\toutputField: CardField,\n\tbaseOrigin?: CardOrigin\n): CardOrigin => {\n\tconst changeSpec = {\n\t\tinputObject: singleOrigin,\n\t\tinputField: \"note\" as CardField,\n\t\tfieldToBeChanged: outputField,\n\t\tobjectToBeChanged: baseOrigin ? baseOrigin : emptyOrigin(outputField),\n\t\tcreateModify: createReplace,\n\t};\n\n\treturn changeCardObject(changeSpec);\n};\n","import { CardConfig, CardID } from \"./config\";\n\ntype Cards = { [cardID: string]: CardConfig };\n\nexport type CardsState = {\n\tcards: Cards;\n\tlastCardIDNumber: number;\n};\nexport const removeCardFromCardsState = (state: CardsState, cardID: CardID) => {\n\tconst cards = { ...state.cards };\n\n\t// we do not reset the ID counter\n\tdelete cards[cardID];\n\n\treturn { ...state, cards };\n};\n\nexport const updateCardInCards = (cards: Cards, toBeUpdated: CardConfig) => {\n\tconst cardObj = { ...cards };\n\tcardObj[toBeUpdated.cardID] = toBeUpdated;\n\treturn cardObj;\n};\n","export const NAME = \"documentDB\";\n","import { NAME } from \"./constants\";\n\nexport const ARCHIVE_CURRENT_DATA = NAME + \"/ARCHIVE_CURRENT_DATA\";\nexport const LOAD_DOCUMENT_DATA_SETS = NAME + \"/LOAD_DOCUMENT_DATA_SETS\";\nexport const DELETE_DOCUMENT_DATA_SET = NAME + \"/DELETE_DOCUMENT_DATA_SET\";\n","import { DocumentData } from \"./model\";\nimport * as t from \"./actionTypes\";\nimport { ClayMemoryPayloadAction } from \"../../shared/utils\";\n\nexport const archiveDBData = (dbData: DocumentData): ClayMemoryPayloadAction => {\n\treturn { type: t.ARCHIVE_CURRENT_DATA, payload: dbData };\n};\n\nexport const loadDocumentDataSets = (\n\tdbData: DocumentData[],\n\tnewActiveDataSet?: DocumentData\n): ClayMemoryPayloadAction => {\n\treturn { type: t.LOAD_DOCUMENT_DATA_SETS, payload: { dbData, newActiveDataSet } };\n};\n\nexport const deleteDocumentDataSet = (document: string): ClayMemoryPayloadAction => {\n\treturn { type: t.DELETE_DOCUMENT_DATA_SET, payload: document };\n};\n","import { CardRiverState } from \"../river/model\";\nimport { CardsState } from \"../cards/model/state\";\nimport { DisplayData } from \"../display/model\";\n\nexport type ArchiveRiver = Pick<CardRiverState, \"riverMakeUps\">;\n\ntype ArchiveDisplay = Pick<DisplayData, \"currentPage\" | \"totalPages\">;\n\nexport type DocumentData = {\n\tname: string;\n} & ArchiveDisplay &\n\tArchiveRiver &\n\tCardsState;\n\nexport type DocumentDB = { [name: string]: DocumentData };\n\nexport const updateDocumentDataInDocumentDB = (state: DocumentDB, documentData: DocumentData): DocumentDB => {\n\treturn { ...state, [documentData.name]: documentData };\n};\n\nexport const updateDocumentDataSetsInDocumentDB = (state: DocumentDB, documentDataSets: DocumentData[]): DocumentDB => {\n\treturn {\n\t\t...state,\n\t\t...documentDataSets.reduce((prev, dbData) => {\n\t\t\tprev[dbData.name] = dbData;\n\t\t\treturn prev;\n\t\t}, {} as DocumentDB),\n\t};\n};\n\nexport const removeDocumentDataFromDocumentDB = (state: DocumentDB, document: string): DocumentDB => {\n\treturn Object.fromEntries(Object.entries(state).filter((arr) => arr[0] !== document));\n};\n","import {\n\tDocumentDB,\n\tDocumentData,\n\tupdateDocumentDataInDocumentDB,\n\tupdateDocumentDataSetsInDocumentDB,\n\tremoveDocumentDataFromDocumentDB,\n} from \"./model\";\nimport * as t from \"./actionTypes\";\n\nconst initialState: DocumentDB = {};\n\n//TODO: PDF-data gets saved with name, better use some hash or something (rename of document file is likely) -> use size or last-modified or smth like that instead of name\n\nconst documentDB = (\n\tstate = initialState,\n\t{ type, payload }: { type: string; payload: DocumentData | DocumentData[] | string | { dbData: DocumentData[] } }\n): DocumentDB => {\n\tswitch (type) {\n\t\t// dont need to undo this, because if we change the active river and then change the document, the archive version gets overwritten\n\t\tcase t.ARCHIVE_CURRENT_DATA:\n\t\t\treturn updateDocumentDataInDocumentDB(state, payload as DocumentData);\n\t\tcase t.LOAD_DOCUMENT_DATA_SETS:\n\t\t\treturn updateDocumentDataSetsInDocumentDB(\n\t\t\t\tstate,\n\t\t\t\t(payload as { dbData: DocumentData[] }).dbData as DocumentData[]\n\t\t\t);\n\t\tcase t.DELETE_DOCUMENT_DATA_SET:\n\t\t\treturn removeDocumentDataFromDocumentDB(state, payload as string);\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n\nexport default documentDB;\n","import { createSelector } from \"reselect\";\nimport { DocumentDB } from \"./model\";\nimport { NAME } from \"./constants\";\n\nexport const getAll = (state: any): DocumentDB => state[NAME].present;\n\nexport const getDocumentNames = createSelector(getAll, (db) => Object.keys(db));\n\nexport const getDocumentDataSets = createSelector(getAll, (db) => Object.values(db));\n","import * as actions from \"./actions\";\nimport * as actionTypes from \"./actionTypes\";\nimport * as constants from \"./constants\";\nimport reducer from \"./reducer\";\nimport * as selectors from \"./selectors\";\n\nexport default { actions, actionTypes, constants, reducer, selectors };\n","import * as t from \"./actionTypes\";\nimport { cardIDToNumber } from \"./model/config\";\nimport { CardsState, removeCardFromCardsState, updateCardInCards } from \"./model/state\";\nimport db from \"../db\";\nimport { ClayMemoryPayloadAction } from \"../../shared/utils\";\n\nconst intialState: CardsState = {\n\tcards: {},\n\tlastCardIDNumber: 0,\n};\n\nconst cards = (state = intialState, { type, payload }: ClayMemoryPayloadAction) => {\n\tswitch (type) {\n\t\tcase t.CARD_PUSH:\n\t\t\tconst lastCardIDNumber = cardIDToNumber(payload.cardID) + 1;\n\t\t\treturn { ...state, cards: updateCardInCards(state.cards, payload), lastCardIDNumber };\n\t\tcase t.CARD_REPLACE:\n\t\t\treturn { ...state, cards: updateCardInCards(state.cards, payload) };\n\t\tcase t.CARD_REMOVE:\n\t\t\treturn removeCardFromCardsState(state, payload as string);\n\t\tcase t.CARDS_REPLACE:\n\t\t\treturn payload as CardsState;\n\t\tcase t.CARDS_RESET:\n\t\t\treturn intialState;\n\t\tcase db.actionTypes.LOAD_DOCUMENT_DATA_SETS:\n\t\t\t// basically the same as DOCUMENT_CHANGE, just only triggered\n\t\t\t// when uploading data that corresponds to current document\n\t\t\t// and if not we dont reset\n\t\t\tif (payload.newActiveDataSet) {\n\t\t\t\treturn {\n\t\t\t\t\t...intialState,\n\t\t\t\t\tcards: (payload as CardsState).cards,\n\t\t\t\t\tlastCardIDNumber: (payload as CardsState).lastCardIDNumber,\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\treturn state;\n\t\t\t}\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n\nexport default cards;\n","import * as constants from \"./constants\";\nimport * as actionTypes from \"./actionTypes\";\nimport * as actions from \"./actions\";\nimport * as selectors from \"./selectors\";\nimport * as components from \"./components\";\nimport * as model from \"./model\";\nimport reducer from \"./reducer\";\n\nexport default { constants, actionTypes, actions, reducer, selectors, components, model };\n","import { NAME } from \"./constants\";\nimport { createSelector } from \"reselect\";\nimport { CardRiverState, riverMakeUpIDToPageNumber } from \"./model\";\nimport cards from \"../cards\";\nimport { CardID } from \"../cards/model/config\";\n\nexport const getAll = (state: any): CardRiverState => state[NAME].present;\n\nexport const getRiverMakeUps = createSelector(getAll, (state: CardRiverState) => state.riverMakeUps);\n\nexport const getNonEmptyRiverIDs = createSelector(getRiverMakeUps, (makeUps) => Object.keys(makeUps));\n\nexport const getNonEmptyRiverIDsSorted = createSelector(getNonEmptyRiverIDs, (ids) =>\n\tids.sort((a, b) => riverMakeUpIDToPageNumber(a) - riverMakeUpIDToPageNumber(b))\n);\n\nexport const getNonEmptyRiverMakeUpsSorted = createSelector(getRiverMakeUps, (makeUps) =>\n\tObject.values(makeUps).sort((a, b) => riverMakeUpIDToPageNumber(a.riverID) - riverMakeUpIDToPageNumber(b.riverID))\n);\n\nexport const getNonEmptyRiverCardsSorted = createSelector(\n\tgetNonEmptyRiverMakeUpsSorted,\n\tcards.selectors.getCards,\n\t(makeUps, cards) => {\n\t\tconst cardObjects = [];\n\t\tfor (const makeUp of makeUps) {\n\t\t\tfor (const id of makeUp.cardIDs) {\n\t\t\t\tcardObjects.push(cards[id]);\n\t\t\t}\n\t\t}\n\n\t\treturn cardObjects;\n\t}\n);\n\nexport const getActiveRiverMakeUpID = createSelector(getAll, (state: CardRiverState) => state.activeRiverMakeUpID);\n\nexport const getActiveRiverMakeUp = createSelector(getRiverMakeUps, getActiveRiverMakeUpID, (makeUps, id) => {\n\tconst makeUp = makeUps[id];\n\treturn makeUp ? makeUp : { cardIDs: [] };\n});\n\nexport const getActiveRiverCardIDs = createSelector(getActiveRiverMakeUp, (makeUp): CardID[] => makeUp.cardIDs);\n\nexport const getActiveRiverCards = createSelector(\n\tgetActiveRiverCardIDs,\n\tcards.selectors.getCards,\n\t(makeUpCardIDs, cards) => makeUpCardIDs.map((id) => cards[id])\n);\n\nexport const getRiverShowState = createSelector(getAll, (state: CardRiverState) => state.riverShowState);\n\nexport const riverShowStateIsShow = createSelector(getRiverShowState, (state) => state === \"SHOW\");\n\nexport const getRiverContentState = createSelector(getAll, (state: CardRiverState) => state.riverContentState);\n\nexport const getRiverContentFilter = createSelector(getAll, (state: CardRiverState) => state.contentFilter);\n\nexport const getOriginRequest = createSelector(getAll, (state) => state.requestedOrigin);\n","import { NAME } from \"./constants\";\n\nexport const RIVER_ACTIVE_ID = NAME + \"/RIVER_ACTIVE_ID\";\n\nexport const RIVER_SHOW_STATE = NAME + \"/RIVER_SHOW_STATE\";\nexport const RIVER_CONTENT_STATE = NAME + \"/RIVER_CONTENT_STATE\";\nexport const RIVER_CONTENT_FILTER = NAME + \"/RIVER_CONTENT_FILTER\";\n\nexport const ORIGIN_REQUEST = NAME + \"/ORIGIN_REQUEST\";\n\nexport const RIVER_RESET = NAME + \"/RIVER_RESET\";\nexport const RIVER_REPLACE = NAME + \"/RIVER_REPLACE\";\n","import * as t from \"./actionTypes\";\nimport { riverShowStateIsShow, getActiveRiverMakeUpID } from \"./selectors\";\nimport { Dispatch } from \"redux\";\nimport { RiverContentState, ContentFilter, RiverMakeUps } from \"./model\";\nimport { SingleOrigin } from \"../cards/model/origin\";\nimport { ClayMemoryPayloadAction } from \"../../shared/utils\";\nimport { createAction } from \"@reduxjs/toolkit\";\n\nexport const toggleRiverShowState = () => (dispatch: Dispatch, getState: Function) => {\n\tdispatch({\n\t\ttype: t.RIVER_SHOW_STATE,\n\t\tpayload: riverShowStateIsShow(getState()) ? \"HIDE\" : \"SHOW\",\n\t} as ClayMemoryPayloadAction);\n};\n\nexport const setRiverContentState = (state: RiverContentState): ClayMemoryPayloadAction => {\n\treturn { type: t.RIVER_CONTENT_STATE, payload: state };\n};\n\nexport const setActiveRiver = (id: string): ClayMemoryPayloadAction => {\n\treturn { type: t.RIVER_ACTIVE_ID, payload: id };\n};\n\nexport const trySetActiveRiver = (id: string) => {\n\treturn (dispatch: Dispatch, getState: Function) => {\n\t\tif (getActiveRiverMakeUpID(getState()) !== id) dispatch(setActiveRiver(id));\n\t};\n};\n\nexport const setContentFilter = (filter: ContentFilter): ClayMemoryPayloadAction => {\n\treturn { type: t.RIVER_CONTENT_FILTER, payload: filter };\n};\n\nexport const resetContentFilter = (): ClayMemoryPayloadAction => {\n\treturn { type: t.RIVER_CONTENT_FILTER, payload: \"\" };\n};\n\nexport const setOriginRequest = (origin: SingleOrigin | null): ClayMemoryPayloadAction => {\n\treturn { type: t.ORIGIN_REQUEST, payload: origin };\n};\n\nexport const resetOriginRequest = () => {\n\treturn setOriginRequest(null);\n};\n\nexport const resetRivers = createAction(t.RIVER_RESET);\nexport const replaceRivers = (makeUps: RiverMakeUps) => {\n\treturn { type: t.RIVER_REPLACE, payload: makeUps };\n};\n","import { withStyles, CheckboxProps, Checkbox } from \"@material-ui/core\";\nimport React from \"react\";\nimport { green } from \"@material-ui/core/colors\";\nexport const GreenCheckbox = withStyles({\n\troot: {\n\t\tcolor: green[400],\n\t\t\"&$checked\": {\n\t\t\tcolor: green[600],\n\t\t},\n\t},\n\tchecked: {},\n})((props: CheckboxProps) => <Checkbox color=\"default\" {...props} />);\n","import { FormGroup, FormControlLabel } from \"@material-ui/core\";\nimport React from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { getRiverContentState } from \"../selectors\";\nimport { RiverContentState } from \"../model\";\nimport { setRiverContentState } from \"../actions\";\nimport { GreenCheckbox } from \"../../../shared/GreenCheckbox\";\n\nexport const RiverContentFormGroup = () => {\n\tconst riverContentState = useSelector(getRiverContentState);\n\tconst dispatch = useDispatch();\n\n\tconst showQAs = riverContentState === \"ALL\" || riverContentState === \"QAS\";\n\tconst showNotes = riverContentState === \"ALL\" || riverContentState === \"NOTES\";\n\n\tconst changeContentState = (clickedState: RiverContentState) => {\n\t\tif (!showQAs && clickedState === \"QAS\") {\n\t\t\tif (showNotes) {\n\t\t\t\tdispatch(setRiverContentState(\"ALL\"));\n\t\t\t} else {\n\t\t\t\tdispatch(setRiverContentState(\"QAS\"));\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tif (!showNotes && clickedState === \"NOTES\") {\n\t\t\tif (showQAs) {\n\t\t\t\tdispatch(setRiverContentState(\"ALL\"));\n\t\t\t} else {\n\t\t\t\tdispatch(setRiverContentState(\"NOTES\"));\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tif (showQAs && clickedState === \"QAS\") {\n\t\t\tif (!showNotes) {\n\t\t\t\tdispatch(setRiverContentState(\"NONE\"));\n\t\t\t} else {\n\t\t\t\tdispatch(setRiverContentState(\"NOTES\"));\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tif (showNotes && clickedState === \"NOTES\") {\n\t\t\tif (!showQAs) {\n\t\t\t\tdispatch(setRiverContentState(\"NONE\"));\n\t\t\t} else {\n\t\t\t\tdispatch(setRiverContentState(\"QAS\"));\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t};\n\n\treturn (\n\t\t<FormGroup>\n\t\t\t<FormControlLabel\n\t\t\t\tcontrol={\n\t\t\t\t\t<GreenCheckbox\n\t\t\t\t\t\tchecked={showQAs}\n\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\tchangeContentState(\"QAS\");\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\t\t\t\t}\n\t\t\t\tlabel=\"QAs\"\n\t\t\t/>\n\t\t\t<FormControlLabel\n\t\t\t\tcontrol={\n\t\t\t\t\t<GreenCheckbox\n\t\t\t\t\t\tchecked={showNotes}\n\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\tchangeContentState(\"NOTES\");\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\t\t\t\t}\n\t\t\t\tlabel=\"Notes\"\n\t\t\t/>\n\t\t</FormGroup>\n\t);\n};\n","export const NAME = \"selectionData\";\n","import { NAME } from \"./constants\";\nexport const SELECTION_SOURCE = NAME + \"/SELECTION_SOURCE\";\nexport const SELECTION_GOAL = NAME + \"/SELECTION_GOAL\";\n","import { NAME } from \"./constants\";\nimport { createSelector } from \"reselect\";\nimport { SelectionData } from \"./model\";\n\nexport const getAll = (state: any): SelectionData => state[NAME].present;\n\nexport const getGoalConfig = createSelector(getAll, (state) => state.goalConfig);\nexport const getSourceConfig = createSelector(getAll, (state) => state.sourceConfig);\n\nexport const sourceConfigExists = createSelector(getSourceConfig, (config) => !!config);\n","import { CardConfig } from \"../../cards/model/config\";\nimport cards from \"../../cards\";\nimport { SelectionGoalConfig, SelectionSourceConfig, goalIsCreation, SelectionExistingCardGoalConfig } from \"../model\";\nimport { CardPayload } from \"../../cards/model/payload\";\n\nconst selectionConfigToCardPayload = (sourceConfig: SelectionSourceConfig, goalConfig: SelectionGoalConfig) => {\n\tconst inputOrigin = sourceConfig.contentOrigin;\n\tconst inputValue = sourceConfig.contentStr;\n\n\tconst outputField = goalConfig.cardField;\n\n\treturn {\n\t\ttype: cards.model.config.cardFieldToType(outputField),\n\t\tcontent: cards.model.content.strToNewCardContent(inputValue, outputField),\n\t\torigin: inputOrigin ? cards.model.origin.singleOriginToCardOrigin(inputOrigin, outputField) : undefined,\n\t};\n};\n\nconst selectionConfigToActualizedCardConfig = (\n\tsourceConfig: SelectionSourceConfig,\n\tgoalConfig: SelectionExistingCardGoalConfig,\n\tstate: any\n): CardConfig => {\n\tconst existingCard = cards.selectors.getCardByID(state, goalConfig.cardID);\n\n\tconst inputOrigin = sourceConfig.contentOrigin;\n\tconst inputValue = sourceConfig.contentStr;\n\n\tconst outputField = goalConfig.cardField;\n\n\treturn {\n\t\t...existingCard,\n\t\tcontent: cards.model.content.strToCardContent(inputValue, outputField, goalConfig.updateType, existingCard.content),\n\t\torigin: inputOrigin\n\t\t\t? cards.model.origin.singleOriginToCardOrigin(inputOrigin, outputField, existingCard.origin)\n\t\t\t: existingCard.origin,\n\t} as CardConfig;\n};\n\nexport const selectionToCard = (\n\tsourceConfig: SelectionSourceConfig,\n\tgoalConfig: SelectionGoalConfig,\n\tdispatch: any,\n\tstate: any\n) => {\n\tconst isCreation = goalIsCreation(goalConfig);\n\tif (isCreation) {\n\t\tconst cardPayload: CardPayload = selectionConfigToCardPayload(sourceConfig, goalConfig);\n\t\tdispatch(cards.actions.cardPush(cardPayload));\n\t} else {\n\t\tconst cardConfig = selectionConfigToActualizedCardConfig(\n\t\t\tsourceConfig,\n\t\t\tgoalConfig as SelectionExistingCardGoalConfig,\n\t\t\tstate\n\t\t);\n\t\tdispatch(cards.actions.cardReplace(cardConfig));\n\t}\n};\n","import { SingleOrigin } from \"../cards/model/origin\";\nimport { CardField } from \"../cards/model/content\";\nimport { CardID, UpdateType } from \"../cards/model/config\";\n\nexport type SelectionSourceConfig = { contentStr: string; contentOrigin?: SingleOrigin };\n\nexport type CardFieldIdentifier = { cardID: CardID; cardField: CardField };\nexport type SelectionExistingCardGoalConfig = CardFieldIdentifier & { updateType: UpdateType };\nexport type SelectionGoalConfig = SelectionExistingCardGoalConfig | { cardField: CardField };\nexport const goalIsCreation = (goalConfig: SelectionGoalConfig) => {\n\t// each existing card has an ID\n\tconst idExists = !!(goalConfig as CardFieldIdentifier).cardID;\n\treturn !idExists;\n};\n\n// Selection is made up of two parts: selecting a source and selecting a goal\n// If both are done, then a Card needs to be created or updated\n// By clarifying this concept, I was able to reduce the selection code and make it more composable\n// See: AppendButton can be used before or after selecting a source without any extra code\n// This shows that a correct conceptualisation of the problem domain operations is the most important\n// thing in programming (note to self :))\n\nexport type SelectionData = {\n\tsourceConfig: SelectionSourceConfig | null;\n\tgoalConfig: SelectionGoalConfig | null;\n};\n","import { SelectionSourceConfig } from \"../model\";\nimport { SingleOrigin } from \"../../cards/model/origin\";\n\ntype SelectionData = { text: string; selection: Selection };\n\nexport const getSelectionWorkaround = (): SelectionData | null => {\n\tconst selection = window.getSelection();\n\n\tif (!selection) return null;\n\n\ttry {\n\t\tvar activeElement = document.activeElement;\n\t\tif (activeElement && (activeElement as HTMLInputElement).value) {\n\t\t\t// firefox bug https://bugzilla.mozilla.org/show_bug.cgi?id=85686\n\t\t\tconst str = (activeElement as HTMLInputElement).value.substring(\n\t\t\t\t(activeElement as HTMLInputElement).selectionStart as number,\n\t\t\t\t(activeElement as HTMLInputElement).selectionEnd as number\n\t\t\t);\n\n\t\t\tif (str === \"\") return null;\n\n\t\t\treturn { text: str, selection };\n\t\t} else {\n\t\t\tconst selStr = selection.toString();\n\n\t\t\tif (selStr === \"\") return null;\n\n\t\t\treturn { text: selStr, selection };\n\t\t}\n\t} catch (e) {\n\t\treturn null;\n\t}\n};\n\nconst materialSelectionDataToSourceConfig = (\n\tselectionData: SelectionData,\n\tpage: number\n): SelectionSourceConfig | false => {\n\t//TODO: think about race-conditions for the delayed rendering, this might mess up the index\n\t//TODO: this also depends on the rendering order of the spans to be the same, might not be a good idea\n\t//TODO: maybe can do this async if it gets more complex?\n\n\tconst selection = selectionData.selection;\n\tlet selectedParentStart = selection.anchorNode?.parentNode as Node | null;\n\tlet selectedParentEnd = selection.focusNode?.parentNode as Node | null;\n\n\tif (!selectedParentStart || !selectedParentEnd) {\n\t\treturn false;\n\t}\n\n\tif (selectedParentStart.nodeName === \"MARK\") {\n\t\tselectedParentStart = selectedParentStart.parentNode;\n\t\tif (!selectedParentStart) return false;\n\t}\n\n\tif (selectedParentEnd.nodeName === \"MARK\") {\n\t\tselectedParentEnd = selectedParentEnd.parentNode;\n\t\tif (!selectedParentEnd) return false;\n\t}\n\n\tif (selectedParentStart.nodeName !== \"SPAN\" || selectedParentEnd.nodeName !== \"SPAN\") return false;\n\n\tconst divTextLayerParent = selectedParentStart.parentNode;\n\tif (!!!divTextLayerParent || divTextLayerParent.nodeName !== \"DIV\") return false;\n\n\tconst spanChildren = Array.from(divTextLayerParent.childNodes) as Node[];\n\tif (spanChildren.length === 0) return false;\n\n\tconst startIndex = spanChildren.indexOf(selectedParentStart);\n\tconst endIndex = spanChildren.indexOf(selectedParentEnd);\n\tif (startIndex === -1 || endIndex === -1) return false;\n\n\treturn {\n\t\tcontentStr: selectionData.text,\n\t\tcontentOrigin: { spanIndexStart: startIndex, spanIndexEnd: endIndex, page },\n\t};\n};\n\nexport const getSelectionSourceFromMaterial = (page: number): SelectionSourceConfig | false => {\n\tconst selectionData = getSelectionWorkaround();\n\tif (!selectionData) return false;\n\n\treturn materialSelectionDataToSourceConfig(selectionData, page);\n};\n\nexport const getSelectionSourceFromCard = (contentOrigin?: SingleOrigin): SelectionSourceConfig | false => {\n\tconst selectionData = getSelectionWorkaround();\n\tif (!selectionData) return false;\n\n\treturn { contentStr: selectionData.text, contentOrigin };\n};\n","import * as t from \"./actionTypes\";\nimport { SingleOrigin } from \"../cards/model/origin\";\nimport { SelectionSourceConfig, SelectionGoalConfig, SelectionExistingCardGoalConfig } from \"./model\";\nimport { Dispatch } from \"redux\";\nimport { getGoalConfig, getSourceConfig } from \"./selectors\";\nimport { selectionToCard } from \"./services/use-selection\";\nimport { getSelectionSourceFromMaterial, getSelectionSourceFromCard } from \"./services/get-selection\";\nimport { CardID } from \"../cards/model/config\";\nimport { CardField } from \"../cards/model/content\";\nimport { ClayMemoryPayloadAction } from \"../../shared/utils\";\n\nconst setSelectionSource = (config: SelectionSourceConfig): ClayMemoryPayloadAction => {\n\treturn { type: t.SELECTION_SOURCE, payload: config };\n};\nexport const resetSelectionSource = (): ClayMemoryPayloadAction => {\n\treturn { type: t.SELECTION_SOURCE, payload: null };\n};\nconst setSelectionGoal = (config: SelectionGoalConfig): ClayMemoryPayloadAction => {\n\treturn { type: t.SELECTION_GOAL, payload: config };\n};\nexport const resetSelectionGoal = (): ClayMemoryPayloadAction => {\n\treturn { type: t.SELECTION_GOAL, payload: null };\n};\n\n// we want to support either direction, first adding Goal or first adding Source\nexport const addSelectionSource = (config: SelectionSourceConfig) => {\n\treturn (dispatch: Dispatch, getState: Function) => {\n\t\tconst state = getState();\n\t\tconst goalConfig = getGoalConfig(state);\n\t\tif (!goalConfig) {\n\t\t\tdispatch(setSelectionSource(config));\n\t\t\treturn;\n\t\t}\n\t\tselectionToCard(config, goalConfig as SelectionGoalConfig, dispatch, state);\n\t\tdispatch(resetSelectionGoal());\n\t};\n};\n\nexport const addMaterialSelectionSource = (page: number) => {\n\tconst sourceConfig = getSelectionSourceFromMaterial(page);\n\tif (sourceConfig) {\n\t\treturn addSelectionSource(sourceConfig);\n\t}\n\treturn false;\n};\n\nexport const addCardSelectionSource = (contentOrigin?: SingleOrigin) => {\n\tconst sourceConfig = getSelectionSourceFromCard(contentOrigin);\n\tif (sourceConfig) {\n\t\treturn addSelectionSource(sourceConfig);\n\t}\n\treturn false;\n};\n\nexport const addSelectionGoal = (config: SelectionGoalConfig) => {\n\treturn (dispatch: Dispatch, getState: Function) => {\n\t\tconst state = getState();\n\t\tconst sourceConfig = getSourceConfig(state);\n\t\tif (!sourceConfig) {\n\t\t\tdispatch(setSelectionGoal(config));\n\t\t\treturn;\n\t\t}\n\t\tselectionToCard(sourceConfig as SelectionSourceConfig, config, dispatch, state);\n\t\tdispatch(resetSelectionSource());\n\t};\n};\n\nexport const addCardAppendSelectionGoal = (cardID: CardID, cardField: CardField) => {\n\tconst config: SelectionExistingCardGoalConfig = { cardID, cardField, updateType: \"APPEND\" };\n\treturn addSelectionGoal(config);\n};\n\nexport const addCardReplaceSelectionGoal = (cardID: CardID, cardField: CardField) => {\n\tconst config: SelectionExistingCardGoalConfig = { cardID, cardField, updateType: \"REPLACE\" };\n\treturn addSelectionGoal(config);\n};\n","import { ClayMemoryPayloadAction } from \"../../shared/utils\";\nimport * as t from \"./actionTypes\";\nimport { SelectionData } from \"./model\";\n\nconst initialState: SelectionData = {\n\tsourceConfig: null,\n\tgoalConfig: null,\n};\n\nconst selectionData = (state = initialState, { type, payload }: ClayMemoryPayloadAction): SelectionData => {\n\tswitch (type) {\n\t\tcase t.SELECTION_SOURCE:\n\t\t\treturn { ...state, sourceConfig: payload };\n\t\tcase t.SELECTION_GOAL:\n\t\t\treturn { ...state, goalConfig: payload };\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n\nexport default selectionData;\n","import React, { useState, useEffect } from \"react\";\nimport { Snackbar, IconButton, Typography, Card, Grid, Divider } from \"@material-ui/core\";\nimport CloseIcon from \"@material-ui/icons/Close\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { resetSelectionSource } from \"../actions\";\nimport { getSourceConfig } from \"../selectors\";\n\nexport const SelectionSnackbar = () => {\n\tconst [open, setOpen] = useState(false);\n\tconst dispatch = useDispatch();\n\tconst sourceConfig = useSelector(getSourceConfig);\n\n\tif (!!!sourceConfig && open) setOpen(false);\n\n\tif (!!sourceConfig && !open) setOpen(true);\n\n\tconst handleClose = (event: any, reason: string) => {\n\t\tif (reason === \"clickaway\") {\n\t\t\t// do not close on clickaway\n\t\t\tevent.preventDefault();\n\t\t} else {\n\t\t\tsetOpen(false);\n\t\t\tdispatch(resetSelectionSource());\n\t\t}\n\t};\n\n\tconst handleDismiss = () => {\n\t\tsetOpen(false);\n\t\tdispatch(resetSelectionSource());\n\t};\n\n\tconst escPress = (event: KeyboardEvent) => {\n\t\tif (open && (event.key === \"Escape\" || event.key === \"Esc\")) {\n\t\t\thandleDismiss();\n\t\t}\n\t};\n\n\tuseEffect(() => {\n\t\tdocument.addEventListener(\"keydown\", escPress);\n\t\treturn () => {\n\t\t\tdocument.removeEventListener(\"keydown\", escPress);\n\t\t};\n\t});\n\n\treturn (\n\t\t<Snackbar\n\t\t\tstyle={{ maxWidth: \"400px\", overflowX: \"auto\" }}\n\t\t\tanchorOrigin={{ vertical: \"top\", horizontal: \"center\" }}\n\t\t\topen={open}\n\t\t\tonClose={handleClose}\n\t\t\tmessage={\n\t\t\t\t<Grid container direction=\"row\" spacing={1}>\n\t\t\t\t\t<Grid item>\n\t\t\t\t\t\t<Card\n\t\t\t\t\t\t\tvariant=\"outlined\"\n\t\t\t\t\t\t\tcolor=\"secondary\"\n\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\tpadding: \"4px\",\n\t\t\t\t\t\t\t\tcolor: \"white\",\n\t\t\t\t\t\t\t\tbackgroundColor: \"#3f51b5\",\n\t\t\t\t\t\t\t\tmaxWidth: \"400px\",\n\t\t\t\t\t\t\t\toverflowX: \"auto\",\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tsquare={true}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Typography variant=\"h4\">{\"Selection:\"}</Typography>\n\t\t\t\t\t\t</Card>\n\n\t\t\t\t\t\t<Card variant=\"outlined\" style={{ padding: \"4px\", color: \"black\", backgroundColor: \"white\" }} square={true}>\n\t\t\t\t\t\t\t<Typography variant=\"body1\">{sourceConfig?.contentStr}</Typography>\n\t\t\t\t\t\t</Card>\n\t\t\t\t\t</Grid>\n\n\t\t\t\t\t{sourceConfig?.contentOrigin && (\n\t\t\t\t\t\t<Grid item>\n\t\t\t\t\t\t\t<Card\n\t\t\t\t\t\t\t\tvariant=\"outlined\"\n\t\t\t\t\t\t\t\tcolor=\"secondary\"\n\t\t\t\t\t\t\t\tstyle={{ padding: \"4px\", color: \"black\", backgroundColor: \"white\" }}\n\t\t\t\t\t\t\t\tsquare={true}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Typography variant=\"h4\">{\"Origin:\"}</Typography>\n\t\t\t\t\t\t\t</Card>\n\n\t\t\t\t\t\t\t<Card\n\t\t\t\t\t\t\t\tvariant=\"outlined\"\n\t\t\t\t\t\t\t\tstyle={{ padding: \"4px\", color: \"white\", backgroundColor: \"#3f51b5\" }}\n\t\t\t\t\t\t\t\tsquare={true}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Typography variant=\"body1\">Page {sourceConfig.contentOrigin.page}</Typography>\n\t\t\t\t\t\t\t</Card>\n\t\t\t\t\t\t</Grid>\n\t\t\t\t\t)}\n\t\t\t\t</Grid>\n\t\t\t}\n\t\t\taction={\n\t\t\t\t<IconButton size=\"small\" aria-label=\"close\" color=\"inherit\" onClick={handleDismiss}>\n\t\t\t\t\t<CloseIcon fontSize=\"small\" />\n\t\t\t\t</IconButton>\n\t\t\t}\n\t\t/>\n\t);\n};\n","import React, { ReactNode } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { addMaterialSelectionSource } from \"../actions\";\n\n// should only be used once material/pdf exists\nexport const MaterialMouseUp = ({ children, page }: { children: ReactNode; page: number }) => {\n\tconst dispatch = useDispatch();\n\n\treturn (\n\t\t<span\n\t\t\tonMouseUp={() => {\n\t\t\t\tconst materialSelectionSourceAction = addMaterialSelectionSource(page);\n\t\t\t\tif (materialSelectionSourceAction) dispatch(materialSelectionSourceAction);\n\t\t\t}}\n\t\t\tonMouseDown={(event: React.MouseEvent<any>) => {\n\t\t\t\t// without this it is possible so have something selected\n\t\t\t\t// close the selection-snackbar\n\t\t\t\t// it stays selected (only on click inside text it woud de-select)\n\t\t\t\t// then press the mouse and\n\t\t\t\t// the selection-snackbar pops back up\n\t\t\t\t// even though it is not a new selection just the old one\n\t\t\t\tif (event.button === 0) window.getSelection()?.empty();\n\t\t\t}}\n\t\t>\n\t\t\t{children}\n\t\t</span>\n\t);\n};\n","import React, { ReactNode } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { addCardSelectionSource } from \"../actions\";\nimport { SingleOrigin } from \"../../cards/model/origin\";\n\nexport const CardFieldMouseUp = ({ children, fieldOrigin }: { children: ReactNode; fieldOrigin?: SingleOrigin }) => {\n\tconst dispatch = useDispatch();\n\n\treturn (\n\t\t<span\n\t\t\tonMouseUp={() => {\n\t\t\t\tconst cardSelectionSourceAction = addCardSelectionSource(fieldOrigin);\n\t\t\t\tif (cardSelectionSourceAction) dispatch(cardSelectionSourceAction);\n\t\t\t}}\n\t\t>\n\t\t\t{children}\n\t\t</span>\n\t);\n};\n","import AddCircleOutlineIcon from \"@material-ui/icons/AddCircleOutline\";\nimport AddCircleOutlinedIcon from \"@material-ui/icons/AddCircleOutlined\";\nimport React, { useState } from \"react\";\nimport { IconButton, Tooltip } from \"@material-ui/core\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport text from \"../../text\";\nimport { getGoalConfig, getSourceConfig } from \"../selectors\";\nimport { addCardAppendSelectionGoal, resetSelectionGoal } from \"../actions\";\nimport { SelectionExistingCardGoalConfig, CardFieldIdentifier } from \"../model\";\nimport { CardField } from \"../../cards/model/content\";\n\nexport const AppendButton = ({ cardField, cardID }: { cardField: CardField; cardID: string }) => {\n\tconst dispatch = useDispatch();\n\n\tconst sourceConfig = useSelector(getSourceConfig);\n\tconst goalConfig = useSelector(getGoalConfig);\n\t// outlined means this is the goal\n\tconst [outlined, setOutlined] = useState(false);\n\n\tconst isGoal =\n\t\t!!goalConfig &&\n\t\t!!(goalConfig as CardFieldIdentifier).cardID &&\n\t\t(goalConfig as CardFieldIdentifier).cardID === cardID &&\n\t\tgoalConfig.cardField === cardField &&\n\t\t(goalConfig as SelectionExistingCardGoalConfig).updateType === \"APPEND\";\n\n\tif (isGoal) {\n\t\tif (!outlined) setOutlined(true);\n\t} else {\n\t\tif (outlined) setOutlined(false);\n\t}\n\t//TODO: test all variations of origin  (setting/copying) again (how to automate the test?)\n\n\treturn (\n\t\t<Tooltip\n\t\t\ttitle={\n\t\t\t\tisGoal\n\t\t\t\t\t? text.constants.CardIsAppendGoalTooltip\n\t\t\t\t\t: !!sourceConfig\n\t\t\t\t\t? text.constants.AppendToCardTooltip\n\t\t\t\t\t: text.constants.ChoiceCardAsAppendGoal\n\t\t\t}\n\t\t\tenterDelay={text.constants.defaultEnterDelay}\n\t\t\tenterNextDelay={text.constants.defaultEnterNextDelay}\n\t\t>\n\t\t\t<IconButton\n\t\t\t\ttype=\"button\"\n\t\t\t\tonClick={() => {\n\t\t\t\t\tif (!outlined && !!!goalConfig) {\n\t\t\t\t\t\tdispatch(addCardAppendSelectionGoal(cardID, cardField));\n\t\t\t\t\t} else if (isGoal) {\n\t\t\t\t\t\tdispatch(resetSelectionGoal());\n\t\t\t\t\t}\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t{outlined ? (\n\t\t\t\t\t<AddCircleOutlinedIcon fontSize=\"small\"></AddCircleOutlinedIcon>\n\t\t\t\t) : (\n\t\t\t\t\t<AddCircleOutlineIcon fontSize=\"small\"></AddCircleOutlineIcon>\n\t\t\t\t)}\n\t\t\t</IconButton>\n\t\t</Tooltip>\n\t);\n};\n","import React, { RefObject, useCallback, useEffect, useRef, useState } from \"react\";\nimport Menu from \"@material-ui/core/Menu\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { Divider, MenuItem } from \"@material-ui/core\";\nimport { addSelectionGoal } from \"../actions\";\nimport { sourceConfigExists } from \"../selectors\";\n\n// the root div for the menu invisibly covers the whole screen\n// the actual div that is visible is this\nconst baseContextMenuSelector = \"div.MuiPaper-root\";\nconst contextMenuContainsTargetNode = (ref: RefObject<null | HTMLDivElement>, event: MouseEvent) => {\n\tconst target = event.target as Node;\n\tif (ref.current?.querySelector(baseContextMenuSelector)?.contains(target)) return true;\n\treturn false;\n};\n\nexport const ContextMenu = () => {\n\tconst [menuPosition, setMenuPosition] = useState<undefined | { top: number; left: number }>(undefined);\n\tconst ref = useRef(null);\n\n\tconst shouldClose = useCallback(\n\t\t(event: MouseEvent) => {\n\t\t\tconst clickOutSideOfMenu = !contextMenuContainsTargetNode(ref, event);\n\t\t\tif (clickOutSideOfMenu) {\n\t\t\t\tsetMenuPosition(undefined);\n\t\t\t}\n\t\t},\n\t\t[ref, setMenuPosition]\n\t);\n\tuseEffect(() => {\n\t\tdocument.addEventListener(\"mousedown\", shouldClose);\n\t\treturn () => {\n\t\t\tdocument.removeEventListener(\"mousedown\", shouldClose);\n\t\t};\n\t}, [shouldClose]);\n\n\tconst doesSourceConfigExists = useSelector(sourceConfigExists);\n\tconst shouldOpen = useCallback(\n\t\t(event: MouseEvent) => {\n\t\t\tif (!doesSourceConfigExists) return;\n\n\t\t\tevent.preventDefault();\n\n\t\t\tsetMenuPosition({ left: event.x, top: event.y });\n\t\t},\n\t\t[doesSourceConfigExists, setMenuPosition]\n\t);\n\tuseEffect(() => {\n\t\tdocument.addEventListener(\"contextmenu\", shouldOpen);\n\t\treturn () => {\n\t\t\tdocument.removeEventListener(\"contextmenu\", shouldOpen);\n\t\t};\n\t}, [shouldOpen]);\n\n\tconst openState = !!menuPosition;\n\n\tconst dispatch = useDispatch();\n\n\treturn (\n\t\t<Menu ref={ref} keepMounted open={openState} anchorReference=\"anchorPosition\" anchorPosition={menuPosition}>\n\t\t\t<MenuItem\n\t\t\t\tonClick={() => {\n\t\t\t\t\tdispatch(addSelectionGoal({ cardField: \"note\", updateType: \"REPLACE\" }));\n\t\t\t\t\tsetMenuPosition(undefined);\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\tNew: Note\n\t\t\t</MenuItem>\n\n\t\t\t<Divider></Divider>\n\t\t\t<MenuItem\n\t\t\t\tonClick={() => {\n\t\t\t\t\tdispatch(addSelectionGoal({ cardField: \"q\", updateType: \"REPLACE\" }));\n\t\t\t\t\tsetMenuPosition(undefined);\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\tNew: Q (Q-A)\n\t\t\t</MenuItem>\n\t\t\t<MenuItem\n\t\t\t\tonClick={() => {\n\t\t\t\t\tdispatch(addSelectionGoal({ cardField: \"a\", updateType: \"REPLACE\" }));\n\t\t\t\t\tsetMenuPosition(undefined);\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\tNew: A (Q-A)\n\t\t\t</MenuItem>\n\t\t</Menu>\n\t);\n};\n\n//TODO: delete extracted str in source\n","import RestorePageIcon from \"@material-ui/icons/RestorePage\";\nimport RestorePageOutlinedIcon from \"@material-ui/icons/RestorePageOutlined\";\nimport React, { useState } from \"react\";\nimport { IconButton, Tooltip } from \"@material-ui/core\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport text from \"../../text\";\nimport { getGoalConfig, getSourceConfig } from \"../selectors\";\nimport { addCardReplaceSelectionGoal, resetSelectionGoal } from \"../actions\";\nimport { SelectionExistingCardGoalConfig, CardFieldIdentifier } from \"../model\";\nimport { CardField } from \"../../cards/model/content\";\n\nexport const ReplaceButton = ({ cardField, cardID }: { cardField: CardField; cardID: string }) => {\n\tconst dispatch = useDispatch();\n\n\tconst sourceConfig = useSelector(getSourceConfig);\n\tconst goalConfig = useSelector(getGoalConfig);\n\t// outlined means this is the goal\n\tconst [outlined, setOutlined] = useState(false);\n\n\tconst isGoal =\n\t\t!!goalConfig &&\n\t\t!!(goalConfig as CardFieldIdentifier).cardID &&\n\t\t(goalConfig as CardFieldIdentifier).cardID === cardID &&\n\t\tgoalConfig.cardField === cardField &&\n\t\t(goalConfig as SelectionExistingCardGoalConfig).updateType === \"REPLACE\";\n\n\tif (isGoal) {\n\t\tif (!outlined) setOutlined(true);\n\t} else {\n\t\tif (outlined) setOutlined(false);\n\t}\n\n\treturn (\n\t\t<Tooltip\n\t\t\ttitle={\n\t\t\t\tisGoal\n\t\t\t\t\t? text.constants.CardIsReplaceGoalTooltip\n\t\t\t\t\t: !!sourceConfig\n\t\t\t\t\t? text.constants.ReplaceCardTooltip\n\t\t\t\t\t: text.constants.ChoiceCardAsReplaceGoal\n\t\t\t}\n\t\t\tenterDelay={text.constants.defaultEnterDelay}\n\t\t\tenterNextDelay={text.constants.defaultEnterNextDelay}\n\t\t>\n\t\t\t<IconButton\n\t\t\t\ttype=\"button\"\n\t\t\t\tonClick={() => {\n\t\t\t\t\tif (!outlined && !!!goalConfig) {\n\t\t\t\t\t\tdispatch(addCardReplaceSelectionGoal(cardID, cardField));\n\t\t\t\t\t} else if (isGoal) {\n\t\t\t\t\t\tdispatch(resetSelectionGoal());\n\t\t\t\t\t}\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t{outlined ? (\n\t\t\t\t\t<RestorePageIcon fontSize=\"small\"></RestorePageIcon>\n\t\t\t\t) : (\n\t\t\t\t\t<RestorePageOutlinedIcon fontSize=\"small\"></RestorePageOutlinedIcon>\n\t\t\t\t)}\n\t\t\t</IconButton>\n\t\t</Tooltip>\n\t);\n};\n","import * as actions from \"./actions\";\nimport * as constants from \"./constants\";\nimport * as actionTypes from \"./actionTypes\";\nimport reducer from \"./reducer\";\nimport * as selectors from \"./selectors\";\nimport * as components from \"./components\";\nimport * as services from \"./services\";\n\nexport default { actions, actionTypes, constants, components, reducer, selectors, services };\n","import React, { useState } from \"react\";\nimport { TextField, TextFieldProps } from \"@material-ui/core\";\nimport selection from \"../../../../selection\";\nimport { SingleOrigin } from \"../../../../cards/model/origin\";\n\nexport const ClayCardField = ({\n\tstoreValue = \"\",\n\tsaveChanges,\n\tfieldOrigin,\n\tstyle,\n\t...rest\n}: {\n\tstoreValue?: string;\n\t// {} is an empty field of the QA-origin\n\tfieldOrigin?: SingleOrigin | {};\n\tsaveChanges: (value: string) => void;\n\tstyle: any;\n} & TextFieldProps) => {\n\tconst [state, setState] = useState({ storeValue, mutableValue: storeValue });\n\n\t// reset if new storeValue, otherwise keep user-mutated value\n\tif (state.storeValue !== storeValue) {\n\t\tsetState({ storeValue, mutableValue: storeValue });\n\t}\n\n\t// need the onChange-pattern, because we want to be able to pre-fill the field from the store\n\treturn (\n\t\t<selection.components.CardFieldMouseUp\n\t\t\tfieldOrigin={\n\t\t\t\tfieldOrigin && (fieldOrigin as SingleOrigin).spanIndexStart !== undefined\n\t\t\t\t\t? (fieldOrigin as SingleOrigin)\n\t\t\t\t\t: undefined\n\t\t\t}\n\t\t>\n\t\t\t<TextField\n\t\t\t\tInputProps={{ disableUnderline: true, style: { minWidth: \"400px\" } }}\n\t\t\t\tmultiline\n\t\t\t\tvariant=\"filled\"\n\t\t\t\tvalue={state.mutableValue}\n\t\t\t\tonChange={(event) => {\n\t\t\t\t\tconst submittedValue = (event.target as HTMLTextAreaElement).value;\n\t\t\t\t\tsetState({ ...state, mutableValue: submittedValue });\n\t\t\t\t}}\n\t\t\t\tonBlur={(event: any) => {\n\t\t\t\t\tsaveChanges(event.target.value);\n\t\t\t\t}}\n\t\t\t\tstyle={style}\n\t\t\t\t{...rest}\n\t\t\t></TextField>\n\t\t</selection.components.CardFieldMouseUp>\n\t);\n};\n","import FindInPageIcon from \"@material-ui/icons/FindInPage\";\nimport React from \"react\";\nimport { IconButton, Tooltip } from \"@material-ui/core\";\nimport { useDispatch } from \"react-redux\";\nimport { SingleOrigin } from \"../../../../cards/model/origin\";\nimport text from \"../../../../text\";\nimport { setOriginRequest } from \"../../../actions\";\n\nexport const JumpToOriginButton = ({ cardOrigin }: { cardOrigin: SingleOrigin }) => {\n\tconst dispatch = useDispatch();\n\treturn (\n\t\t<Tooltip\n\t\t\ttitle={text.constants.jumpToOriginTooltip}\n\t\t\tenterDelay={text.constants.defaultEnterDelay}\n\t\t\tenterNextDelay={text.constants.defaultEnterNextDelay}\n\t\t>\n\t\t\t<IconButton\n\t\t\t\ttype=\"button\"\n\t\t\t\tonClick={() => {\n\t\t\t\t\tdispatch(setOriginRequest(cardOrigin));\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<FindInPageIcon fontSize=\"small\"></FindInPageIcon>\n\t\t\t</IconButton>\n\t\t</Tooltip>\n\t);\n};\n","import React from \"react\";\nimport cards from \"../../../../cards\";\nimport { JumpToOriginButton } from \"./JumpToOriginButton\";\nimport { Paper, Grid } from \"@material-ui/core\";\nimport { CardConfig } from \"../../../../cards/model/config\";\nimport { CardField } from \"../../../../cards/model/content\";\nimport selection from \"../../../../selection\";\nimport { SingleOrigin } from \"../../../../cards/model/origin\";\n\nexport const ClayCardFieldButtons = ({ config, cardField }: { config: CardConfig; cardField: CardField }) => {\n\tconst origin: SingleOrigin | null = config.origin\n\t\t? cards.model.permutation.toFieldValue(cardField, config.origin)\n\t\t: null;\n\tconst originExists = origin?.page !== undefined;\n\treturn (\n\t\t<Paper variant=\"outlined\">\n\t\t\t<Grid container direction=\"row\">\n\t\t\t\t<Grid item>\n\t\t\t\t\t<selection.components.AppendButton\n\t\t\t\t\t\tcardID={config.cardID}\n\t\t\t\t\t\tcardField={cardField}\n\t\t\t\t\t></selection.components.AppendButton>\n\t\t\t\t</Grid>\n\n\t\t\t\t<Grid item>\n\t\t\t\t\t<selection.components.ReplaceButton\n\t\t\t\t\t\tcardID={config.cardID}\n\t\t\t\t\t\tcardField={cardField}\n\t\t\t\t\t></selection.components.ReplaceButton>\n\t\t\t\t</Grid>\n\n\t\t\t\t<Grid item>\n\t\t\t\t\t{originExists && <JumpToOriginButton cardOrigin={origin as SingleOrigin}></JumpToOriginButton>}\n\t\t\t\t</Grid>\n\t\t\t</Grid>\n\t\t</Paper>\n\t);\n};\n","import Grid from \"@material-ui/core/Grid\";\nimport React from \"react\";\nimport { ClayCardField } from \"./ClayCardField\";\nimport { QACardContent } from \"../../../../cards/model/content\";\nimport { useDispatch } from \"react-redux\";\nimport cards from \"../../../../cards\";\nimport { Card } from \"@material-ui/core\";\nimport text from \"../../../../text\";\nimport { ClayCardFieldButtons } from \"./ClayCardFieldButtons\";\nimport { QAConfig } from \"../../../../cards/model/config\";\n\n//TODO: use dark color pallet (theme?)\n\nexport const QACard = ({ config }: { config: QAConfig }) => {\n\tconst dispatch = useDispatch();\n\n\treturn (\n\t\t<Card variant=\"elevation\" elevation={5} style={{ padding: \"3px\" }}>\n\t\t\t<Grid container direction=\"row\" justify=\"space-between\">\n\t\t\t\t<Grid item>\n\t\t\t\t\t<Grid container direction=\"column\" spacing={1}>\n\t\t\t\t\t\t<Grid item>\n\t\t\t\t\t\t\t<Grid container direction=\"row\" spacing={1}>\n\t\t\t\t\t\t\t\t<Grid item>\n\t\t\t\t\t\t\t\t\t<ClayCardField\n\t\t\t\t\t\t\t\t\t\tsaveChanges={(value) => {\n\t\t\t\t\t\t\t\t\t\t\tdispatch(cards.actions.replaceCardFieldContent(\"q\", config, value));\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\tstoreValue={(config.content as QACardContent).q}\n\t\t\t\t\t\t\t\t\t\tlabel={text.constants.questionText}\n\t\t\t\t\t\t\t\t\t\tvariant=\"filled\"\n\t\t\t\t\t\t\t\t\t\tstyle={{ backgroundColor: \"#FFBF69\" }}\n\t\t\t\t\t\t\t\t\t\tInputLabelProps={{ style: { color: \"#000000\" } }}\n\t\t\t\t\t\t\t\t\t\tfieldOrigin={config.origin?.q}\n\t\t\t\t\t\t\t\t\t></ClayCardField>\n\t\t\t\t\t\t\t\t</Grid>\n\n\t\t\t\t\t\t\t\t<Grid item>\n\t\t\t\t\t\t\t\t\t<ClayCardFieldButtons cardField=\"q\" config={config}></ClayCardFieldButtons>\n\t\t\t\t\t\t\t\t</Grid>\n\t\t\t\t\t\t\t</Grid>\n\t\t\t\t\t\t</Grid>\n\t\t\t\t\t\t<Grid item>\n\t\t\t\t\t\t\t<Grid container direction=\"row\" spacing={1}>\n\t\t\t\t\t\t\t\t<Grid item>\n\t\t\t\t\t\t\t\t\t<ClayCardField\n\t\t\t\t\t\t\t\t\t\tsaveChanges={(value) => {\n\t\t\t\t\t\t\t\t\t\t\tdispatch(cards.actions.replaceCardFieldContent(\"a\", config, value));\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\tstoreValue={(config.content as QACardContent).a}\n\t\t\t\t\t\t\t\t\t\tlabel={text.constants.answerText}\n\t\t\t\t\t\t\t\t\t\tstyle={{ backgroundColor: \"#2EC4B6\" }}\n\t\t\t\t\t\t\t\t\t\tInputLabelProps={{ style: { color: \"#000000\" } }}\n\t\t\t\t\t\t\t\t\t\tfieldOrigin={config.origin?.a}\n\t\t\t\t\t\t\t\t\t></ClayCardField>\n\t\t\t\t\t\t\t\t</Grid>\n\t\t\t\t\t\t\t\t<Grid item>\n\t\t\t\t\t\t\t\t\t<ClayCardFieldButtons cardField=\"a\" config={config}></ClayCardFieldButtons>\n\t\t\t\t\t\t\t\t</Grid>\n\t\t\t\t\t\t\t</Grid>\n\t\t\t\t\t\t</Grid>\n\t\t\t\t\t</Grid>\n\t\t\t\t</Grid>\n\n\t\t\t\t<Grid item>\n\t\t\t\t\t<cards.components.DeleteCardButton cardID={config.cardID}></cards.components.DeleteCardButton>\n\t\t\t\t</Grid>\n\t\t\t</Grid>\n\t\t</Card>\n\t);\n};\n","import React from \"react\";\nimport { ClayCardField } from \"./ClayCardField\";\nimport { useDispatch } from \"react-redux\";\nimport cards from \"../../../../cards\";\nimport { Card, Grid } from \"@material-ui/core\";\nimport text from \"../../../../text\";\nimport { NoteConfig } from \"../../../../cards/model/config\";\nimport { ClayCardFieldButtons } from \"./ClayCardFieldButtons\";\n\nexport const NoteCard = ({ config }: { config: NoteConfig }) => {\n\tconst dispatch = useDispatch();\n\n\treturn (\n\t\t<Card variant=\"elevation\" elevation={5} style={{ padding: \"3px\" }}>\n\t\t\t<Grid container direction=\"row\" justify=\"space-between\">\n\t\t\t\t<Grid item>\n\t\t\t\t\t<Grid container direction=\"row\" spacing={1}>\n\t\t\t\t\t\t<Grid item>\n\t\t\t\t\t\t\t<ClayCardField\n\t\t\t\t\t\t\t\tsaveChanges={(value) => {\n\t\t\t\t\t\t\t\t\tdispatch(cards.actions.cardReplace({ ...config, content: value } as NoteConfig));\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\tstoreValue={config.content as string}\n\t\t\t\t\t\t\t\tlabel={text.constants.noteText}\n\t\t\t\t\t\t\t\tvariant=\"filled\"\n\t\t\t\t\t\t\t\tstyle={{ backgroundColor: \"#CBF3F0\" }}\n\t\t\t\t\t\t\t\tInputLabelProps={{ style: { color: \"#000000\" } }}\n\t\t\t\t\t\t\t\tfieldOrigin={config.origin}\n\t\t\t\t\t\t\t></ClayCardField>\n\t\t\t\t\t\t</Grid>\n\t\t\t\t\t\t<Grid item>\n\t\t\t\t\t\t\t<ClayCardFieldButtons cardField=\"note\" config={config}></ClayCardFieldButtons>\n\t\t\t\t\t\t</Grid>\n\t\t\t\t\t</Grid>\n\t\t\t\t</Grid>\n\n\t\t\t\t<Grid item>\n\t\t\t\t\t<cards.components.DeleteCardButton cardID={config.cardID}></cards.components.DeleteCardButton>\n\t\t\t\t</Grid>\n\t\t\t</Grid>\n\t\t</Card>\n\t);\n};\n","import React from \"react\";\nimport { CardConfig, NoteConfig, QAConfig } from \"../../../../cards/model/config\";\nimport { QACard } from \"./QACard\";\nimport { NoteCard } from \"./NoteCard\";\n\nexport const ClayCard = ({ config }: { config: CardConfig }) => {\n\tswitch (config.type) {\n\t\tcase \"Note\":\n\t\t\treturn <NoteCard config={config as NoteConfig}></NoteCard>;\n\t\tcase \"Q-A\":\n\t\t\treturn <QACard config={config as QAConfig}></QACard>;\n\t}\n};\n","import Grid from \"@material-ui/core/Grid\";\nimport React from \"react\";\nimport { incrementer } from \"../../../../shared/utils\";\nimport { ClayCard } from \"./Cards/ClayCard\";\nimport { CardConfig } from \"../../../cards/model/config\";\nimport { Divider } from \"@material-ui/core\";\n\nconst GridItemDivider = () => (\n\t<Grid item>\n\t\t<Divider></Divider>\n\t</Grid>\n);\n\nexport const ClayCardGridItems = (cards: CardConfig[]) => {\n\tconst increment = incrementer();\n\n\treturn cards.reduce((prev, currentCard, index, arr) => {\n\t\tprev.push(\n\t\t\t<Grid item key={increment()}>\n\t\t\t\t<ClayCard config={currentCard} key={increment()}></ClayCard>\n\t\t\t</Grid>\n\t\t);\n\n\t\tconst notLastCard = index < arr.length - 1;\n\t\tif (notLastCard) prev.push(<GridItemDivider key={increment()}></GridItemDivider>);\n\t\treturn prev;\n\t}, [] as any[]);\n};\n","import cards from \"../../cards\";\nimport { CardConfig, NoteConfig, QAConfig } from \"../../cards/model/config\";\nimport { RiverContentState } from \"../model\";\nimport { combineFilterArr, Filter } from \"../../../shared/utils\";\n\n//TODO: make it not be accordion but closeable?\n//TODO: make local show / hide notes\nconst qaFilter: Filter = (config: CardConfig) => config.type === \"Q-A\";\nconst noteFilter: Filter = (config: CardConfig) => config.type === \"Note\";\nconst contentFilter: (contentStr: string) => Filter = (contentFilterStr: string) => (config: CardConfig) => {\n\tswitch (config.type) {\n\t\tcase \"Note\":\n\t\t\treturn cards.model.content.noteContentContainsStringOrEmpty(config as NoteConfig, contentFilterStr);\n\t\tcase \"Q-A\":\n\t\t\treturn cards.model.content.qaContentContainsStringOrEmpty(config as QAConfig, contentFilterStr);\n\t}\n};\n\nexport const filterCardConfigs = (\n\tinputCards: CardConfig[],\n\triverContentState: RiverContentState,\n\tcontentFilterStr: string\n): CardConfig[] => {\n\tif (riverContentState === \"NONE\") {\n\t\treturn [];\n\t}\n\n\tconst filters: Filter[] = [];\n\n\tif (riverContentState !== \"ALL\") {\n\t\tif (riverContentState === \"QAS\") {\n\t\t\tfilters.push(qaFilter);\n\t\t} else if (riverContentState === \"NOTES\") {\n\t\t\tfilters.push(noteFilter);\n\t\t}\n\t}\n\tif (contentFilterStr !== \"\") {\n\t\tfilters.push(contentFilter(contentFilterStr));\n\t}\n\n\treturn filters.length > 0 ? inputCards.filter(combineFilterArr(filters)) : inputCards;\n};\n","import { Typography, Divider } from \"@material-ui/core\";\nimport Accordion from \"@material-ui/core/Accordion\";\nimport AccordionSummary from \"@material-ui/core/AccordionSummary\";\nimport AccordionDetails from \"@material-ui/core/AccordionDetails\";\nimport Grid from \"@material-ui/core/Grid\";\nimport React from \"react\";\nimport { useSelector } from \"react-redux\";\nimport { getRiverContentState, getRiverContentFilter, getRiverMakeUps } from \"../../selectors\";\nimport cards from \"../../../cards\";\nimport { ClayCardGridItems } from \"./ClayCardGridItems\";\nimport { filterCardConfigs } from \"../../services/filterCardConfigs\";\n\nexport const CardRiver = ({ riverID, materialHeight }: { riverID: string; materialHeight: number }) => {\n\tconst cardConfigs = useSelector(cards.selectors.getCards);\n\n\tconst riverMakeUp = useSelector(getRiverMakeUps)[riverID];\n\tconsole.log(cardConfigs);\n\tconst riverCards = riverMakeUp ? riverMakeUp.cardIDs.map((id) => cardConfigs[id]) : [];\n\tconst riverContentState = useSelector(getRiverContentState);\n\t//TODO: use regex for upper/lower-case\n\tconst contentFilter = useSelector(getRiverContentFilter);\n\n\tconst filteredConfigs = filterCardConfigs(riverCards, riverContentState, contentFilter);\n\tconst gridItems = ClayCardGridItems(filteredConfigs);\n\n\t//TODO: if you start without any document and then load one, the current cards should be merged into that one\n\t//TODO: scroll-to-top for overflowing river\n\n\treturn (\n\t\t<Accordion\n\t\t\texpanded\n\t\t\tdefaultExpanded={true}\n\t\t\tstyle={{\n\t\t\t\toverflow: \"auto\",\n\t\t\t\t// this was maxHeight but then if we hide the Material an empty river looks weird\n\t\t\t\t// because it is surrounded by white-space\n\t\t\t\theight: materialHeight,\n\t\t\t}}\n\t\t\televation={5}\n\t\t>\n\t\t\t<AccordionSummary>\n\t\t\t\t<Typography\n\t\t\t\t\tvariant=\"h6\"\n\t\t\t\t\talign=\"center\"\n\t\t\t\t\tstyle={{ MozUserSelect: \"none\", WebkitUserSelect: \"none\", msUserSelect: \"none\" }}\n\t\t\t\t>\n\t\t\t\t\t{riverID}\n\t\t\t\t</Typography>\n\t\t\t</AccordionSummary>\n\t\t\t<AccordionDetails>\n\t\t\t\t<Grid container direction=\"column\" spacing={2} justify=\"center\" alignItems=\"stretch\">\n\t\t\t\t\t<Grid item>\n\t\t\t\t\t\t<cards.components.AddQAButton></cards.components.AddQAButton>\n\t\t\t\t\t\t<cards.components.AddNoteButton></cards.components.AddNoteButton>\n\t\t\t\t\t\t<Divider></Divider>\n\t\t\t\t\t</Grid>\n\n\t\t\t\t\t<Grid item>\n\t\t\t\t\t\t<Grid container direction=\"column\" spacing={2} justify=\"center\" alignItems=\"stretch\">\n\t\t\t\t\t\t\t{gridItems}\n\t\t\t\t\t\t</Grid>\n\t\t\t\t\t</Grid>\n\t\t\t\t</Grid>\n\t\t\t</AccordionDetails>\n\t\t</Accordion>\n\t);\n};\n","import { useDispatch } from \"react-redux\";\nimport { trySetActiveRiver } from \"../actions\";\nimport { ReactNode } from \"react\";\nimport React from \"react\";\n\n//TODO: make reconciliation algorithm for origin when new PDF versions come out\n// (basically, just search the text, and if it is not in the same span, just move the span - expand page forward and backward then search there)\n\nexport const SwitchActiveRiver = ({ children, riverID }: { children: ReactNode; riverID: string }) => {\n\tconst dispatch = useDispatch();\n\n\treturn (\n\t\t<span\n\t\t\tonMouseEnter={() => {\n\t\t\t\tdispatch(trySetActiveRiver(riverID));\n\t\t\t}}\n\t\t>\n\t\t\t{children}\n\t\t</span>\n\t);\n};\n","import {\n\tCardRiverState,\n\tRiverShowState,\n\tpageNumberToRiverMakeUpID,\n\tRiverContentState,\n\tremoveCardFromRivers,\n\tRiverMakeUps,\n} from \"./model\";\nimport { CardConfig } from \"../cards/model/config\";\nimport cards from \"../cards\";\nimport * as t from \"./actionTypes\";\nimport { ArchiveRiver } from \"../db/model\";\nimport db from \"../db\";\nimport { ClayMemoryPayloadAction } from \"../../shared/utils\";\n\nconst initialState: CardRiverState = {\n\trequestedOrigin: null,\n\triverMakeUps: {\n\t\t[pageNumberToRiverMakeUpID(1)]: {\n\t\t\triverID: pageNumberToRiverMakeUpID(1),\n\t\t\tcardIDs: [],\n\t\t},\n\t},\n\tactiveRiverMakeUpID: pageNumberToRiverMakeUpID(1),\n\triverShowState: \"SHOW\",\n\triverContentState: \"ALL\",\n\tcontentFilter: \"\",\n};\n\nconst cardRiverState = (state = initialState, { type, payload }: ClayMemoryPayloadAction): CardRiverState => {\n\tlet riverMakeUp;\n\tlet riverMakeUps;\n\tswitch (type) {\n\t\tcase t.RIVER_ACTIVE_ID:\n\t\t\treturn { ...state, activeRiverMakeUpID: payload };\n\t\tcase t.RIVER_SHOW_STATE:\n\t\t\treturn { ...state, riverShowState: payload as RiverShowState };\n\t\tcase t.RIVER_CONTENT_STATE:\n\t\t\treturn { ...state, riverContentState: payload as RiverContentState };\n\t\tcase t.RIVER_CONTENT_FILTER:\n\t\t\treturn { ...state, contentFilter: payload };\n\t\tcase t.ORIGIN_REQUEST:\n\t\t\treturn { ...state, requestedOrigin: payload };\n\t\tcase cards.actionTypes.CARD_PUSH:\n\t\t\tif (state.riverMakeUps[state.activeRiverMakeUpID]) {\n\t\t\t\triverMakeUp = {\n\t\t\t\t\t...state.riverMakeUps[state.activeRiverMakeUpID],\n\t\t\t\t\tcardIDs: [...state.riverMakeUps[state.activeRiverMakeUpID].cardIDs, (payload as CardConfig).cardID],\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\t// create new river\n\t\t\t\triverMakeUp = {\n\t\t\t\t\triverID: state.activeRiverMakeUpID,\n\t\t\t\t\tcardIDs: [(payload as CardConfig).cardID],\n\t\t\t\t};\n\t\t\t}\n\t\t\triverMakeUps = { ...state.riverMakeUps };\n\t\t\triverMakeUps[state.activeRiverMakeUpID] = riverMakeUp;\n\n\t\t\treturn { ...state, riverMakeUps: riverMakeUps };\n\t\tcase cards.actionTypes.CARD_REMOVE:\n\t\t\treturn removeCardFromRivers(state, payload as string);\n\n\t\tcase t.RIVER_RESET:\n\t\t\treturn initialState;\n\t\tcase t.RIVER_REPLACE:\n\t\t\treturn {\n\t\t\t\t...initialState,\n\t\t\t\triverMakeUps: payload as RiverMakeUps,\n\t\t\t};\n\n\t\tcase db.actionTypes.LOAD_DOCUMENT_DATA_SETS:\n\t\t\t// basically the same as DOCUMENT_CHANGE, just only triggered\n\t\t\t//when uploading data that corresponds to current document\n\t\t\t// and if not, we dont reset\n\t\t\tif (payload.newActiveDataSet) {\n\t\t\t\treturn {\n\t\t\t\t\t...initialState,\n\t\t\t\t\triverMakeUps: (payload.newActiveDataSet as ArchiveRiver).riverMakeUps,\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\treturn state;\n\t\t\t}\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n\nexport default cardRiverState;\n","import * as constants from \"./constants\";\nimport * as components from \"./components\";\nimport reducer from \"./reducer\";\nimport * as selectors from \"./selectors\";\nimport * as actions from \"./actions\";\nimport * as model from \"./model\";\nimport * as services from \"./services\";\n\nexport default { constants, components, reducer, selectors, actions, model, services };\n","import { RefObject, useCallback, useEffect, useRef } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { getSpanOrigin } from \"../selectors\";\nimport { resetSpanOrigin } from \"../actions\";\nimport { SingleOrigin } from \"../../cards/model/origin\";\n\nexport const PageSpanControl = ({ page, pageRef }: { page: number; pageRef: RefObject<null | HTMLDivElement> }) => {\n\tconst spanOrigin = useSelector(getSpanOrigin);\n\tconst count = useRef(0);\n\n\tconst dispatch = useDispatch();\n\n\t// it is not guaranteed that the effect fires after the page was fully rendered\n\t// (depends on load)\n\t// so we try up to 10 times\n\t// this assumes every machine has finished rendering after approx 100 ms\n\t// then we assume that the origin was invalid (bug somewhere) and abort\n\t// otherwise it would be a infinite loop\n\tconst trier = useCallback(() => {\n\t\tconst intervalID = setInterval(() => {\n\t\t\tif (count.current === 10) {\n\t\t\t\tcount.current = 0;\n\t\t\t\tclearInterval(intervalID);\n\t\t\t\tconsole.log(\"invalid origin clicked\", spanOrigin);\n\t\t\t\tdispatch(resetSpanOrigin());\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst textLayer = pageRef.current?.children.item(1);\n\t\t\tif (textLayer) {\n\t\t\t\tconst originSpan = textLayer.children.item((spanOrigin as SingleOrigin).spanIndexStart);\n\t\t\t\tif (originSpan) {\n\t\t\t\t\toriginSpan.scrollIntoView({ behavior: \"auto\", block: \"nearest\", inline: \"nearest\" });\n\t\t\t\t\tcount.current = 0;\n\t\t\t\t\tclearInterval(intervalID);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tcount.current = count.current + 1;\n\t\t}, 10);\n\t}, [dispatch, count, spanOrigin, pageRef]);\n\n\tuseEffect(() => {\n\t\tif (spanOrigin && spanOrigin.page === page && pageRef.current) {\n\t\t\t// assumption of fixed order\n\t\t\tconst textLayer = pageRef.current.children.item(1);\n\t\t\tif (textLayer) {\n\t\t\t\tconst originSpan = textLayer.children.item(spanOrigin.spanIndexStart);\n\t\t\t\tif (originSpan) {\n\t\t\t\t\toriginSpan.scrollIntoView({ behavior: \"auto\", block: \"nearest\", inline: \"nearest\" });\n\t\t\t\t\tcount.current = 0;\n\t\t\t\t} else {\n\t\t\t\t\ttrier();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\ttrier();\n\t\t\t}\n\t\t}\n\t}, [dispatch, page, pageRef, spanOrigin, trier]);\n\n\treturn null;\n};\n","import React, { useRef } from \"react\";\nimport { Page } from \"react-pdf\";\nimport { PageKeyboardControl } from \"./PageKeyboardControl\";\nimport selection from \"../../../selection\";\nimport { useSelector } from \"react-redux\";\nimport { getDocumentSearch, getSpanOrigin, getWindowMeasurements } from \"../../selectors\";\nimport { MaterialMultiplier } from \"./RiverMaterialPairList\";\nimport { PageSpanControl } from \"../PageSpanControl\";\nimport { TextLayerItemInternal } from \"react-pdf/dist/Page\";\nimport { SingleOrigin } from \"../../../cards/model/origin\";\n\ntype Renderer = (\n\ttextItem: TextLayerItemInternal | (TextLayerItemInternal & { str: string | JSX.Element })\n) => JSX.Element | string;\n\nconst highlightOrigin = (textItem: TextLayerItemInternal, origin: SingleOrigin) => {\n\tconst itemIndex = textItem.itemIndex;\n\tif (!(itemIndex >= origin.spanIndexStart && itemIndex <= origin.spanIndexEnd)) {\n\t\treturn textItem.str;\n\t}\n\n\t// does not really make sense to make more fine-grained mark if the TextLayer is off anyways\n\treturn <mark style={{ backgroundColor: \"red\" }}>{textItem.str}</mark>;\n};\n\nconst makeOriginHighlighter = (origin: SingleOrigin) => {\n\treturn (textItem: TextLayerItemInternal) => {\n\t\treturn highlightOrigin(textItem, origin);\n\t};\n};\n\nexport const backgroundStyle = { backgroundColor: \"blue\" };\n\n// TODO: this could be made clearer and cleaner\nexport const highlightPattern = (text: string, pattern: string) => {\n\t// the idea is that:\n\t// no matches are most likely\n\t// 1 or 2 are second most likely\n\t// after that the pattern must be really small,\n\t// so then we can look at the whole string\n\t// generally verbosity is used to guarantee speed\n\t// potentially 400+ items need to be processed for every search, so no room for slack\n\n\tconst textLength = text.length;\n\tconst patternLength = pattern.length;\n\t// most of the TextItems should not have a highlight, so short-circuit is advised\n\tif (pattern === \"\" || text === \"\" || patternLength > textLength) return text;\n\n\t// fastest match seems to be indexOf: https://jsben.ch/RVYk7\n\tconst index = text.indexOf(pattern);\n\tif (index === -1) return text;\n\n\t// react says to use unqiue elements with keys, I choose not to for speed reasons\n\tconst markedPattern = <mark style={backgroundStyle}>{pattern}</mark>;\n\tconst slice1 = index > 0 ? text.slice(0, index) : false;\n\n\tlet result = [];\n\tif (slice1) result.push(slice1);\n\tresult.push(markedPattern);\n\n\tconst secondIndex = text.indexOf(pattern, index + patternLength);\n\tif (secondIndex === -1) {\n\t\tconst slice2Start = index + patternLength;\n\t\tconst slice2 = slice2Start < textLength ? text.slice(slice2Start) : false;\n\t\tif (slice2) result.push(slice2);\n\t\treturn result;\n\t}\n\n\tconst slice2Start = index + patternLength;\n\tconst slice2 = slice2Start !== secondIndex ? text.slice(slice2Start, secondIndex) : false;\n\tif (slice2) result.push(slice2);\n\tresult.push(markedPattern);\n\n\tconst thirdIndex = text.indexOf(pattern, secondIndex + patternLength);\n\tif (thirdIndex === -1) {\n\t\tconst slice3Start = secondIndex + patternLength;\n\t\tconst slice3 = slice3Start < textLength ? text.slice(slice3Start) : false;\n\t\tif (slice3) result.push(slice2);\n\t\treturn result;\n\t}\n\n\tconst slice3Start = secondIndex + patternLength;\n\tconst slice3 = slice3Start < textLength ? text.slice(slice3Start, thirdIndex) : false;\n\tif (slice3) result.push(slice3);\n\tresult.push(markedPattern);\n\n\tif (thirdIndex + patternLength === textLength) {\n\t\treturn result;\n\t}\n\n\tconst stringRest = text.slice(thirdIndex + patternLength);\n\tif (stringRest === pattern) {\n\t\tresult.push(markedPattern);\n\t\treturn result;\n\t}\n\n\tconst splitText = stringRest.split(pattern);\n\tif (splitText.length <= 1) {\n\t\tresult.push(stringRest);\n\t\treturn result;\n\t}\n\n\tfor (let index = 0; index < splitText.length; index++) {\n\t\tconst spliter = splitText[index];\n\t\tif (index === 0 && spliter === \"\") {\n\t\t\tresult.push(markedPattern);\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (index === splitText.length - 1 && spliter !== \"\") {\n\t\t\tresult.push(spliter);\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (spliter !== \"\") result.push(spliter);\n\t\tresult.push(markedPattern);\n\t}\n\n\treturn result as any;\n};\n\nfunction makeTextRenderer(searchText: string) {\n\treturn function textRenderer(textItem: TextLayerItemInternal) {\n\t\treturn highlightPattern(textItem.str, searchText);\n\t};\n}\n\nconst combineRenderers = (searchRenderer?: Renderer, originRenderer?: Renderer) => {\n\tif (!searchRenderer) return originRenderer;\n\tif (!originRenderer) return searchRenderer;\n\treturn (textItem: TextLayerItemInternal) => originRenderer({ ...textItem, str: searchRenderer(textItem) as any });\n};\n\n//TODO: when switching from a small page to big, the ControlBar does not size back\n\nexport const PDFPage = ({ pageNumber }: { pageNumber: number }) => {\n\t//assumption is that the list checks for width before rendering\n\tconst materialWidth = useSelector(getWindowMeasurements)?.width as number;\n\tconst documentSearch = useSelector(getDocumentSearch);\n\tconst spanOrigin = useSelector(getSpanOrigin);\n\n\tconst originHighlighter = spanOrigin ? makeOriginHighlighter(spanOrigin) : undefined;\n\tconst searchRenderer = documentSearch !== \"\" ? makeTextRenderer(documentSearch) : undefined;\n\n\tconst textRenderer = combineRenderers(searchRenderer, originHighlighter);\n\n\tconst pageRef = useRef<null | HTMLDivElement>(null);\n\n\treturn (\n\t\t<div style={{ overflow: \"auto\" }}>\n\t\t\t<selection.components.MaterialMouseUp page={pageNumber}>\n\t\t\t\t<PageKeyboardControl>\n\t\t\t\t\t<Page\n\t\t\t\t\t\tinputRef={(instance) => {\n\t\t\t\t\t\t\tpageRef.current = instance;\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tpageNumber={pageNumber}\n\t\t\t\t\t\twidth={materialWidth * MaterialMultiplier}\n\t\t\t\t\t\tcustomTextRenderer={textRenderer as any}\n\t\t\t\t\t\trenderAnnotationLayer={false}\n\t\t\t\t\t/>\n\t\t\t\t</PageKeyboardControl>\n\t\t\t</selection.components.MaterialMouseUp>\n\t\t\t<PageSpanControl page={pageNumber} pageRef={pageRef}></PageSpanControl>\n\t\t</div>\n\t);\n};\n","import React from \"react\";\nimport { Divider, Grid } from \"@material-ui/core\";\nimport river from \"../../../river\";\nimport { PDFPage } from \"./PDFPage\";\nimport { useSelector } from \"react-redux\";\nimport { getDisplayStatus, getWindowMeasurements } from \"../../selectors\";\nimport { pairTopBottomPadding, RiverMultiplier } from \"./RiverMaterialPairList\";\n\nconst RiverPairItem = ({ riverID, materialHeight }: { riverID: string; materialHeight: number }) => {\n\tconst width = useSelector(getWindowMeasurements)?.width as number;\n\n\treturn (\n\t\t<div style={{ maxWidth: width * RiverMultiplier }}>\n\t\t\t<river.components.CardRiver riverID={riverID} materialHeight={materialHeight}></river.components.CardRiver>\n\t\t</div>\n\t);\n};\n\nexport const RiverMaterialPair = ({\n\tindex,\n\tdata,\n\tstyle,\n}: {\n\tindex: number;\n\tdata: {\n\t\tmaterialHeights: Map<number, number>;\n\t};\n\tstyle: any;\n}) => {\n\tconst pageNumber = index + 1;\n\tconst riverID = river.model.pageNumberToRiverMakeUpID(pageNumber);\n\tconst { materialHeights } = data;\n\tconst showRiver = useSelector(river.selectors.getRiverShowState);\n\tconst showMaterial = useSelector(getDisplayStatus);\n\n\treturn (\n\t\t<div style={{ ...style }}>\n\t\t\t<river.components.SwitchActiveRiver riverID={riverID}>\n\t\t\t\t<Grid container justify=\"space-between\" direction=\"row\" alignItems=\"flex-start\">\n\t\t\t\t\t<Grid item hidden={showRiver === \"HIDE\"}>\n\t\t\t\t\t\t<RiverPairItem riverID={riverID} materialHeight={materialHeights.get(pageNumber) as number}></RiverPairItem>\n\t\t\t\t\t</Grid>\n\n\t\t\t\t\t<Grid item hidden={showMaterial === \"HIDE\"}>\n\t\t\t\t\t\t<PDFPage pageNumber={pageNumber}></PDFPage>\n\t\t\t\t\t</Grid>\n\t\t\t\t</Grid>\n\t\t\t</river.components.SwitchActiveRiver>\n\t\t\t<Divider style={{ marginTop: pairTopBottomPadding / 2 }}></Divider>\n\t\t</div>\n\t);\n};\n","import { RefObject, useEffect } from \"react\";\nimport { VariableSizeList } from \"react-window\";\nimport { getCurrentPage, getCurrentView, getScrollToPage } from \"../../selectors\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { setPage, setSpanOrigin, setView } from \"../../actions\";\nimport river from \"../../../river\";\nimport { View } from \"../../model\";\n\nexport const PageScrollControl = ({ listRef }: { listRef: RefObject<VariableSizeList> }) => {\n\tconst currentView = useSelector(getCurrentView);\n\n\tconst scrollToPage = useSelector(getScrollToPage);\n\tconst currentPage = useSelector(getCurrentPage);\n\tconst requestedOrigin = useSelector(river.selectors.getOriginRequest);\n\tuseEffect(() => {\n\t\tlistRef.current?.scrollToItem(currentPage - 1, \"start\");\n\t}, []);\n\n\tconst dispatch = useDispatch();\n\n\tuseEffect(() => {\n\t\tif ((requestedOrigin || scrollToPage) && currentView !== View.RiverMaterial) {\n\t\t\tdispatch(setView(View.RiverMaterial));\n\t\t}\n\n\t\tif (requestedOrigin) {\n\t\t\tlistRef.current?.scrollToItem(requestedOrigin.page - 1, \"auto\");\n\t\t\tdispatch(setSpanOrigin(requestedOrigin));\n\t\t\tdispatch(setPage(requestedOrigin.page, false));\n\t\t\tdispatch(river.actions.resetOriginRequest());\n\t\t\treturn;\n\t\t}\n\n\t\tif (scrollToPage) {\n\t\t\tlistRef.current?.scrollToItem(scrollToPage - 1, \"start\");\n\t\t\tdispatch(setPage(scrollToPage, false));\n\t\t}\n\t}, [dispatch, listRef, scrollToPage, requestedOrigin, currentView]);\n\n\treturn null;\n};\n","import React, { RefObject, useRef, Fragment, useEffect } from \"react\";\nimport { pdfjs } from \"react-pdf\";\nimport { VariableSizeList } from \"react-window\";\nimport { RiverMaterialPair } from \"./RiverMaterialPair\";\nimport { CachedPageDimensions } from \"./PDFDocument\";\nimport { getTopOffset, getWindowMeasurements } from \"../../selectors\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { setPage } from \"../../actions\";\nimport { PageScrollControl } from \"./PageScrollControl\";\n\n//TODO: replace this with Material-UI breakpoints\nexport const MaterialMultiplier = 0.63;\nexport const RiverMultiplier = 0.35;\n\nconst calculateMaterialHeight = (\n\tpageNumber: number,\n\tcachedPageDimensions: CachedPageDimensions,\n\twindowWidth: number\n) => {\n\tconst pageDims = cachedPageDimensions.get(pageNumber) as [number, number];\n\tconst materialWidth = windowWidth * MaterialMultiplier;\n\n\tconst userSpaceUnitWidth = pageDims[0];\n\tconst pixelPerUserSpaceUnit = materialWidth / userSpaceUnitWidth;\n\tconst materialHeight = pageDims[1] * pixelPerUserSpaceUnit;\n\n\tconst extraSpaceBetweenMaterialPages = 20;\n\treturn materialHeight + extraSpaceBetweenMaterialPages;\n};\n\nexport const pairTopBottomPadding = 20;\n\nconst Resetter = ({\n\tlistRef,\n\tmaterialHeights,\n}: {\n\tlistRef: RefObject<VariableSizeList>;\n\tmaterialHeights: Map<number, number>;\n}) => {\n\tconst ref = useRef(materialHeights);\n\n\tuseEffect(() => {\n\t\tif (materialHeights !== ref.current) {\n\t\t\tlistRef.current?.resetAfterIndex(0);\n\t\t\tref.current = materialHeights;\n\t\t}\n\t});\n\n\treturn null;\n};\n\nexport const RiverMaterialPairList = ({\n\tpdfProxyRef,\n\tcachedPageDimensions,\n}: {\n\tpdfProxyRef: RefObject<pdfjs.PDFDocumentProxy | undefined>;\n\tcachedPageDimensions: CachedPageDimensions;\n}) => {\n\tconst listRef = useRef<VariableSizeList>();\n\n\tconst windowMeasurements = useSelector(getWindowMeasurements);\n\tconst materialHeights = windowMeasurements\n\t\t? Array.from(cachedPageDimensions.keys()).reduce((prev, pageNumber) => {\n\t\t\t\tprev.set(pageNumber, calculateMaterialHeight(pageNumber, cachedPageDimensions, windowMeasurements.width));\n\t\t\t\treturn prev;\n\t\t  }, new Map<number, number>())\n\t\t: undefined;\n\n\tconst dispatch = useDispatch();\n\tconst topOffset = useSelector(getTopOffset);\n\n\treturn (\n\t\t<Fragment>\n\t\t\t{windowMeasurements && materialHeights && (\n\t\t\t\t<VariableSizeList\n\t\t\t\t\theight={windowMeasurements.height - topOffset}\n\t\t\t\t\titemCount={(pdfProxyRef.current as pdfjs.PDFDocumentProxy).numPages}\n\t\t\t\t\titemSize={(index: number) => (materialHeights.get(index + 1) as number) + pairTopBottomPadding}\n\t\t\t\t\titemData={{\n\t\t\t\t\t\tmaterialHeights,\n\t\t\t\t\t}}\n\t\t\t\t\tref={listRef as RefObject<VariableSizeList>}\n\t\t\t\t\twidth=\"100%\"\n\t\t\t\t\tonItemsRendered={(props) => {\n\t\t\t\t\t\t//TODO: find way to switch the page if it is halfway in sight\n\t\t\t\t\t\tdispatch(setPage(props.visibleStopIndex + 1, false));\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t{RiverMaterialPair}\n\t\t\t\t</VariableSizeList>\n\t\t\t)}\n\t\t\t{materialHeights && (\n\t\t\t\t<Resetter listRef={listRef as RefObject<VariableSizeList>} materialHeights={materialHeights}></Resetter>\n\t\t\t)}\n\t\t\t<PageScrollControl listRef={listRef as RefObject<VariableSizeList>}></PageScrollControl>\n\t\t</Fragment>\n\t);\n};\n","import \"./PDFDocument.css\";\nimport \"react-pdf/dist/esm/Page/AnnotationLayer.css\";\nimport React, { useState, useRef } from \"react\";\nimport { pdfjs, Document } from \"react-pdf\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { materialLoaded, setPage } from \"../../actions\";\nimport { getPDF } from \"../../selectors\";\nimport text from \"../../../text\";\nimport { cachePageDimensions } from \"./cachePageDimensions\";\nimport { RiverMaterialPairList } from \"./RiverMaterialPairList\";\npdfjs.GlobalWorkerOptions.workerSrc = `//cdnjs.cloudflare.com/ajax/libs/pdf.js/${pdfjs.version}/pdf.worker.js`;\n\nexport type CachedPageDimensions = Map<number, [number, number]>;\n\nconst options = {\n\tcMapUrl: \"cmaps/\",\n\tcMapPacked: true,\n};\n\nexport const PDFDocument = () => {\n\tconst pdf = useSelector(getPDF);\n\n\tconst [cachedPageDimensions, setPageDimensions] = useState<CachedPageDimensions | undefined>();\n\n\tconst pdfProxyRef = useRef<pdfjs.PDFDocumentProxy | undefined>();\n\n\tconst dispatch = useDispatch();\n\n\t// used for abborting pageDimension-cache-collection\n\tconst pdfName = pdf?.name;\n\tconst pdfNameRef = useRef(pdfName);\n\tif (pdfNameRef.current !== pdfName) {\n\t\tpdfNameRef.current = pdfName;\n\t}\n\n\treturn (\n\t\t<Document\n\t\t\tloading={text.constants.loadingMaterialText}\n\t\t\tnoData={text.constants.noMaterialText}\n\t\t\toptions={options}\n\t\t\tfile={pdf}\n\t\t\trenderMode=\"canvas\"\n\t\t\tonLoadSuccess={(pdfProxy) => {\n\t\t\t\tdispatch(materialLoaded(pdfProxy.numPages));\n\t\t\t\tif (pdf) cachePageDimensions(pdfProxy, pdfName as string, pdfNameRef, setPageDimensions);\n\t\t\t\tpdfProxyRef.current = pdfProxy;\n\t\t\t}}\n\t\t\tonItemClick={({ pageNumber }) => {\n\t\t\t\tdispatch(setPage(parseInt(pageNumber), true));\n\t\t\t}}\n\t\t>\n\t\t\t{cachedPageDimensions && pdfNameRef.current === pdfName && (\n\t\t\t\t<RiverMaterialPairList\n\t\t\t\t\tpdfProxyRef={pdfProxyRef}\n\t\t\t\t\tcachedPageDimensions={cachedPageDimensions}\n\t\t\t\t></RiverMaterialPairList>\n\t\t\t)}\n\t\t</Document>\n\t);\n};\n","import { RefObject } from \"react\";\nimport { pdfjs } from \"react-pdf\";\nimport { CachedPageDimensions } from \"./PDFDocument\";\n\n//TODO: use more robust method than pdfName to differentiate pdfs in this abort\n//TODO: test if this abort actually works? once the function was entered,\n// is it guaranteed that it will finish before other changes?\nexport const cachePageDimensions = (\n\tpdfProxy: pdfjs.PDFDocumentProxy,\n\tpdfName: string,\n\tpdfNameRef: RefObject<string | null | undefined>,\n\tsetPageDimensions: (dims: CachedPageDimensions) => void\n) => {\n\tconst promises = Array.from({ length: pdfProxy.numPages }, (_, i) => i + 1).map((pageNumber) =>\n\t\tpdfProxy.getPage(pageNumber)\n\t);\n\n\t// Assuming all pages may have different heights. Otherwise we can just\n\t// load the first page and use its height for determining all the row\n\t// heights.\n\tPromise.all((promises as unknown) as Promise<any>[]).then((pages: pdfjs.PDFPageProxy[]) => {\n\t\t// a different pdf was loaded while these promises where executing\n\t\tif (pdfName !== pdfNameRef.current) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst pageDimensions = new Map();\n\n\t\tconst scale = 1;\n\t\tfor (const page of pages) {\n\t\t\tconst w = page.view[2] * scale;\n\t\t\tconst h = page.view[3] * scale;\n\n\t\t\t// react-pdf 4.0.5 types are incorrect, _pageIndex is correct and not just pageIndex\n\t\t\tpageDimensions.set(((page as unknown) as { _pageIndex: number })._pageIndex + 1, [w, h]);\n\t\t}\n\n\t\tsetPageDimensions(pageDimensions);\n\t});\n};\n","import { Grid } from \"@material-ui/core\";\nimport React from \"react\";\nimport { useSelector } from \"react-redux\";\nimport { incrementer } from \"../../../shared/utils\";\nimport river from \"../../river\";\nimport { getNonEmptyRiverIDsSorted } from \"../../river/selectors\";\nimport { getTopOffset, getWindowMeasurements } from \"../selectors\";\n\nconst ExplorerRiver = ({ riverID }: { riverID: string }) => {\n\tconst windowMeasurements = useSelector(getWindowMeasurements);\n\tconst topOffset = useSelector(getTopOffset);\n\n\treturn windowMeasurements && topOffset ? (\n\t\t<div style={{ marginBottom: \"8px\", marginTop: \"4px\" }}>\n\t\t\t<river.components.CardRiver\n\t\t\t\triverID={riverID}\n\t\t\t\tmaterialHeight={(windowMeasurements?.height as number) - topOffset - 10}\n\t\t\t></river.components.CardRiver>\n\t\t</div>\n\t) : null;\n};\n\nexport const RiverExplorer = () => {\n\tconst riverIDs = useSelector(getNonEmptyRiverIDsSorted);\n\tconst increment = incrementer();\n\treturn (\n\t\t<Grid container justify=\"space-evenly\" alignItems=\"center\" spacing={2} style={{ width: \"100%\", height: \"100%\" }}>\n\t\t\t{riverIDs.map((id) => (\n\t\t\t\t<Grid item xs={4} key={increment()}>\n\t\t\t\t\t<river.components.SwitchActiveRiver riverID={id}>\n\t\t\t\t\t\t<ExplorerRiver riverID={id}></ExplorerRiver>\n\t\t\t\t\t</river.components.SwitchActiveRiver>\n\t\t\t\t</Grid>\n\t\t\t))}\n\t\t</Grid>\n\t);\n};\n//TODO: make error-message if jump to is executed without uploading a pdf\n","import React, { Fragment } from \"react\";\nimport { useSelector } from \"react-redux\";\nimport { View } from \"../model\";\nimport { getCurrentView } from \"../selectors\";\nimport { CardExplorer } from \"./CardExplorer\";\nimport { OriginMarkedSnackbar } from \"./OriginMarkedSnackbar\";\nimport { PDFDocument } from \"./PDFDocument/PDFDocument\";\nimport { RiverExplorer } from \"./RiverExplorer\";\n\nexport const Display = () => {\n\tconst currentView = useSelector(getCurrentView);\n\n\t// TODO: cant hide the CardExplorer because the Material UI TextField does not render correctly\n\t// after hidding\n\n\t// TODO: disable CardExplorer until I fix the \"which River is active\" problem for that view\n\treturn (\n\t\t<Fragment>\n\t\t\t<div hidden={currentView !== View.RiverMaterial} style={{ width: \"100%\", height: \"100%\" }}>\n\t\t\t\t<PDFDocument></PDFDocument>\n\t\t\t\t<OriginMarkedSnackbar></OriginMarkedSnackbar>\n\t\t\t</div>\n\n\t\t\t<div hidden={currentView !== View.RiverExplorer} style={{ width: \"100%\", height: \"100%\" }}>\n\t\t\t\t<RiverExplorer></RiverExplorer>\n\t\t\t</div>\n\n\t\t\t{/* {currentView === View.CardExplorer && <CardExplorer></CardExplorer>} */}\n\t\t</Fragment>\n\t);\n};\n","import { Card, Tab, Tabs } from \"@material-ui/core\";\nimport React from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { setView } from \"../actions\";\nimport { getCurrentView } from \"../selectors\";\n\nexport const ViewTabs = () => {\n\tconst currentView = useSelector(getCurrentView);\n\tconst dispatch = useDispatch();\n\n\tconst handleChange = (_: any, newValue: number) => {\n\t\tdispatch(setView(newValue));\n\t};\n\n\treturn (\n\t\t<Card>\n\t\t\t<Tabs value={currentView} onChange={handleChange}>\n\t\t\t\t<Tab label=\"River-Material\" />\n\t\t\t\t<Tab label=\"River Explorer\" />\n\t\t\t\t{/* <Tab label=\"Card Explorer\" /> */}\n\t\t\t</Tabs>\n\t\t</Card>\n\t);\n};\n","import * as t from \"./actionTypes\";\nimport { DisplayData, DisplayStatus, View } from \"./model\";\nimport { ClayMemoryPayloadAction } from \"../../shared/utils\";\nimport { ExistingDocumentPayload } from \"./actions\";\n\nconst initialState: DisplayData = {\n\tdisplayStatus: \"SHOW\",\n\ttotalPages: 1000,\n\tcurrentPage: 1,\n\tscrollToPage: null,\n\twindowMeasurements: null,\n\tspanOrigin: null,\n\tdocumentSearch: \"\",\n\ttopOffset: 0,\n\tcurrentView: View.RiverMaterial,\n};\n\nconst displayData = (state = initialState, { type, payload }: ClayMemoryPayloadAction): DisplayData => {\n\tswitch (type) {\n\t\tcase t.PDF_UPLOADED:\n\t\t\treturn { ...state, pdf: payload as File, pdfName: (payload as File).name };\n\t\tcase t.MATERIAL_LOADED:\n\t\t\treturn { ...state, totalPages: payload as number };\n\t\tcase t.PAGE_UPDATE:\n\t\t\treturn { ...state, currentPage: payload.page, scrollToPage: payload.shouldScroll ? payload.page : null };\n\t\tcase t.DISPLAY_STATUS:\n\t\t\treturn { ...state, displayStatus: payload as DisplayStatus };\n\t\tcase t.SPAN_ORIGIN:\n\t\t\treturn { ...state, spanOrigin: payload };\n\t\tcase t.DOCUMENT_SEARCH:\n\t\t\treturn { ...state, documentSearch: payload };\n\t\tcase t.TOP_OFFSET:\n\t\t\treturn { ...state, topOffset: payload };\n\t\tcase t.WINDOW_LAYOUT:\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\twindowMeasurements: payload,\n\t\t\t};\n\t\tcase t.VIEW_CHANGE:\n\t\t\treturn { ...state, currentView: payload };\n\t\tcase t.LOAD_EXISTING_DOCUMENT:\n\t\t\treturn {\n\t\t\t\t...initialState,\n\t\t\t\tpdf: undefined,\n\t\t\t\t...(payload as ExistingDocumentPayload),\n\t\t\t};\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n\nexport default displayData;\n","import * as actions from \"./actions\";\nimport * as actionTypes from \"./actionTypes\";\nimport * as components from \"./components\";\nimport * as constants from \"./constants\";\nimport reducer from \"./reducer\";\nimport * as selectors from \"./selectors\";\n\nexport default { actions, actionTypes, components, constants, reducer, selectors };\n","export const NAME = \"controlData\";\n","import { createSelector } from \"reselect\";\nimport display from \"../display\";\nimport river from \"../river\";\nimport cards from \"../cards\";\nimport { DocumentData } from \"../db/model\";\nimport { NAME } from \"./constants\";\nimport { Model } from \"./model\";\n\nexport const collectCurrentDBData: (state: any) => DocumentData | null = createSelector(\n\tdisplay.selectors.getPDFName,\n\tdisplay.selectors.getTotalPages,\n\tdisplay.selectors.getCurrentPage,\n\triver.selectors.getRiverMakeUps,\n\triver.selectors.getActiveRiverMakeUpID,\n\tcards.selectors.getCards,\n\tcards.selectors.getLastCardIDNumber,\n\t(pdfName, totalPages, currentPage, riverMakeUps, activeRiverMakeUpID, cards, lastCardIDNumber) => {\n\t\treturn {\n\t\t\tname: pdfName as string,\n\t\t\ttotalPages,\n\t\t\tcurrentPage,\n\t\t\triverMakeUps,\n\t\t\tactiveRiverMakeUpID,\n\t\t\tcards,\n\t\t\tlastCardIDNumber,\n\t\t};\n\t}\n);\n\nexport const getAll = (state: any): Model => state[NAME];\n\nexport const getLastUndoableActionComb = createSelector(getAll, (state) => state.present);\n\nexport const getLastRedoableActionComb = createSelector(getAll, (state) =>\n\tstate.future.length > 0 ? state.future[0] : null\n);\n","import { NAME } from \"./constants\";\n\nexport const REDO_ACTION_HISTORY = NAME + \"/REDO_ACTION_HISTORY\";\nexport const UNDO_ACTION_HISTORY = NAME + \"/UNDO_ACTION_HISTORY\";\nexport const REMOVE_ACTION_HISTORY = NAME + \"/REMOVE_ACTION_HISTORY\";\n","import { Dispatch } from \"redux\";\nimport display from \"../display\";\nimport { ActionCreators } from \"redux-undo\";\nimport db from \"../db\";\nimport { collectCurrentDBData } from \"./selectors\";\nimport { DocumentData } from \"../db/model\";\nimport * as t from \"./actionTypes\";\nimport { ClayMemoryPayloadAction } from \"../../shared/utils\";\nimport cards from \"../cards\";\nimport river from \"../river\";\n\nexport const archiveCurrentDBData = () => {\n\treturn (dispatch: Dispatch, getState: Function) => {\n\t\tconst state = getState();\n\t\tconst currentPDFName = display.selectors.getPDFName(state);\n\n\t\tif (currentPDFName !== undefined) {\n\t\t\tconst dbData = collectCurrentDBData(state) as DocumentData;\n\t\t\tdispatch(db.actions.archiveDBData(dbData));\n\t\t}\n\t};\n};\n\nconst fileDownload = require(\"js-file-download\");\nexport const downloadDBData = () => {\n\treturn (dispatch: any, getState: Function) => {\n\t\t//actualize the db before downloading\n\t\tdispatch(archiveCurrentDBData());\n\n\t\tconst documentDataSets = db.selectors.getDocumentDataSets(getState());\n\t\tconst localString = new Date().toLocaleString();\n\t\tfileDownload(JSON.stringify(documentDataSets), localString + \" ClayMemory.txt\");\n\t};\n};\n\nexport const undoActionHistory = (action: string): ClayMemoryPayloadAction => {\n\treturn { type: t.UNDO_ACTION_HISTORY, payload: action };\n};\n\nexport const redoActionHistory = (action: string): ClayMemoryPayloadAction => {\n\treturn { type: t.REDO_ACTION_HISTORY, payload: action };\n};\n\nexport const removeActionHistory = (dispatch: Dispatch) => {\n\tdispatch(ActionCreators.clearHistory());\n\tdispatch({ type: t.REMOVE_ACTION_HISTORY });\n};\n\nexport const resetActiveAppState = (dispatch: Dispatch) => {\n\tdispatch(cards.actions.resetCards());\n\tdispatch(river.actions.resetRivers());\n};\n\nexport const replaceActiveAppState = (dispatch: Dispatch, newDocumentData: DocumentData, currentPDFName?: string) => {\n\tdispatch(\n\t\tcards.actions.replaceCards({ cards: newDocumentData.cards, lastCardIDNumber: newDocumentData.lastCardIDNumber })\n\t);\n\tdispatch(river.actions.replaceRivers(newDocumentData.riverMakeUps));\n\tif (currentPDFName && newDocumentData.name !== currentPDFName) {\n\t\t//existing pdf is unequal to loaded data, so need to replace\n\t\t//pdf is not replaced, because when we load only data, the pdf is not yet uploaded\n\t\tdispatch(\n\t\t\tdisplay.actions.loadExistingDocument(\n\t\t\t\t(({ name, currentPage, totalPages }) => ({ pdfName: name, currentPage, totalPages }))(newDocumentData)\n\t\t\t)\n\t\t);\n\t}\n};\n\nexport const loadPDF = (pdf: File) => {\n\treturn (dispatch: Dispatch, getState: Function) => {\n\t\tconst newPDFName = pdf.name;\n\n\t\tconst state = getState();\n\t\tconst currentPDFName = display.selectors.getPDFName(state);\n\n\t\tconst documentDB = db.selectors.getAll(state);\n\n\t\t// save current data only if pdf has been uploaded / there is an active document\n\t\tif (currentPDFName !== undefined) {\n\t\t\tconst dbData = collectCurrentDBData(state) as DocumentData;\n\t\t\tdispatch(db.actions.archiveDBData(dbData));\n\t\t}\n\n\t\tdispatch(display.actions.pdfUpload(pdf));\n\n\t\t// if the uploaded pdf is the same as the active one, then we just reloaded the app (lost the pdf)\n\t\t// and dont need load data (loading data would lead to overwrite because of the syncing order)\n\t\t//TODO: make the sync between documentDB and active document more explicit, right now I just sync when a PDF is uploaded\n\t\tif (newPDFName === currentPDFName) {\n\t\t\treturn;\n\t\t}\n\t\t// load new data or reset\n\t\tconst newDocumentData = documentDB[newPDFName];\n\t\tif (newDocumentData) {\n\t\t\treplaceActiveAppState(dispatch, newDocumentData);\n\t\t} else {\n\t\t\tresetActiveAppState(dispatch);\n\t\t}\n\n\t\t// no undo-redo across documents\n\t\tremoveActionHistory(dispatch);\n\t};\n};\n\nexport const loadSavedDocument = (document: string) => {\n\treturn (dispatch: Dispatch, getState: Function) => {\n\t\tconst state = getState();\n\t\tconst currentPDFName = display.selectors.getPDFName(state);\n\n\t\tconst documentDB = db.selectors.getAll(state);\n\n\t\t// save current data only if pdf has been uploaded / there is an active document\n\t\tif (currentPDFName !== undefined) {\n\t\t\tconst dbData = collectCurrentDBData(state) as DocumentData;\n\t\t\tdispatch(db.actions.archiveDBData(dbData));\n\t\t}\n\n\t\t// load new data\n\t\tconst newDocumentData = documentDB[document];\n\t\treplaceActiveAppState(dispatch, newDocumentData, currentPDFName);\n\n\t\t// no undo-redo across documents\n\t\tremoveActionHistory(dispatch);\n\t};\n};\n\nexport const deleteDocument = (document: string) => {\n\treturn (dispatch: Dispatch, getState: Function) => {\n\t\tconst state = getState();\n\t\tconst activeDocument = display.selectors.getPDFName(state);\n\t\tif (activeDocument && activeDocument === document) {\n\t\t\t// reset data\n\t\t\tresetActiveAppState(dispatch);\n\n\t\t\t// keeping the undo history leads to weird edge cases and makes no sense\n\t\t\tremoveActionHistory(dispatch);\n\t\t}\n\n\t\t// note: no undo of this\n\t\tdispatch(db.actions.deleteDocumentDataSet(document));\n\t};\n};\n","import { useDispatch } from \"react-redux\";\nimport React, { useState } from \"react\";\nimport {\n\tIconButton,\n\tTooltip,\n\tDialog,\n\tDialogTitle,\n\tDialogContent,\n\tDialogContentText,\n\tDialogActions,\n\tButton,\n} from \"@material-ui/core\";\nimport DeleteIcon from \"@material-ui/icons/Delete\";\nimport text from \"../../../text\";\nimport { deleteDocument } from \"../../actions\";\n\nconst DeleteDocumentDialogAlert = ({\n\tdocument,\n\thandleClose,\n\topen,\n}: {\n\tdocument: string;\n\thandleClose: () => void;\n\topen: boolean;\n}) => {\n\tconst dispatch = useDispatch();\n\n\treturn (\n\t\t<Dialog\n\t\t\topen={open}\n\t\t\tonClose={handleClose}\n\t\t\taria-labelledby=\"alert-dialog-title\"\n\t\t\taria-describedby=\"alert-dialog-description\"\n\t\t>\n\t\t\t<DialogTitle id=\"alert-dialog-title\">{\"Delete \" + document + \" and all associated card data?\"}</DialogTitle>\n\t\t\t<DialogContent>\n\t\t\t\t<DialogContentText id=\"alert-dialog-description\">This change can not be undone.</DialogContentText>\n\t\t\t</DialogContent>\n\t\t\t<DialogActions>\n\t\t\t\t<Button onClick={handleClose} color=\"primary\">\n\t\t\t\t\tAbort\n\t\t\t\t</Button>\n\t\t\t\t<Button\n\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\tdispatch(deleteDocument(document));\n\t\t\t\t\t\thandleClose();\n\t\t\t\t\t}}\n\t\t\t\t\tcolor=\"primary\"\n\t\t\t\t\tautoFocus\n\t\t\t\t>\n\t\t\t\t\tDelete document and associated card data\n\t\t\t\t</Button>\n\t\t\t</DialogActions>\n\t\t</Dialog>\n\t);\n};\n\n//TODO: deleting the active document leads only to reset it, not really delete it\nexport const DeleteDocumentButton = ({ document }: { document: string }) => {\n\tconst [open, setOpen] = useState(false);\n\n\tconst handleClose = () => {\n\t\tsetOpen(false);\n\t};\n\treturn (\n\t\t<div>\n\t\t\t<Tooltip\n\t\t\t\ttitle={text.constants.deleteDocumentTooltip}\n\t\t\t\tenterDelay={text.constants.defaultEnterDelay}\n\t\t\t\tenterNextDelay={text.constants.defaultEnterNextDelay}\n\t\t\t>\n\t\t\t\t<IconButton\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\tsetOpen(true);\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<DeleteIcon fontSize=\"small\"></DeleteIcon>\n\t\t\t\t</IconButton>\n\t\t\t</Tooltip>\n\t\t\t<DeleteDocumentDialogAlert document={document} open={open} handleClose={handleClose}></DeleteDocumentDialogAlert>\n\t\t</div>\n\t);\n};\n","import { useSelector, useDispatch } from \"react-redux\";\nimport React, { ChangeEvent, Fragment, useRef, MutableRefObject } from \"react\";\nimport { MenuItem, Button } from \"@material-ui/core\";\nimport display from \"../../../display\";\nimport db from \"../../../db\";\nimport { DocumentData } from \"../../../db/model\";\nimport PublishIcon from \"@material-ui/icons/Publish\";\n\nexport const InputDataSets = ({ handleClose, label }: any) => {\n\tconst dispatch = useDispatch();\n\n\tconst activeDocument = useSelector(display.selectors.getPDFName);\n\n\tconst ref: MutableRefObject<null | HTMLInputElement> = useRef(null);\n\n\treturn (\n\t\t<Fragment>\n\t\t\t<MenuItem\n\t\t\t\tonClick={() => {\n\t\t\t\t\t(ref.current as HTMLInputElement).click();\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<Button variant=\"contained\" color=\"primary\" disableElevation startIcon={<PublishIcon></PublishIcon>}>\n\t\t\t\t\t{label}\n\t\t\t\t</Button>\n\t\t\t</MenuItem>\n\t\t\t<input\n\t\t\t\tref={ref}\n\t\t\t\tstyle={{ display: \"none\" }}\n\t\t\t\tonChange={(event: ChangeEvent<HTMLInputElement>) => {\n\t\t\t\t\t// fun fact: uploading a file with the same file-name does not trigger this event\n\t\t\t\t\tconst files = event.target.files;\n\t\t\t\t\tconst file = files ? files[0] : null;\n\t\t\t\t\tif (file) {\n\t\t\t\t\t\tconst reader = new FileReader();\n\t\t\t\t\t\treader.readAsText(file);\n\t\t\t\t\t\treader.onload = () => {\n\t\t\t\t\t\t\t//TODO: sanitize, escape os new line difference, prepare multimedia cards\n\t\t\t\t\t\t\t//TODO: merge same name-pdfs and think about collision in general\n\t\t\t\t\t\t\t//TODO: merge uploaded state with current-one and dont overwrite\n\t\t\t\t\t\t\tconst uploadedDataSets = JSON.parse(reader.result as string);\n\t\t\t\t\t\t\t// if the uploaded dataset corresponds to the current document, overwrite current with uploaded\n\t\t\t\t\t\t\tconst foundDataSet = (uploadedDataSets as DocumentData[]).find(\n\t\t\t\t\t\t\t\t(dbData) => dbData.name === activeDocument\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tdispatch(db.actions.loadDocumentDataSets(uploadedDataSets, foundDataSet));\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\thandleClose();\n\t\t\t\t}}\n\t\t\t\ttype=\"file\"\n\t\t\t\taccept=\".txt\"\n\t\t\t/>\n\t\t</Fragment>\n\t);\n};\n","import { useDispatch } from \"react-redux\";\nimport React, { ChangeEvent, Fragment, useRef, MutableRefObject } from \"react\";\nimport { MenuItem, Button } from \"@material-ui/core\";\nimport { loadPDF } from \"../../actions\";\nimport InsertDriveFileIcon from \"@material-ui/icons/InsertDriveFile\";\n//TODO: have way to merge two document-workspaces\nexport const InputDocument = ({ handleClose, label }: any) => {\n\tconst dispatch = useDispatch();\n\n\tconst ref: MutableRefObject<null | HTMLInputElement> = useRef(null);\n\n\treturn (\n\t\t<Fragment>\n\t\t\t<MenuItem\n\t\t\t\tonClick={() => {\n\t\t\t\t\t(ref.current as HTMLInputElement).click();\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<Button\n\t\t\t\t\tvariant=\"contained\"\n\t\t\t\t\tcolor=\"primary\"\n\t\t\t\t\tdisableElevation\n\t\t\t\t\tstartIcon={<InsertDriveFileIcon></InsertDriveFileIcon>}\n\t\t\t\t>\n\t\t\t\t\t{label}\n\t\t\t\t</Button>\n\t\t\t</MenuItem>\n\t\t\t<input\n\t\t\t\tref={ref}\n\t\t\t\tstyle={{ display: \"none\" }}\n\t\t\t\tonChange={(event: ChangeEvent<HTMLInputElement>) => {\n\t\t\t\t\tconst files = event.target.files;\n\t\t\t\t\tconst pdf = files ? files[0] : null;\n\t\t\t\t\tif (pdf) {\n\t\t\t\t\t\tdispatch(loadPDF(pdf));\n\t\t\t\t\t}\n\t\t\t\t\thandleClose();\n\t\t\t\t}}\n\t\t\t\ttype=\"file\"\n\t\t\t\taccept=\".pdf\"\n\t\t\t/>\n\t\t</Fragment>\n\t);\n};\n","import { useDispatch } from \"react-redux\";\nimport React from \"react\";\nimport { IconButton, Tooltip } from \"@material-ui/core\";\nimport ImportContactsIcon from \"@material-ui/icons/ImportContacts\";\nimport { loadSavedDocument } from \"../../actions\";\nimport text from \"../../../text\";\nexport const LoadDocumentDataButton = ({ document }: { document: string }) => {\n\tconst dispatch = useDispatch();\n\treturn (\n\t\t<Tooltip\n\t\t\ttitle={text.constants.loadSavedDocumentTooltip}\n\t\t\tenterDelay={text.constants.defaultEnterDelay}\n\t\t\tenterNextDelay={text.constants.defaultEnterNextDelay}\n\t\t>\n\t\t\t<IconButton\n\t\t\t\ttype=\"button\"\n\t\t\t\tonClick={() => {\n\t\t\t\t\tdispatch(loadSavedDocument(document));\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<ImportContactsIcon fontSize=\"small\"></ImportContactsIcon>\n\t\t\t</IconButton>\n\t\t</Tooltip>\n\t);\n};\n","import React from \"react\";\nimport { Divider, Card, Grid } from \"@material-ui/core\";\nimport { DeleteDocumentButton } from \"./DeleteDocumentButton\";\nimport { LoadDocumentDataButton } from \"./LoadDocumentDataButton\";\n\nconst DocumentOptionItemButtonRow = ({ document }: { document: string }) => {\n\treturn (\n\t\t<Grid container direction=\"row\">\n\t\t\t<Grid item>\n\t\t\t\t<LoadDocumentDataButton document={document}></LoadDocumentDataButton>\n\t\t\t</Grid>\n\n\t\t\t<Grid item>\n\t\t\t\t<Divider orientation=\"vertical\"></Divider>\n\t\t\t</Grid>\n\n\t\t\t<Grid item>\n\t\t\t\t<DeleteDocumentButton document={document}></DeleteDocumentButton>\n\t\t\t</Grid>\n\t\t</Grid>\n\t);\n};\n\nexport const DocumentOptionItem = ({ document }: { document: string }) => {\n\treturn (\n\t\t<Grid container direction=\"row\" justify=\"space-between\" alignItems=\"center\" spacing={1}>\n\t\t\t<Grid item>{document.replace(\".pdf\", \"\")}</Grid>\n\n\t\t\t<Grid item>\n\t\t\t\t<Card variant=\"outlined\">\n\t\t\t\t\t<DocumentOptionItemButtonRow document={document}></DocumentOptionItemButtonRow>\n\t\t\t\t</Card>\n\t\t\t</Grid>\n\t\t</Grid>\n\t);\n};\n","import { useSelector, useDispatch } from \"react-redux\";\nimport React from \"react\";\nimport { Divider, Menu, MenuItem, IconButton, Typography, Card, Button, Grid } from \"@material-ui/core\";\nimport { downloadDBData } from \"../../actions\";\nimport MoreVertIcon from \"@material-ui/icons/MoreVert\";\nimport display from \"../../../display\";\nimport db from \"../../../db\";\nimport GetAppIcon from \"@material-ui/icons/GetApp\";\nimport { DeleteDocumentButton } from \"./DeleteDocumentButton\";\nimport text from \"../../../text\";\nimport { incrementer } from \"../../../../shared/utils\";\nimport { InputDataSets } from \"./InputDataSets\";\nimport { InputDocument } from \"./InputDocument\";\nimport { DocumentOptionItem } from \"./DocumentOptionItem\";\n\nconst ActiveDocumentOptionItem = ({ document }: { document: string }) => {\n\treturn (\n\t\t<Grid container direction=\"row\" justify=\"space-between\" alignItems=\"center\" spacing={1}>\n\t\t\t<Grid item>{document.replace(\".pdf\", \"\")}</Grid>\n\n\t\t\t<Grid item>\n\t\t\t\t<Card variant=\"outlined\">\n\t\t\t\t\t<DeleteDocumentButton document={document}></DeleteDocumentButton>\n\t\t\t\t</Card>\n\t\t\t</Grid>\n\t\t</Grid>\n\t);\n};\n\nexport const Options = () => {\n\tconst activeDocument = useSelector(display.selectors.getPDFName);\n\tconst documents = useSelector(db.selectors.getDocumentNames).filter((doc) => doc !== activeDocument);\n\n\tconst [anchorEl, setAnchorEl] = React.useState<null | HTMLElement>(null);\n\n\tconst handleClick = (event: React.MouseEvent<HTMLButtonElement>) => {\n\t\tsetAnchorEl(event.currentTarget);\n\t};\n\n\tconst handleClose = () => {\n\t\tsetAnchorEl(null);\n\t};\n\n\tconst dispatch = useDispatch();\n\n\tconst increment = incrementer();\n\n\treturn (\n\t\t<div>\n\t\t\t<IconButton type=\"button\" onClick={handleClick}>\n\t\t\t\t<MoreVertIcon></MoreVertIcon>\n\t\t\t</IconButton>\n\t\t\t<Menu\n\t\t\t\tid=\"simple-menu\"\n\t\t\t\tanchorEl={anchorEl}\n\t\t\t\tkeepMounted\n\t\t\t\topen={Boolean(anchorEl)}\n\t\t\t\tonClose={handleClose}\n\t\t\t\tMenuListProps={{ style: { paddingLeft: \"8px\", paddingRight: \"8px\" } }}\n\t\t\t>\n\t\t\t\t{activeDocument && [\n\t\t\t\t\t<Typography key={increment()} component={\"span\"} variant=\"h6\">\n\t\t\t\t\t\t{text.constants.activeDocumentText}\n\t\t\t\t\t</Typography>,\n\t\t\t\t\t<ActiveDocumentOptionItem key={increment()} document={activeDocument}></ActiveDocumentOptionItem>,\n\t\t\t\t\t<Divider key={increment()} style={{ marginTop: \"6px\" }}></Divider>,\n\t\t\t\t]}\n\t\t\t\t{documents.length > 0 && [\n\t\t\t\t\t<Typography key={increment()} component={\"span\"} variant=\"h6\">\n\t\t\t\t\t\t{text.constants.existingDataText}\n\t\t\t\t\t</Typography>,\n\t\t\t\t\t<Typography key={increment()} component={\"span\"}>\n\t\t\t\t\t\t<ul style={{ listStyleType: \"square\" }}>\n\t\t\t\t\t\t\t{documents.map((document) =>\n\t\t\t\t\t\t\t\tdocument ? (\n\t\t\t\t\t\t\t\t\t<li key={increment()}>\n\t\t\t\t\t\t\t\t\t\t<DocumentOptionItem document={document} key={increment()}></DocumentOptionItem>\n\t\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t) : null\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t</Typography>,\n\t\t\t\t\t<Divider key={increment()} style={{ marginTop: \"6px\" }} />,\n\t\t\t\t]}\n\t\t\t\t<InputDocument handleClose={handleClose} label={\"Load document\"}></InputDocument>\n\t\t\t\t<Divider />\n\t\t\t\t<MenuItem\n\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\tdispatch(downloadDBData());\n\t\t\t\t\t\thandleClose();\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<Button variant=\"contained\" color=\"primary\" disableElevation startIcon={<GetAppIcon></GetAppIcon>}>\n\t\t\t\t\t\t{text.constants.downloadDatasetsText}\n\t\t\t\t\t</Button>\n\t\t\t\t</MenuItem>\n\t\t\t\t<Divider />\n\t\t\t\t<InputDataSets handleClose={handleClose} label={text.constants.uploadDatasetsText}></InputDataSets>\n\t\t\t</Menu>\n\t\t</div>\n\t);\n};\n","import React, { useState } from \"react\";\nimport SearchBar from \"material-ui-search-bar\";\nimport river from \"../../river\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { Grid, Select } from \"@material-ui/core\";\nimport display from \"../../display\";\n\n//TODO: react-pdf alignment is broken for some pdfs and generally for non-body text,\n// seems to be connected to choosing the wrong font\n// font is chosen per page not per item (e.g. body-font for heading/cursive)\n// needs to be fixed before making search\n// otherwise coloring findings not possible / good enough\n\n//TODO: make search for PDF (right now this would need some work to find the correct text-node and partially color it)\n// https://github.com/wojtekmaj/react-pdf/issues/212\n// counter of found words\n// count also in PDF\n// PDFPageProxy\n// getTextContent\n// if not rendered\n// count via Proxy\n// if rendered count via CustomRenderer\n// two dicts to hold which one\n// make window with next/last found\n// current renderer: multiline matches is not support / matches that cross textItems\n// strg +f should jump to the searchbox? Only if I replace the search fully\n// upper / lower case\n\nexport const ClayMemorySearchBar = () => {\n\tconst dispatch = useDispatch();\n\n\tconst contentString = useSelector(river.selectors.getRiverContentFilter);\n\n\tconst [state, setState] = useState(contentString);\n\n\tconst [searchFocus, setSearchFocus] = useState(\"cards\");\n\n\tconst onChangeCards = (newValue: string) => {\n\t\t// auto-reset on empty\n\t\tif (newValue === \"\") dispatch(river.actions.resetContentFilter());\n\t\tsetState(newValue);\n\t};\n\tconst onCancelSearchCards = () => {\n\t\tdispatch(river.actions.resetContentFilter());\n\t};\n\tconst onRequestSearchCards = () => dispatch(river.actions.setContentFilter(state));\n\n\tconst onChangeDocument = (newValue: string) => {\n\t\t// auto-reset on empty\n\t\tif (newValue === \"\") dispatch(display.actions.resetDocumentSearch());\n\t\tsetState(newValue);\n\t};\n\tconst onCancelSearchDocument = () => {\n\t\tdispatch(display.actions.resetDocumentSearch());\n\t};\n\tconst onRequestSearchDocument = () => dispatch(display.actions.setDocumentSearch(state));\n\n\tconst onChange = searchFocus === \"cards\" ? onChangeCards : onChangeDocument;\n\tconst onCancelSearch = searchFocus === \"cards\" ? onCancelSearchCards : onCancelSearchDocument;\n\tconst onRequestSearch = searchFocus === \"cards\" ? onRequestSearchCards : onRequestSearchDocument;\n\n\tconst chooseFocus = (chosenFocus: string) => {\n\t\tsetSearchFocus(chosenFocus);\n\t\tif (chosenFocus === \"cards\") {\n\t\t\tonCancelSearchDocument();\n\t\t} else {\n\t\t\tonCancelSearchCards();\n\t\t}\n\t\tsetState(\"\");\n\t};\n\n\t//TODO: search in other rivers/same river when composing to show similar cards (like in the Anki Addon)\n\treturn (\n\t\t<Grid container direction=\"row\" alignItems=\"center\" spacing={1}>\n\t\t\t{/* <Grid item>\n\t\t\t\t<Select\n\t\t\t\t\tvariant=\"outlined\"\n\t\t\t\t\tcolor=\"secondary\"\n\t\t\t\t\tnative\n\t\t\t\t\tvalue={searchFocus === \"cards\" ? \"Filter cards\" : \"Search document\"}\n\t\t\t\t\tonChange={(\n\t\t\t\t\t\tevent: React.ChangeEvent<{\n\t\t\t\t\t\t\tname?: string | undefined;\n\t\t\t\t\t\t\tvalue: unknown;\n\t\t\t\t\t\t}>\n\t\t\t\t\t) => {\n\t\t\t\t\t\tchooseFocus(event.target.value === \"Search document\" ? \"document\" : \"cards\");\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<option>Filter cards</option>\n\t\t\t\t\t<option>Search document</option>\n\t\t\t\t</Select>\n\t\t\t</Grid> */}\n\t\t\t<Grid item>\n\t\t\t\t<SearchBar\n\t\t\t\t\tvalue={state}\n\t\t\t\t\tplaceholder={searchFocus === \"cards\" ? \"Filter cards\" : \"Search document\"}\n\t\t\t\t\tonChange={onChange}\n\t\t\t\t\tonCancelSearch={onCancelSearch}\n\t\t\t\t\tonRequestSearch={onRequestSearch}\n\t\t\t\t\tcancelOnEscape={true}\n\t\t\t\t/>\n\t\t\t</Grid>\n\t\t</Grid>\n\t);\n};\n","import React from \"react\";\nimport { IconButton, Card, Divider, Grid, Tooltip } from \"@material-ui/core\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport UndoIcon from \"@material-ui/icons/Undo\";\nimport RedoIcon from \"@material-ui/icons/Redo\";\nimport text from \"../../text\";\nimport { getLastUndoableActionComb, getLastRedoableActionComb } from \"../selectors\";\nimport { redoActionHistory, undoActionHistory } from \"../actions\";\n\n// we support undo/redo instead of lengthy confirmation (see The Humane Interface)\nconst UndoButton = () => {\n\tconst dispatch = useDispatch();\n\tconst lastUndoableActionComb = useSelector(getLastUndoableActionComb);\n\t//tooltip needs non-disabled child component\n\treturn (\n\t\t<Tooltip\n\t\t\ttitle={text.constants.undoTooltip}\n\t\t\tenterDelay={text.constants.defaultEnterDelay}\n\t\t\tenterNextDelay={text.constants.defaultEnterNextDelay}\n\t\t>\n\t\t\t<span>\n\t\t\t\t<IconButton\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\tfor (let actionStr of lastUndoableActionComb as string[]) {\n\t\t\t\t\t\t\tdispatch(undoActionHistory(actionStr));\n\t\t\t\t\t\t}\n\t\t\t\t\t}}\n\t\t\t\t\tdisabled={!!!lastUndoableActionComb}\n\t\t\t\t>\n\t\t\t\t\t<UndoIcon></UndoIcon>\n\t\t\t\t</IconButton>\n\t\t\t</span>\n\t\t</Tooltip>\n\t);\n};\nconst RedoButton = () => {\n\tconst dispatch = useDispatch();\n\tconst lastRedoableActionComb = useSelector(getLastRedoableActionComb);\n\treturn (\n\t\t<Tooltip\n\t\t\ttitle={text.constants.redoTooltip}\n\t\t\tenterDelay={text.constants.defaultEnterDelay}\n\t\t\tenterNextDelay={text.constants.defaultEnterNextDelay}\n\t\t>\n\t\t\t<span>\n\t\t\t\t<IconButton\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\tfor (let actionStr of lastRedoableActionComb as string[]) {\n\t\t\t\t\t\t\tdispatch(redoActionHistory(actionStr));\n\t\t\t\t\t\t}\n\t\t\t\t\t}}\n\t\t\t\t\tdisabled={!!!lastRedoableActionComb}\n\t\t\t\t>\n\t\t\t\t\t<RedoIcon></RedoIcon>\n\t\t\t\t</IconButton>\n\t\t\t</span>\n\t\t</Tooltip>\n\t);\n};\n\nexport const UndoRedoCard = () => {\n\treturn (\n\t\t<Card variant=\"outlined\">\n\t\t\t<Grid container direction=\"row\">\n\t\t\t\t<Grid item>\n\t\t\t\t\t<UndoButton></UndoButton>\n\t\t\t\t</Grid>\n\t\t\t\t<Grid item>\n\t\t\t\t\t<Divider orientation=\"vertical\"></Divider>\n\t\t\t\t</Grid>\n\t\t\t\t<Grid item>\n\t\t\t\t\t<RedoButton></RedoButton>\n\t\t\t\t</Grid>\n\t\t\t</Grid>\n\t\t</Card>\n\t);\n};\n","import display from \"../../display\";\nimport river from \"../../river\";\nimport React from \"react\";\nimport { IconButton, Menu, Typography, Grid, Card, Button, FormControlLabel } from \"@material-ui/core\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport VisibilityIcon from \"@material-ui/icons/Visibility\";\nimport { GreenCheckbox } from \"../../../shared/GreenCheckbox\";\n\nconst ShowRiverCheckbox = () => {\n\tconst dispatch = useDispatch();\n\tconst riverShowState = useSelector(river.selectors.getRiverShowState);\n\n\treturn (\n\t\t<Button\n\t\t\tstartIcon={\n\t\t\t\t<FormControlLabel\n\t\t\t\t\tlabel=\"River\"\n\t\t\t\t\tcontrol={<GreenCheckbox checked={riverShowState === \"SHOW\"} />}\n\t\t\t\t></FormControlLabel>\n\t\t\t}\n\t\t\tvariant=\"contained\"\n\t\t\tcolor=\"primary\"\n\t\t\tonClick={() => {\n\t\t\t\tdispatch(river.actions.toggleRiverShowState());\n\t\t\t}}\n\t\t></Button>\n\t);\n};\n\nconst ShowMaterialCheckbox = () => {\n\tconst dispatch = useDispatch();\n\tconst displayShowState = useSelector(display.selectors.getDisplayStatus);\n\n\treturn (\n\t\t<Button\n\t\t\tstartIcon={\n\t\t\t\t<FormControlLabel\n\t\t\t\t\tlabel=\"Material\"\n\t\t\t\t\tcontrol={<GreenCheckbox checked={displayShowState === \"SHOW\"} />}\n\t\t\t\t></FormControlLabel>\n\t\t\t}\n\t\t\tvariant=\"contained\"\n\t\t\tcolor=\"primary\"\n\t\t\tonClick={() => {\n\t\t\t\tdispatch(display.actions.toggleDisplayState());\n\t\t\t}}\n\t\t></Button>\n\t);\n};\n\nexport const ShowHideButton = () => {\n\tconst [anchorEl, setAnchorEl] = React.useState<null | HTMLElement>(null);\n\n\tconst handleClick = (event: React.MouseEvent<HTMLButtonElement>) => {\n\t\tsetAnchorEl(event.currentTarget);\n\t};\n\n\tconst handleClose = () => {\n\t\tsetAnchorEl(null);\n\t};\n\n\treturn (\n\t\t<div>\n\t\t\t<IconButton type=\"button\" onClick={handleClick}>\n\t\t\t\t<VisibilityIcon></VisibilityIcon>\n\t\t\t</IconButton>\n\t\t\t<Menu\n\t\t\t\tanchorEl={anchorEl}\n\t\t\t\tkeepMounted\n\t\t\t\topen={Boolean(anchorEl)}\n\t\t\t\tonClose={handleClose}\n\t\t\t\tMenuListProps={{ style: { paddingLeft: \"8px\", paddingRight: \"8px\" } }}\n\t\t\t>\n\t\t\t\t<Typography variant=\"h6\">Show:</Typography>\n\t\t\t\t<Grid container direction=\"row\" justify=\"space-between\" spacing={1}>\n\t\t\t\t\t<Grid item>\n\t\t\t\t\t\t<Card variant=\"outlined\" style={{ paddingLeft: \"4px\", paddingRight: \"4px\" }}>\n\t\t\t\t\t\t\t<river.components.RiverContentFormGroup></river.components.RiverContentFormGroup>\n\t\t\t\t\t\t</Card>\n\t\t\t\t\t</Grid>\n\n\t\t\t\t\t<Grid item>\n\t\t\t\t\t\t<Card variant=\"outlined\" style={{ padding: \"4px\" }}>\n\t\t\t\t\t\t\t<Grid container direction=\"column\" spacing={1}>\n\t\t\t\t\t\t\t\t<Grid item>\n\t\t\t\t\t\t\t\t\t<ShowRiverCheckbox></ShowRiverCheckbox>\n\t\t\t\t\t\t\t\t</Grid>\n\t\t\t\t\t\t\t\t<Grid item>\n\t\t\t\t\t\t\t\t\t<ShowMaterialCheckbox></ShowMaterialCheckbox>\n\t\t\t\t\t\t\t\t</Grid>\n\t\t\t\t\t\t\t</Grid>\n\t\t\t\t\t\t</Card>\n\t\t\t\t\t</Grid>\n\t\t\t\t</Grid>\n\t\t\t</Menu>\n\t\t</div>\n\t);\n};\n","import display from \"../../display\";\nimport React, { useLayoutEffect, useRef } from \"react\";\nimport { AppBar, Toolbar, Grid, Typography } from \"@material-ui/core\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { Options } from \"./Options/Options\";\nimport { ClayMemorySearchBar } from \"./ClayMemorySearchBar\";\nimport { UndoRedoCard } from \"./UndoRedoButtons\";\nimport { ShowHideButton } from \"./ShowHideButton\";\n\n//TODO: download/load csv for Anki\nexport const ControlBar = () => {\n\tconst materialName = useSelector(display.selectors.getPDFName);\n\tconst offset = useSelector(display.selectors.getTopOffset);\n\tconst ref = useRef<null | HTMLDivElement>(null);\n\n\tconst dispatch = useDispatch();\n\n\tuseLayoutEffect(() => {\n\t\tif (ref.current) {\n\t\t\tconst currentBottom = ref.current.getBoundingClientRect().bottom;\n\t\t\tif (currentBottom !== offset) dispatch(display.actions.setTopOffset(currentBottom));\n\t\t}\n\t}, [ref, dispatch, offset]);\n\n\treturn (\n\t\t<display.components.PageKeyboardControl>\n\t\t\t<AppBar ref={ref} position=\"sticky\">\n\t\t\t\t<Toolbar variant=\"regular\" disableGutters>\n\t\t\t\t\t<Grid container direction=\"row\" alignItems=\"center\" justify=\"space-between\">\n\t\t\t\t\t\t<Grid item xs={6}>\n\t\t\t\t\t\t\t<Grid container direction=\"row\" alignItems=\"center\" spacing={1} style={{ paddingLeft: \"4px\" }}>\n\t\t\t\t\t\t\t\t<Grid item style={{ maxWidth: \"15%\" }}>\n\t\t\t\t\t\t\t\t\t<display.components.PageChooser></display.components.PageChooser>\n\t\t\t\t\t\t\t\t</Grid>\n\n\t\t\t\t\t\t\t\t<Grid item>\n\t\t\t\t\t\t\t\t\t<display.components.PageNavigation></display.components.PageNavigation>\n\t\t\t\t\t\t\t\t</Grid>\n\n\t\t\t\t\t\t\t\t<Grid item>\n\t\t\t\t\t\t\t\t\t<UndoRedoCard></UndoRedoCard>\n\t\t\t\t\t\t\t\t</Grid>\n\n\t\t\t\t\t\t\t\t<Grid item>\n\t\t\t\t\t\t\t\t\t<display.components.ViewTabs></display.components.ViewTabs>\n\t\t\t\t\t\t\t\t</Grid>\n\t\t\t\t\t\t\t</Grid>\n\t\t\t\t\t\t</Grid>\n\n\t\t\t\t\t\t<Grid item xs={2}>\n\t\t\t\t\t\t\t<Grid container justify=\"center\">\n\t\t\t\t\t\t\t\t<Grid item style={{ overflowX: \"auto\" }}>\n\t\t\t\t\t\t\t\t\t<Typography variant=\"subtitle1\">{materialName?.replace(\".pdf\", \"\")}</Typography>\n\t\t\t\t\t\t\t\t</Grid>\n\t\t\t\t\t\t\t</Grid>\n\t\t\t\t\t\t</Grid>\n\n\t\t\t\t\t\t<Grid item xs={4}>\n\t\t\t\t\t\t\t<Grid container direction=\"row\" justify=\"flex-end\" alignItems=\"center\">\n\t\t\t\t\t\t\t\t<Grid item>\n\t\t\t\t\t\t\t\t\t<ClayMemorySearchBar></ClayMemorySearchBar>\n\t\t\t\t\t\t\t\t</Grid>\n\t\t\t\t\t\t\t\t<Grid item>\n\t\t\t\t\t\t\t\t\t<ShowHideButton></ShowHideButton>\n\t\t\t\t\t\t\t\t</Grid>\n\t\t\t\t\t\t\t\t<Grid item>\n\t\t\t\t\t\t\t\t\t<Options></Options>\n\t\t\t\t\t\t\t\t</Grid>\n\t\t\t\t\t\t\t</Grid>\n\t\t\t\t\t\t</Grid>\n\t\t\t\t\t</Grid>\n\t\t\t\t</Toolbar>\n\t\t\t</AppBar>\n\t\t</display.components.PageKeyboardControl>\n\t);\n};\n","import { Reducer } from \"react\";\nimport { ActionCreators } from \"redux-undo\";\nimport cards from \"../cards\";\nimport db from \"../db\";\nimport selection from \"../selection\";\nimport { REDO_ACTION_HISTORY, UNDO_ACTION_HISTORY } from \"./actionTypes\";\n\nexport const selectionActions = [selection.actionTypes.SELECTION_GOAL, selection.actionTypes.SELECTION_SOURCE];\nexport const riverActions = [\n\tcards.actionTypes.CARD_PUSH,\n\tcards.actionTypes.CARD_REMOVE,\n\tdb.actionTypes.LOAD_DOCUMENT_DATA_SETS,\n];\nexport const cardActions = [\n\tdb.actionTypes.LOAD_DOCUMENT_DATA_SETS,\n\tcards.actionTypes.CARD_PUSH,\n\tcards.actionTypes.CARD_REPLACE,\n\tcards.actionTypes.CARD_REMOVE,\n];\nexport const dbActions = [db.actionTypes.LOAD_DOCUMENT_DATA_SETS];\n\nexport const undoableActions = [dbActions, cardActions, riverActions, selectionActions].flat();\n\nexport type Model = { past: string[][]; present: string[] | null; future: string[][] };\n\n//TODO: this is NOT bugfree, somehow I got the present to be erased\n// deletion bug? cant undo some deletions?\n\n//TODO: where to put it instead of model?\nexport const undoRedoActionShield = (reducer: Reducer<any, any>, actionList: string[]) => (state: any, action: any) => {\n\tswitch (action.type) {\n\t\tcase UNDO_ACTION_HISTORY:\n\t\t\tif (actionList.includes(action.payload)) {\n\t\t\t\treturn reducer(state, ActionCreators.undo());\n\t\t\t} else {\n\t\t\t\treturn state;\n\t\t\t}\n\t\tcase REDO_ACTION_HISTORY:\n\t\t\tif (actionList.includes(action.payload)) {\n\t\t\t\treturn reducer(state, ActionCreators.redo());\n\t\t\t} else {\n\t\t\t\treturn state;\n\t\t\t}\n\t\tdefault:\n\t\t\treturn reducer(state, action);\n\t}\n};\nexport const selectionShield = (reducer: Reducer<any, any>) => undoRedoActionShield(reducer, selectionActions);\nexport const cardsShield = (reducer: Reducer<any, any>) => undoRedoActionShield(reducer, cardActions);\nexport const riverShield = (reducer: Reducer<any, any>) => undoRedoActionShield(reducer, riverActions);\nexport const dbShield = (reducer: Reducer<any, any>) => undoRedoActionShield(reducer, dbActions);\n","import { ClayMemoryPayloadAction } from \"../../shared/utils\";\nimport * as t from \"./actionTypes\";\nimport { Model, undoableActions } from \"./model\";\n\nconst initialState: Model = {\n\tpast: [],\n\tpresent: null,\n\tfuture: [],\n};\n\n//TODO: need to reset this sometime (same point as with redux-undo history)\n\nconst actionCombinations = [[]];\nconst combineActions = (actionHistory: string[][], action: string[]) => {\n\t// const curCombinations =\n};\n\nconst control = (state = initialState, { type }: ClayMemoryPayloadAction): Model => {\n\tif (undoableActions.includes(type)) {\n\t\t// only keep full history up to 15\n\t\tlet past = state.past.length === 15 ? state.past.slice(1) : state.past;\n\t\treturn { past: state.present ? past.concat(state.present) : past, present: [type], future: [] };\n\t}\n\tlet present;\n\tswitch (type) {\n\t\tcase t.UNDO_ACTION_HISTORY:\n\t\t\tpresent = state.past.length > 0 ? state.past[state.past.length - 1] : null;\n\t\t\treturn {\n\t\t\t\tpast: state.past.slice(0, state.past.length - 1),\n\t\t\t\tpresent,\n\t\t\t\tfuture: state.present ? [state.present, ...state.future] : state.future,\n\t\t\t};\n\t\tcase t.REDO_ACTION_HISTORY:\n\t\t\tpresent = state.future.length > 0 ? state.future[0] : null;\n\t\t\treturn {\n\t\t\t\tpast: state.present ? [...state.past, state.present] : state.past,\n\t\t\t\tpresent,\n\t\t\t\tfuture: state.future.slice(1),\n\t\t\t};\n\t\tcase t.REMOVE_ACTION_HISTORY:\n\t\t\treturn initialState;\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n\nexport default control;\n","import * as actions from \"./actions\";\nimport * as components from \"./components\";\nimport * as selectors from \"./selectors\";\nimport * as constants from \"./constants\";\nimport * as model from \"./model\";\nimport reducer from \"./reducer\";\n\nexport default { actions, components, selectors, constants, reducer, model };\n","import React from \"react\";\nimport Grid from \"@material-ui/core/Grid\";\nimport control from \"../modules/control\";\nimport selection from \"../modules/selection\";\nimport display from \"../modules/display\";\n\nexport function ReaderScene() {\n\treturn (\n\t\t<div>\n\t\t\t<display.components.HTMLElementMeasurer></display.components.HTMLElementMeasurer>\n\t\t\t<Grid\n\t\t\t\tcontainer\n\t\t\t\tjustify=\"center\"\n\t\t\t\tdirection=\"column\"\n\t\t\t\talignItems=\"stretch\"\n\t\t\t\tstyle={{ height: \"100%\", width: \"100%\" }}\n\t\t\t>\n\t\t\t\t<Grid item>\n\t\t\t\t\t<control.components.ControlBar></control.components.ControlBar>\n\t\t\t\t</Grid>\n\n\t\t\t\t<Grid item>\n\t\t\t\t\t<display.components.Display></display.components.Display>\n\t\t\t\t</Grid>\n\t\t\t</Grid>\n\t\t\t<selection.components.ContextMenu></selection.components.ContextMenu>\n\t\t\t<selection.components.SelectionSnackbar></selection.components.SelectionSnackbar>\n\t\t</div>\n\t);\n}\n","import storage from \"redux-persist/lib/storage\"; // defaults to localStorage for web\nimport { createTransform } from \"redux-persist\";\nimport { DisplayData, DisplayStatus, View } from \"./modules/display/model\";\nimport display from \"./modules/display\";\nimport { SingleOrigin } from \"./modules/cards/model/origin\";\nimport { CardRiverState } from \"./modules/river/model\";\nimport river from \"./modules/river\";\n\n// TODO: undo/redo seems to have some issues after loading? or maybe just my local state? disable for study\n\n// to get the correct object with reselect, I added .present to all getAll that belong do undoable modules\n\n//TODO: find way to save PDF in browser, maybe manually use indexeddb and use that in transform?\n// idea: make store-field pdfAsBase64 and use thunk for async-filling the field, then when reloading, use thunk to format\n// const reader = new FileReaderSync();\n\n// function readFileAsync(file: File) {\n// \treturn new Promise((resolve) => {\n// \t\treader.onload = () => {\n// \t\t\tresolve(reader.result);\n// \t\t};\n// \t\treader.onerror = () => resolve(null);\n\n// \t\treader.readAsDataURL(file);\n// \t});\n// }\n\nconst removeDOMObjectsFromDisplayData = (inboundState: DisplayData) => {\n\tlet pdf = null;\n\t// if (inboundState.pdf) {\n\t// \tpdf = await readFileAsync(inboundState.pdf);\n\t// }\n\tconst result = { ...inboundState, documentRef: null, materialData: null, pdf };\n\treturn result;\n};\n\n//TODO: create persistable type for the state in model\n\nconst addDOMObjectsToDisplayData = (outboundState: {\n\tpdf: null;\n\tpdfName?: string;\n\tdisplayStatus: DisplayStatus;\n\tcurrentPage: number;\n\tscrollToPage: number | null;\n\ttotalPages: number;\n\twindowMeasurements: { width: number; height: number } | null;\n\tspanOrigin: null | SingleOrigin;\n\tdocumentSearch: string;\n\ttopOffset: number;\n\tcurrentView: View;\n}): DisplayData => {\n\treturn {\n\t\t...outboundState,\n\t\tpdf: undefined,\n\t\tspanOrigin: null,\n\t\twindowMeasurements: null,\n\t\tdocumentSearch: \"\",\n\t};\n};\n\nconst displayTransform = createTransform(\n\t(inboundState: DisplayData) => {\n\t\treturn removeDOMObjectsFromDisplayData(inboundState);\n\t},\n\t(outboundState): DisplayData => {\n\t\treturn addDOMObjectsToDisplayData(outboundState);\n\t},\n\t{ whitelist: [display.constants.NAME] }\n);\n\nconst removeContentFilter = (state: CardRiverState): CardRiverState => {\n\treturn { ...state, contentFilter: \"\" };\n};\n\nconst riverTransform = createTransform(\n\t(inboundState: { present: CardRiverState; future: CardRiverState[]; past: CardRiverState[] }) => {\n\t\treturn inboundState;\n\t},\n\t(outboundState): { present: CardRiverState; future: CardRiverState[]; past: CardRiverState[] } => {\n\t\treturn {\n\t\t\tpresent: removeContentFilter(outboundState.present),\n\t\t\tfuture: outboundState.future.map(removeContentFilter),\n\t\t\tpast: outboundState.past.map(removeContentFilter),\n\t\t};\n\t},\n\t{ whitelist: [river.constants.NAME] }\n);\n\nexport const persistConfig = {\n\tkey: \"root\",\n\tstorage,\n\ttransforms: [displayTransform, riverTransform],\n};\n","import { createStore } from \"redux\";\nimport { applyMiddleware } from \"redux\";\nimport thunk from \"redux-thunk\";\nimport { combineReducers } from \"redux\";\nimport river from \"./modules/river\";\nimport display from \"./modules/display\";\nimport cards from \"./modules/cards\";\nimport { persistStore, persistReducer } from \"redux-persist\";\nimport undoable, { includeAction } from \"redux-undo\";\nimport { persistConfig } from \"./persist\";\nimport db from \"./modules/db\";\nimport selection from \"./modules/selection\";\nimport { composeWithDevTools } from \"redux-devtools-extension/logOnlyInProduction\";\nimport control from \"./modules/control\";\nimport { cardsShield, dbShield, riverShield, selectionShield } from \"./modules/control/model\";\n\n//TODO: make limit for undo (right now its fine, if we reset on document-upload / reload)\n//TODO: make snackbar for which action is undone/redone\n\nconst rootReducer = combineReducers({\n\t[control.constants.NAME]: control.reducer,\n\t[selection.constants.NAME]: selectionShield(\n\t\tundoable(selection.reducer, {\n\t\t\tfilter: includeAction(control.model.selectionActions),\n\t\t\tlimit: 15,\n\t\t})\n\t),\n\t[river.constants.NAME]: riverShield(\n\t\tundoable(river.reducer, {\n\t\t\tfilter: includeAction(control.model.riverActions),\n\t\t\tlimit: 15,\n\t\t})\n\t),\n\t[display.constants.NAME]: display.reducer,\n\t[cards.constants.NAME]: cardsShield(\n\t\tundoable(cards.reducer, {\n\t\t\tfilter: includeAction(control.model.cardActions),\n\t\t\tlimit: 15,\n\t\t})\n\t),\n\t[db.constants.NAME]: dbShield(\n\t\tundoable(db.reducer, {\n\t\t\tfilter: includeAction(control.model.dbActions),\n\t\t\tlimit: 15,\n\t\t})\n\t),\n});\n\nconst stateSanitizer = (state: any) => {\n\treturn state.displayData.pdf ? { ...state, displayData: { ...state.displayData, pdf: \"PDF_FILE_IS_HERE\" } } : state;\n};\n\nconst persistedReducer = persistReducer(persistConfig, rootReducer);\n\nconst composeEnhancers = composeWithDevTools({ stateSanitizer });\nconst enhancer = composeEnhancers(applyMiddleware(thunk));\n\nexport const store = createStore(persistedReducer, enhancer);\n\nexport const persistor = persistStore(store);\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { ReaderScene } from \"./scene/ReaderScene\";\nimport { Provider } from \"react-redux\";\nimport { store, persistor } from \"./store\";\nimport { PersistGate } from \"redux-persist/es/integration/react\";\n// Load Roboto typeface\nrequire(\"typeface-roboto\");\n\nReactDOM.render(\n\t<React.StrictMode>\n\t\t<Provider store={store}>\n\t\t\t<PersistGate loading={null} persistor={persistor}>\n\t\t\t\t<ReaderScene></ReaderScene>\n\t\t\t</PersistGate>\n\t\t</Provider>\n\t</React.StrictMode>,\n\tdocument.getElementById(\"root\")\n);\n"],"sourceRoot":""}