{"version":3,"sources":["modules/select/constants.ts","modules/select/actionTypes.ts","shared/utils.ts","modules/analyze/services/span.ts","shared/rect.ts","modules/analyze/services/materialGroupData.ts","modules/analyze/services/str.ts","modules/analyze/actionTypes.ts","modules/analyze/constants.ts","modules/analyze/selectors.ts","modules/analyze/actions.ts","modules/analyze/reducer.ts","modules/analyze/components/DataGuardHOC.tsx","shared/ShowHOC.tsx","modules/analyze/index.ts","modules/display/actionTypes.ts","modules/display/constants.ts","modules/display/selectors.ts","modules/display/actions.ts","modules/display/components/PDFDocument/PDFDocument.tsx","modules/display/components/PDFUpload.tsx","modules/display/components/NavigationButtons.tsx","modules/display/components/ShowMaterialButton.tsx","modules/display/components/PageChooser/PageChooser.tsx","modules/display/reducer.ts","modules/display/index.ts","modules/select/selectors.ts","modules/select/actions.ts","modules/select/services/updateSelectionGroup.ts","modules/select/components/WordLayer.tsx","modules/select/components/DocumentCanvas.tsx","modules/select/components/SelectionTypeButton.tsx","modules/select/reducer.ts","modules/select/index.ts","modules/control/hooks/useEventListener.tsx","modules/focus/constants.ts","modules/focus/actionTypes.ts","modules/focus/selectors.ts","modules/focus/actions.ts","modules/focus/reducer.ts","modules/focus/index.ts","modules/creation/constants.ts","modules/creation/actionTypes.ts","modules/cards/services/config.ts","modules/cards/constants.ts","modules/cards/actionTypes.ts","modules/cards/selectors.ts","modules/cards/actions.ts","modules/cards/reducer.ts","modules/cards/index.ts","modules/creation/actions.ts","modules/creation/reducer.ts","modules/river/constants.ts","modules/river/selectors.ts","modules/river/components/HybridCardField.tsx","modules/river/components/Card.tsx","modules/river/components/CardRiver.tsx","modules/river/actionTypes.ts","modules/river/components/ShowRiverButton.tsx","modules/river/actions.ts","modules/river/reducer.ts","modules/river/index.ts","modules/creation/selectors.ts","modules/creation/components/ContextMenu.tsx","modules/creation/utils.ts","modules/creation/index.ts","modules/control/services/keyboardControl.ts","modules/control/components/Control.tsx","modules/control/services/mouseControl.ts","modules/control/components/ControlBar.tsx","modules/control/index.ts","scenes/ReaderScene.tsx","store.ts","index.tsx","../node_modules/pdfjs-dist/build sync"],"names":["NAME","SECTION_UPDATE","SECTION_STATE","SELECTION_TYPE","SELECTED_STRING","incrementer","counter","curCounter","expandSpan","span","rect","getBoundingClientRect","rectHeight","bottom","y","isDistHigherThanFirstHeight","rect2","firstHeight","Math","abs","rectsYDist","materialGroupData","container","spans","Array","from","querySelectorAll","length","expandedSpans","groupingComparator","previousSpan","groups","index","currentSpan","push","groupExpandedSpans","exSpan","expSpan2","groupExpandedSpansAccordingToHeightDiff","sort","exSpan2","sortExpandedSpansAccordingToY","map","expandSpans","group","x","sortExpandedSpansAccordingToX","boundingRects","splitExpandedSpans","reduce","prev","cur","materialSpanGroups","materialBoundingRectGroups","materialWordGroups","result","textNode","childNodes","textContent","possiblyWords","split","startOffset","endOffset","word","range","document","createRange","setStart","setEnd","spanToWordRanges","materialWordSelectionGroups","words","_","MATERIAL_DATA","SELECTION_UPDATE","getAll","state","getTimeStamp","createSelector","materialDataTimeStamp","getWordSelectionGroups","getWordRangeGroups","getMaterialSpanGroups","getMaterialBoundingRectGroups","getDataExists","timestamp","createDataConditionalSelector","realSelector","show","captureMaterialData","documentRef","dispatch","getState","current","startTime","Date","now","curMaterialGroupData","payload","type","t","tries","ms","func","increment","timeout","setInterval","clearInterval","tryInterval","updateSelectionGroup","updatedSelectionGroup","sectionIndex","newSelectionGroups","initialState","Infinity","materialData","DataGuardHOC","Component","propsSelector","dispatchSelector","connect","InputComponent","props","actions","actionTypes","constants","reducer","selectors","components","PDF_UPLOADED","MATERIAL_LOADED","DISPLAY_STATUS","PAGE_UPDATE","getPDF","pdf","getRenderCritialData","currentPage","getTotalPages","totalPages","getCurrentPage","getPageControlData","getDocumentRef","getDisplayStatus","displayStatus","displayStatusIsShow","status","materialUploaded","event","files","target","materialLoaded","materialRendered","setPage","page","pageCorrections","newPage","movePage","nextPage","previousPage","toggleDisplayState","displayState","pdfjs","GlobalWorkerOptions","workerSrc","version","options","cMapUrl","cMapPacked","PDFDocumentContainer","analyze","parentSize","useDispatch","file","onLoadSuccess","numPages","inputRef","onItemClick","pageNumber","parseInt","width","onRenderSuccess","forEach","layer","style","top","left","transform","PDFUploadContainer","onUpload","onChange","accept","PreviousButton","IconButton","onClick","NextButton","ShowMaterialButton","useState","outlined","setOutlined","nonDigitRegEx","PageChooser","useSelector","error","value","toString","userInput","setState","Typography","variant","TextField","onKeyDown","key","preventDefault","submittedValue","possiblePage","trim","match","asInt","validatePageChoice","createRef","getSectionIndex","getUpdateAllowed","sectionUpdateAllowed","getSectionMovementState","sectionMovementState","getCurrentSpanGroup","spanGroups","getCurrentBoundingRectGroup","boundingRectGroups","getCurrentSelectionGroup","selectionGroups","getCurrentWordRangeGroup","wordRangeGroups","getCurrentSelectedWordRanges","selectionGroup","wordRangeGroup","flatMap","rangeArr","lineIndex","filter","getManuallySelectedString","manuallySelectedString","getCurrentRangeArrStr","join","getCurrentSelectedString","str","rangeArrStr","getSelectionType","selectionType","selectionTypeIsSection","getOverlayRelevantData","display","spanGroup","movementState","updateSelection","foundSpan","newSelectionGroup","oneIndex","indexOf","zeroIndex","lastIndexOf","reverse","toggleSectionMovementState","updateSection","updateType","lastIndex","updateSelectionType","toggleSelectionType","updateManuallySelectedString","resetManuallySelectedString","BoundingRectRect","xOffset","yOffset","boundingRect","height","WordLayer","color","showRects","boundingRectRects","useMemo","flatWordRanges","flatSelectionGroup","containerRect","shadowBlur","stroke","opacity","val","wordRangesToRects","flat","useEffect","focus","scrollIntoView","behavior","block","inline","DocumentCanvasContainer","setHeight","useLayoutEffect","position","pointerEvents","zIndex","SelectionTypeButton","disabledSectionData","resetedSectionData","useEventListener","eventName","handler","savedHandler","useRef","eventListener","addEventListener","removeEventListener","FOCUS_UPDATE","getFocus","updateFocus","tryUpdateFocus","toggleContextMenuFocus","TOGGLE_CONTEXT_MENU","CLOSE_CONTEXT_MENU","OPEN_CONTEXT_MENU","updateContentStrFunctions","REPLACE","newStr","APPEND","oldStr","creationFunctions","NOTE","oldConfig","partialUpdateFunction","content","Q","q","A","a","contentStringToConfig","contentStr","creationType","currentCard","createPartialUpdateContentStrFunction","CARD_UPDATE","CARD_PUSH","cards","getLastCardIDNumber","lastCardIDNumber","getCards","cardPush","cardPayload","card","cardID","cardUpdate","updateCardContent","contentString","riverID","config","pushCardContent","intialState","services","cardObj","toggleContextMenu","closeContextMenu","openContextMenu","triggerSelectionGrab","selectedString","select","undefined","open","menuRef","qaRefs","creationData","getRiverMakeUps","riverMakeUps","getActiveRiverMakeUpID","activeRiverMakeUpID","getActiveRiverMakeUp","makeUps","id","getActiveRiverCardIDs","makeUp","cardIDs","getActiveRiverCards","makeUpCardIDs","getRiverShowState","riverShowState","riverShowStateIsShow","HybridCardField","storeValue","saveChanges","rest","mutableValue","onBlur","NoteCard","fullWidth","label","backgroundColor","InputLabelProps","QACard","Grid","direction","spacing","item","Card","GridDivider","Divider","CardRiver","elevation","setElevation","riverCards","gridItems","arr","toCardGridItemsWithDividers","Accordion","defaultExpanded","onMouseEnter","onMouseLeave","AccordionSummary","AccordionDetails","justify","alignItems","RIVER_SHOW_STATE","ShowRiverButton","RiverMakeUp1","active","lastRiverIDNumber","riverMakeUp","getContextMenuState","getContextMenuRef","getContextMenuQARefs","getContextMenuInitData","river","boundingRectGroup","NewQACard","MenuItem","NewNoteCard","SingleOptionItem","cardConfig","dispatchRiver","QAOptionItem","qaRef","parentMenuOpen","ref","CardConfigItem","ContextMenuContainer","dispatchRiverOne","partialRiverDispatch","qaRefIndex","Menu","keepMounted","anchorReference","anchorPosition","contextMenuContainsTargetNode","refObject","parentNode","querySelector","contains","utils","keyEventDispatcher","keyMap","action","pageControlKeyMap","ArrowLeft","ArrowRight","sectionControlKeyMap","ArrowDown","ArrowUp","selectionControlKeyMap","d","w","s","contextMenuControlKeyMap","creation","selectionFocusSectionDispatcher","selectionFocusMouseDispatcher","focusDispatcherMap","SELECTION","CONTEXT_MENU","EDITOR","CONTROL","ControlContainer","keyDownControl","userFocus","dispatcher","mouseDownControl","mouseUpControl","selection","getSelection","selectedStr","ControlBar","AppBar","Toolbar","ReaderSceneRiverColumn","Paper","ReaderSceneMaterialColumnWithSize","withSize","monitorHeight","noPlaceholder","size","ReaderScene","showMaterial","showRiver","control","rootReducer","combineReducers","enhancer","composeWithDevTools","stateSanitizer","newState","displayData","composeEnhancers","applyMiddleware","thunk","store","createStore","ReactDOM","render","StrictMode","getElementById","webpackEmptyContext","req","e","Error","code","keys","resolve","module","exports"],"mappings":"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","file":"static/js/main.23cae690.chunk.js","sourcesContent":["export const NAME = \"selectionData\";\n","import { NAME } from \"./constants\";\n\nexport const SECTION_UPDATE = NAME + \"/SECTION_UPDATE\";\nexport const SECTION_STATE = NAME + \"/SECTION_STATE\";\nexport const SELECTION_TYPE = NAME + \"/SELCTION_TYPE\";\nexport const SELECTED_STRING = NAME + \"/SELECTED_STRING\";\n","export const incrementer = () => {\n\tlet counter = 0;\n\treturn () => {\n\t\tconst curCounter = counter;\n\t\tcounter++;\n\t\treturn curCounter;\n\t};\n};\n\nexport const tryInterval = (tries: number, ms: number, func: () => boolean) => {\n\tconst increment = incrementer();\n\tconst timeout = setInterval(() => {\n\t\tif (increment() > tries) {\n\t\t\tclearInterval(timeout);\n\t\t\treturn;\n\t\t}\n\n\t\tif (func()) clearInterval(timeout);\n\t}, ms);\n};\n","import { strToWords } from \"./str\";\n\nexport const splitExpandedSpans = (expandedSpans: ExpandedSpan[]) => {\n\tconst spans = [];\n\tconst boundingRects = [];\n\n\tfor (const exSpan of expandedSpans) {\n\t\tspans.push(exSpan.span);\n\t\tboundingRects.push(exSpan.rect);\n\t}\n\n\treturn { spans, boundingRects };\n};\n\nexport const sortExpandedSpansAccordingToX = (expandedSpans: ExpandedSpan[]) =>\n\texpandedSpans.sort((exSpan, exSpan2) => exSpan.rect.x - exSpan2.rect.x);\n\nexport const sortExpandedSpansAccordingToY = (expandedSpans: ExpandedSpan[]) =>\n\texpandedSpans.sort((exSpan, exSpan2) => exSpan.rect.y - exSpan2.rect.y);\n\nexport type ExpandedSpanGroupingComparator = (expandSpan: ExpandedSpan, expandSpan2: ExpandedSpan) => boolean;\n\nexport const groupExpandedSpans = (\n\texpandedSpans: ExpandedSpan[],\n\tgroupingComparator: ExpandedSpanGroupingComparator\n) => {\n\t// depends on the spans being sorted according to grouping\n\n\tlet previousSpan = expandedSpans[0];\n\tconst groups = [[previousSpan]];\n\n\tfor (let index = 1; index < expandedSpans.length; index++) {\n\t\tconst currentSpan = expandedSpans[index];\n\t\t//new group\n\t\tif (groupingComparator(previousSpan, currentSpan)) groups.push([]);\n\t\tgroups[groups.length - 1].push(currentSpan);\n\t\tpreviousSpan = currentSpan;\n\t}\n\n\treturn groups;\n};\n\nexport type ExpandedSpan = { span: HTMLSpanElement; rect: DOMRect };\n\nexport const expandSpans = (spans: HTMLSpanElement[]) => spans.map(expandSpan);\n\nexport const expandSpan = (span: HTMLSpanElement): ExpandedSpan => {\n\treturn { span, rect: span.getBoundingClientRect() };\n};\n\nexport function spanToWordRanges(span: HTMLSpanElement) {\n\tconst result: Range[] = [];\n\n\t//node is needed for Range object\n\tconst textNode = span.childNodes[0];\n\tconst textContent = span.textContent;\n\n\tif (textContent) {\n\t\tconst possiblyWords = strToWords(textContent);\n\n\t\t//to create the Range objects we need the correct offset, otherwise it would be more straightforward parsing\n\t\tlet startOffset = 0;\n\t\tlet endOffset = 0;\n\n\t\tfor (const word of possiblyWords) {\n\t\t\tconst moreThanEmptySpace = word.length >= 1;\n\t\t\tif (moreThanEmptySpace) {\n\t\t\t\tendOffset += word.length;\n\n\t\t\t\tconst firstRange = result.length > 0;\n\t\t\t\t// offset is >= 1 because we split at \" \" and not \"\"\n\t\t\t\tif (firstRange) endOffset += 1;\n\n\t\t\t\tconst range = document.createRange();\n\n\t\t\t\trange.setStart(textNode, startOffset);\n\t\t\t\trange.setEnd(textNode, endOffset);\n\n\t\t\t\tresult.push(range);\n\n\t\t\t\tstartOffset += word.length + 1;\n\t\t\t} else {\n\t\t\t\t// if empty space, this means str started with empty space or ended with it, so need to move forward\n\t\t\t\tstartOffset += 1;\n\t\t\t\tendOffset += 1;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn result;\n}\n","export const rectHeight = (rect: DOMRect) => rect.bottom - rect.y;\n\nexport const rectsYDist = (rect: DOMRect, rect2: DOMRect) => Math.abs(rect.y - rect2.y);\n\nexport const isDistHigherThanFirstHeight = (rect: DOMRect, rect2: DOMRect) => {\n\t// assumes that the spans are directly beneath each other\n\t// and that the additional offset between y-left-top of spans (between text) is at most 0.5*height\n\tconst firstHeight = rectHeight(rect);\n\treturn rectsYDist(rect, rect2) > 1.5 * firstHeight;\n};\n","import { MaterialGroupData } from \"../model\";\nimport {\n\tspanToWordRanges,\n\texpandSpans,\n\tgroupExpandedSpans,\n\tsortExpandedSpansAccordingToY,\n\tsortExpandedSpansAccordingToX,\n\tExpandedSpan,\n\tsplitExpandedSpans,\n} from \"./span\";\nimport { isDistHigherThanFirstHeight } from \"../../../shared/rect\";\n\nconst groupExpandedSpansAccordingToHeightDiff = (expandedSpans: ExpandedSpan[]) =>\n\tgroupExpandedSpans(expandedSpans, (exSpan, expSpan2) => isDistHigherThanFirstHeight(exSpan.rect, expSpan2.rect));\n\nexport const materialGroupData = (container: HTMLDivElement): MaterialGroupData | null => {\n\t// assumes all spans inside the document are relevant (potentially multiple pages)\n\tconst spans = Array.from(container.querySelectorAll(\"span\"));\n\tif (spans.length === 0) return null;\n\n\tconst expandedSpans = sortExpandedSpansAccordingToY(expandSpans(spans));\n\tconst expandedSpanGroups = groupExpandedSpansAccordingToHeightDiff(expandedSpans).map((group) =>\n\t\tsortExpandedSpansAccordingToX(group)\n\t);\n\tconst splitGroups = expandedSpanGroups.map((group) => splitExpandedSpans(group));\n\tconst [materialSpanGroups, materialBoundingRectGroups] = splitGroups.reduce(\n\t\t(prev, cur) => {\n\t\t\t(prev[0] as HTMLSpanElement[][]).push(cur.spans);\n\t\t\t(prev[1] as DOMRect[][]).push(cur.boundingRects);\n\t\t\treturn prev;\n\t\t},\n\t\t[[], []]\n\t);\n\n\tconst materialWordGroups = (materialSpanGroups as HTMLSpanElement[][]).map((group) =>\n\t\tgroup.map((span) => spanToWordRanges(span))\n\t);\n\n\tconst materialWordSelectionGroups: (1 | 0)[][][] = materialWordGroups.map((group) =>\n\t\tgroup.map((words) => words.map((_) => 1))\n\t);\n\n\treturn {\n\t\tmaterialSpanGroups,\n\t\tmaterialBoundingRectGroups,\n\t\tmaterialWordGroups,\n\t\tmaterialWordSelectionGroups,\n\t};\n};\n","export const strToWords = (str: string) => str.split(\" \");\n","export const MATERIAL_DATA = \"analyze/MATERIAL_DATA\";\nexport const SELECTION_UPDATE = \"analyze/SELECTION_UPDATE\";\n","export const NAME = \"materialData\";\n","import { createSelector } from \"reselect\";\nimport { MaterialData, MaterialWordData, MaterialSpanData } from \"./model\";\nimport { NAME } from \"./constants\";\n\nexport const getAll = (state: any) => state[NAME];\n\nexport const getTimeStamp = createSelector(getAll, (state: MaterialData) => state.materialDataTimeStamp);\n\nexport const getWordSelectionGroups = createSelector(\n\tgetAll,\n\t(state: MaterialWordData) => state.materialWordSelectionGroups\n);\n\nexport const getWordRangeGroups = createSelector(getAll, (state: MaterialWordData) => state.materialWordGroups);\n\nexport const getMaterialSpanGroups = createSelector(getAll, (state: MaterialSpanData) => state.materialSpanGroups);\n\nexport const getMaterialBoundingRectGroups = createSelector(\n\tgetAll,\n\t(state: MaterialSpanData) => state.materialBoundingRectGroups\n);\n\nexport const getDataExists = createSelector(getTimeStamp, (timestamp) => timestamp > 0);\n\nexport const createDataConditionalSelector = (realSelector: (state: any) => any) => (state: any) =>\n\tgetDataExists(state) ? { ...realSelector(state), show: true } : {};\n","import { Dispatch } from \"redux\";\nimport { tryInterval } from \"../../shared/utils\";\nimport { materialGroupData } from \"./services/materialGroupData\";\nimport * as t from \"./actionTypes\";\nimport { MaterialData } from \"./model\";\nimport { getTimeStamp, getWordSelectionGroups } from \"./selectors\";\nimport { RefObject } from \"react\";\n\n// text-layer is not really guaranteed to be rendered on render \"success\",\n// so we use this ugly \"try ten times\" approach\nexport function captureMaterialData(documentRef: RefObject<any>) {\n\treturn (dispatch: Dispatch, getState: Function) => {\n\t\tconst state = getState();\n\t\tconst container = documentRef.current;\n\t\tif (container) {\n\t\t\t// TODO: still possibility of race-condition,\n\t\t\t// maybe check on each section update if the number is congruent and if not actualize?\n\t\t\t// TODO: make fluid movement for changing from non-existing section on new page to existing one\n\n\t\t\tconst startTime = Date.now();\n\n\t\t\t// try once before going into intervals (most times once should work)\n\t\t\tconst curMaterialGroupData = materialGroupData(container as HTMLDivElement);\n\t\t\tif (curMaterialGroupData && getTimeStamp(state) < startTime) {\n\t\t\t\tconst payload: MaterialData = {\n\t\t\t\t\t...curMaterialGroupData,\n\t\t\t\t\tmaterialDataTimeStamp: startTime,\n\t\t\t\t};\n\t\t\t\tdispatch({ type: t.MATERIAL_DATA, payload });\n\t\t\t} else {\n\t\t\t\ttryInterval(10, 20, () => {\n\t\t\t\t\tconst curMaterialGroupData = materialGroupData(container as HTMLDivElement);\n\t\t\t\t\tif (curMaterialGroupData && getTimeStamp(getState()) < startTime) {\n\t\t\t\t\t\tconst payload: MaterialData = {\n\t\t\t\t\t\t\t...curMaterialGroupData,\n\t\t\t\t\t\t\tmaterialDataTimeStamp: startTime,\n\t\t\t\t\t\t};\n\t\t\t\t\t\tdispatch({ type: t.MATERIAL_DATA, payload });\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t\treturn false;\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t};\n}\n\nexport const updateSelectionGroup = (updatedSelectionGroup: (1 | 0)[][], sectionIndex: number) => {\n\treturn (dispatch: Dispatch, getState: Function) => {\n\t\tconst state = getState();\n\t\tconst newSelectionGroups = [...getWordSelectionGroups(state)];\n\t\tnewSelectionGroups[sectionIndex] = updatedSelectionGroup;\n\t\tdispatch({ type: t.SELECTION_UPDATE, payload: newSelectionGroups });\n\t};\n};\n","import * as t from \"./actionTypes\";\nimport { MaterialData } from \"./model\";\n\nconst initialState: MaterialData = { materialDataTimeStamp: -Infinity };\n\nconst materialData = (state = initialState, { type, payload }: { type: string; payload: any }): MaterialData => {\n\tswitch (type) {\n\t\tcase t.MATERIAL_DATA:\n\t\t\treturn payload;\n\t\tcase t.SELECTION_UPDATE:\n\t\t\treturn { ...state, materialWordSelectionGroups: payload };\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n\nexport default materialData;\n","import { FunctionComponent } from \"react\";\nimport { connect, ConnectedComponent } from \"react-redux\";\nimport { Dispatch } from \"redux\";\nimport { createDataConditionalSelector } from \"../selectors\";\nimport { ShowHOC } from \"../../../shared/ShowHOC\";\n\nexport const DataGuardHOC = (\n\tComponent: FunctionComponent<any>,\n\tpropsSelector: (state: any) => any,\n\tdispatchSelector?: (dispatch: Dispatch) => any\n): ConnectedComponent<(props: any) => JSX.Element | null, any> => {\n\t// renders null if data-selector returns {}\n\treturn connect(createDataConditionalSelector(propsSelector), dispatchSelector)(ShowHOC(Component));\n};\n","import React, { FunctionComponent } from \"react\";\n\nexport const ShowHOC = (InputComponent: FunctionComponent<any>) => {\n\treturn ({ show, ...props }: { show: boolean }) => {\n\t\treturn show ? <InputComponent {...props}></InputComponent> : null;\n\t};\n};\n","import * as actions from \"./actions\";\nimport * as constants from \"./constants\";\nimport * as actionTypes from \"./actionTypes\";\nimport reducer from \"./reducer\";\nimport * as selectors from \"./selectors\";\nimport * as components from \"./components\";\n\nexport default { actions, actionTypes, constants, reducer, selectors, components };\n","export const PDF_UPLOADED = \"display/PDF_UPLOADED\";\nexport const MATERIAL_LOADED = \"display/MATERIAL_LOADED\";\nexport const DISPLAY_STATUS = \"display/DISPLAY_STATUS\";\nexport const PAGE_UPDATE = \"display/PAGE_UPDATE\";\n","export const NAME = \"displayData\";\n","import { createSelector } from \"reselect\";\nimport { DisplayData } from \"./model\";\nimport { NAME } from \"./constants\";\n\nexport const getAll = (state: any) => state[NAME];\n\nexport const getPDF = createSelector(getAll, (state: DisplayData) => {\n\treturn { pdf: state.pdf };\n});\n\nexport const getRenderCritialData = createSelector(getAll, (state: DisplayData) => {\n\treturn {\n\t\tpdf: state.pdf,\n\t\tcurrentPage: state.currentPage,\n\t\tdocumentRef: state.documentRef,\n\t};\n});\n\nexport const getTotalPages = createSelector(getAll, (state: DisplayData) => state.totalPages);\n\nexport const getCurrentPage = createSelector(getAll, (state: DisplayData) => state.currentPage);\n\nexport const getPageControlData = createSelector(\n\tgetTotalPages,\n\tgetCurrentPage,\n\t(totalPages: number | undefined, currentPage: number) => {\n\t\treturn { currentPage, totalPages };\n\t}\n);\n\nexport const getDocumentRef = createSelector(getAll, (state: DisplayData) => state.documentRef);\n\nexport const getDisplayStatus = createSelector(getAll, (state: DisplayData) => state.displayStatus);\n\nexport const displayStatusIsShow = createSelector(getDisplayStatus, (status) => status === \"SHOW\");\n","import { ChangeEvent } from \"react\";\nimport { Dispatch } from \"redux\";\nimport * as t from \"./actionTypes\";\nimport { DisplayStatus, PageMove } from \"./model\";\nimport { getPageControlData, getDisplayStatus } from \"./selectors\";\n\nexport const materialUploaded = (event: ChangeEvent<HTMLInputElement>) => {\n\treturn (dispatch: Dispatch) => {\n\t\tconst files = event.target.files;\n\t\tconst pdf = files ? files[0] : null;\n\t\tif (pdf) dispatch({ type: t.PDF_UPLOADED, payload: pdf });\n\t};\n};\n\nexport const materialLoaded = (totalPages: number) => {\n\treturn { type: t.MATERIAL_LOADED, payload: totalPages };\n};\n\nexport const materialRendered = (): { type: string; payload: DisplayStatus } => {\n\treturn { type: t.DISPLAY_STATUS, payload: \"SHOW\" };\n};\n\n// assumes outside validation/correction\nexport const setPage = (page: number) => {\n\treturn { type: t.PAGE_UPDATE, payload: page };\n};\n\nconst pageCorrections = {\n\tADD: (newPage: number, totalPages: number) => (newPage === totalPages + 1 ? 1 : newPage),\n\tREMOVE: (newPage: number, totalPages: number) => (newPage === 0 ? totalPages : newPage),\n};\n\nexport const movePage = (type: PageMove) => {\n\treturn (dispatch: Dispatch, getState: Function) => {\n\t\tconst { currentPage, totalPages } = getPageControlData(getState());\n\t\tif (totalPages) {\n\t\t\tswitch (type) {\n\t\t\t\tcase \"NEXT\":\n\t\t\t\t\tdispatch({ type: t.PAGE_UPDATE, payload: pageCorrections[\"ADD\"](currentPage + 1, totalPages) });\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"PREVIOUS\":\n\t\t\t\t\tdispatch({ type: t.PAGE_UPDATE, payload: pageCorrections[\"REMOVE\"](currentPage - 1, totalPages) });\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t};\n};\nexport const nextPage = () => movePage(\"NEXT\");\nexport const previousPage = () => movePage(\"PREVIOUS\");\n\nexport const toggleDisplayState = () => {\n\treturn (dispatch: Dispatch, getState: Function) => {\n\t\tconst displayState = getDisplayStatus(getState()) === \"SHOW\" ? \"HIDE\" : \"SHOW\";\n\n\t\tdispatch({ type: t.DISPLAY_STATUS, payload: displayState });\n\t};\n};\n","import \"./PDFDocument.css\";\nimport \"./AnnotationLayer.css\";\nimport React, { RefObject } from \"react\";\nimport { pdfjs, Document, Page } from \"react-pdf\";\nimport { connect, useDispatch } from \"react-redux\";\nimport { materialLoaded, materialRendered, setPage } from \"../../actions\";\nimport { getRenderCritialData } from \"../../selectors\";\nimport analyze from \"../../../analyze\";\npdfjs.GlobalWorkerOptions.workerSrc = `//cdnjs.cloudflare.com/ajax/libs/pdf.js/${pdfjs.version}/pdf.worker.js`;\n\nfunction removeTextLayerOffset() {\n\tconst textLayers = document.querySelectorAll(\".react-pdf__Page__textContent\");\n\ttextLayers.forEach((layer) => {\n\t\tconst { style }: any = layer;\n\t\tstyle.top = \"0\";\n\t\tstyle.left = \"0\";\n\t\tstyle.transform = \"\";\n\t});\n}\n\nconst options = {\n\tcMapUrl: \"cmaps/\",\n\tcMapPacked: true,\n};\n\nfunction PDFDocument({\n\tparentSize,\n\tpdf,\n\tcurrentPage,\n\tmaterialRendered,\n\tmaterialLoaded,\n\tcaptureMaterialData,\n\tdocumentRef,\n}: {\n\tparentSize: any;\n\tpdf: File | undefined;\n\tcurrentPage: number;\n\tmaterialRendered: Function;\n\tmaterialLoaded: (numPages: number) => void;\n\tcaptureMaterialData: Function;\n\tdocumentRef: RefObject<any>;\n}) {\n\tconst dispatch = useDispatch();\n\n\treturn (\n\t\t<Document\n\t\t\tfile={pdf}\n\t\t\toptions={options}\n\t\t\tonLoadSuccess={({ numPages }) => {\n\t\t\t\tmaterialLoaded(numPages);\n\t\t\t}}\n\t\t\tinputRef={documentRef}\n\t\t\tonItemClick={({ pageNumber }) => {\n\t\t\t\tdispatch(setPage(parseInt(pageNumber)));\n\t\t\t}}\n\t\t>\n\t\t\t{pdf && (\n\t\t\t\t<Page\n\t\t\t\t\twidth={parentSize.width}\n\t\t\t\t\tpageNumber={currentPage}\n\t\t\t\t\tonRenderSuccess={() => {\n\t\t\t\t\t\tremoveTextLayerOffset();\n\t\t\t\t\t\tmaterialRendered();\n\t\t\t\t\t\tcaptureMaterialData(documentRef);\n\t\t\t\t\t}}\n\t\t\t\t/>\n\t\t\t)}\n\t\t</Document>\n\t);\n}\n\nexport const PDFDocumentContainer = connect(getRenderCritialData, {\n\tmaterialRendered,\n\tmaterialLoaded,\n\tcaptureMaterialData: analyze.actions.captureMaterialData,\n})(PDFDocument);\n","import { connect } from \"react-redux\";\nimport React, { ChangeEvent } from \"react\";\nimport { materialUploaded } from \"../actions\";\nimport { getPDF } from \"../selectors\";\n\nfunction PDFUpload({\n\tpdf,\n\tonUpload,\n}: {\n\tpdf: File | undefined;\n\tonUpload: (event: ChangeEvent<HTMLInputElement>) => void;\n}) {\n\treturn pdf ? null : <input onChange={onUpload} type=\"file\" accept=\".pdf\" />;\n}\n\nexport const PDFUploadContainer = connect(getPDF, { onUpload: materialUploaded })(PDFUpload);\n","import React from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { IconButton } from \"@material-ui/core\";\nimport ArrowForwardIosIcon from \"@material-ui/icons/ArrowForwardIos\";\nimport ArrowBackIosIcon from \"@material-ui/icons/ArrowBackIos\";\nimport { nextPage, previousPage } from \"../actions\";\n\nexport const PreviousButton = () => {\n\tconst dispatch = useDispatch();\n\treturn (\n\t\t<IconButton\n\t\t\ttype=\"button\"\n\t\t\tonClick={() => {\n\t\t\t\tdispatch(previousPage());\n\t\t\t}}\n\t\t>\n\t\t\t<ArrowBackIosIcon></ArrowBackIosIcon>\n\t\t</IconButton>\n\t);\n};\n\nexport const NextButton = () => {\n\tconst dispatch = useDispatch();\n\treturn (\n\t\t<IconButton\n\t\t\ttype=\"button\"\n\t\t\tonClick={() => {\n\t\t\t\tdispatch(nextPage());\n\t\t\t}}\n\t\t>\n\t\t\t<ArrowForwardIosIcon></ArrowForwardIosIcon>\n\t\t</IconButton>\n\t);\n};\n","import { useState } from \"react\";\nimport DescriptionOutlinedIcon from \"@material-ui/icons/DescriptionOutlined\";\nimport DescriptionTwoToneIcon from \"@material-ui/icons/DescriptionTwoTone\";\nimport React from \"react\";\nimport { IconButton } from \"@material-ui/core\";\nimport { useDispatch } from \"react-redux\";\nimport { toggleDisplayState } from \"../actions\";\n\nexport const ShowMaterialButton = () => {\n\tconst [outlined, setOutlined] = useState(true);\n\tconst dispatch = useDispatch();\n\n\treturn (\n\t\t<IconButton\n\t\t\ttype=\"button\"\n\t\t\tonClick={() => {\n\t\t\t\tdispatch(toggleDisplayState());\n\t\t\t\tsetOutlined(!outlined);\n\t\t\t}}\n\t\t>\n\t\t\t{outlined ? (\n\t\t\t\t<DescriptionOutlinedIcon></DescriptionOutlinedIcon>\n\t\t\t) : (\n\t\t\t\t<DescriptionTwoToneIcon></DescriptionTwoToneIcon>\n\t\t\t)}\n\t\t</IconButton>\n\t);\n};\n","import React, { useState } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { Typography, TextField } from \"@material-ui/core\";\nimport { setPage } from \"../../actions\";\nimport { getPageControlData } from \"../../selectors\";\n\nconst nonDigitRegEx = /(\\D)/;\n\nexport const validatePageChoice = (possiblePage: string, totalPages: number) => {\n\tif (possiblePage === \"\" || possiblePage.trim().match(nonDigitRegEx) !== null) return false;\n\n\tconst asInt = parseInt(possiblePage);\n\tif (asInt < 1 || totalPages < asInt) return false;\n\n\treturn true;\n};\n\nexport const PageChooser = () => {\n\tconst dispatch = useDispatch();\n\t// parent only renders this component if these values exist\n\tconst { currentPage, totalPages }: { currentPage?: number; totalPages?: number } = useSelector(getPageControlData);\n\n\tconst [state, setState] = useState({\n\t\terror: false,\n\t\tvalue: currentPage?.toString(),\n\t\tuserInput: currentPage?.toString(),\n\t});\n\n\t// with this we can trigger a re-render onChange,\n\t// while making sure that if a new currentPage arrives, we reset the component\n\tif (state.value !== currentPage.toString()) {\n\t\tsetState({ error: false, value: currentPage.toString(), userInput: currentPage.toString() });\n\t}\n\n\treturn (\n\t\t<Typography variant=\"h6\">\n\t\t\t<TextField\n\t\t\t\ttype=\"text\"\n\t\t\t\tvariant=\"filled\"\n\t\t\t\tvalue={state.userInput}\n\t\t\t\tonKeyDown={(event) => {\n\t\t\t\t\tif (event.key === \"Enter\") {\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\tconst submittedValue = (event.target as HTMLFormElement).value;\n\t\t\t\t\t\tif (!state.error) {\n\t\t\t\t\t\t\tdispatch(setPage(parseInt(submittedValue)));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}}\n\t\t\t\tonChange={(event) => {\n\t\t\t\t\tconst submittedValue = (event.target as HTMLTextAreaElement).value;\n\t\t\t\t\tif (validatePageChoice(submittedValue, totalPages as number)) {\n\t\t\t\t\t\tsetState({ ...state, error: false, userInput: submittedValue });\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsetState({ ...state, error: true, userInput: submittedValue });\n\t\t\t\t\t}\n\t\t\t\t}}\n\t\t\t\terror={state.error}\n\t\t\t/>\n\t\t\tof {totalPages}\n\t\t</Typography>\n\t);\n};\n","import * as t from \"./actionTypes\";\nimport type { DisplayData, DisplayStatus } from \"./model\";\nimport { createRef } from \"react\";\n\nconst initialState: DisplayData = { displayStatus: \"SHOW\", currentPage: 1, documentRef: createRef() };\n\nconst displayData = (state = initialState, { type, payload }: { type: string; payload: any }): DisplayData => {\n\tswitch (type) {\n\t\tcase t.PDF_UPLOADED:\n\t\t\treturn { ...state, pdf: payload as File };\n\t\tcase t.MATERIAL_LOADED:\n\t\t\treturn { ...state, totalPages: payload as number };\n\t\tcase t.PAGE_UPDATE:\n\t\t\treturn { ...state, currentPage: payload as number };\n\t\tcase t.DISPLAY_STATUS:\n\t\t\treturn { ...state, displayStatus: payload as DisplayStatus };\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n\nexport default displayData;\n","import * as actions from \"./actions\";\nimport * as actionTypes from \"./actionTypes\";\nimport * as components from \"./components\";\nimport * as constants from \"./constants\";\nimport reducer from \"./reducer\";\nimport * as selectors from \"./selectors\";\n\nexport default { actions, actionTypes, components, constants, reducer, selectors };\n","import { NAME } from \"./constants\";\nimport { SelectionData } from \"./model\";\nimport { createSelector } from \"reselect\";\nimport analyze from \"../analyze\";\nimport display from \"../display\";\n\nexport const getAll = (state: any) => state[NAME];\n\nexport const getSectionIndex = createSelector(getAll, (state: SelectionData) => state.sectionIndex);\n\nexport const getUpdateAllowed = createSelector(getAll, (state: SelectionData) => state.sectionUpdateAllowed);\n\nexport const getSectionMovementState = createSelector(getAll, (state: SelectionData) => state.sectionMovementState);\n\nexport const getCurrentSpanGroup = createSelector(\n\tanalyze.selectors.getMaterialSpanGroups,\n\tgetSectionIndex,\n\t(spanGroups, sectionIndex) => spanGroups[sectionIndex]\n);\n\nexport const getCurrentBoundingRectGroup = createSelector(\n\tanalyze.selectors.getMaterialBoundingRectGroups,\n\tgetSectionIndex,\n\t(boundingRectGroups, sectionIndex) => boundingRectGroups[sectionIndex]\n);\n\nexport const getCurrentSelectionGroup = createSelector(\n\tanalyze.selectors.getWordSelectionGroups,\n\tgetSectionIndex,\n\t(selectionGroups, sectionIndex) => selectionGroups[sectionIndex]\n);\n\nexport const getCurrentWordRangeGroup = createSelector(\n\tanalyze.selectors.getWordRangeGroups,\n\tgetSectionIndex,\n\t(wordRangeGroups, sectionIndex) => wordRangeGroups[sectionIndex]\n);\n\nexport const getCurrentSelectedWordRanges = createSelector(\n\tgetCurrentSelectionGroup,\n\tgetCurrentWordRangeGroup,\n\t(selectionGroup, wordRangeGroup) =>\n\t\twordRangeGroup.flatMap((rangeArr, lineIndex) =>\n\t\t\trangeArr.filter((_, index) => selectionGroup[lineIndex][index] === 1)\n\t\t)\n);\n\nexport const getManuallySelectedString = createSelector(getAll, (state: SelectionData) => state.manuallySelectedString);\n\nconst rangeArrToStr = (rangeArr: Range[]) => rangeArr.map((range) => range.toString()).join(\" \");\nexport const getCurrentRangeArrStr = createSelector(getCurrentSelectedWordRanges, rangeArrToStr);\n\nexport const getCurrentSelectedString = createSelector(\n\tgetManuallySelectedString,\n\tgetCurrentRangeArrStr,\n\t(str, rangeArrStr) => (str === \"\" ? rangeArrStr : str)\n);\n\nexport const getSelectionType = createSelector(getAll, (state: SelectionData) => state.selectionType);\n\nexport const selectionTypeIsSection = createSelector(getSelectionType, (type) => type === \"SECTION\");\n\nexport const getOverlayRelevantData = createSelector(\n\tgetCurrentSpanGroup,\n\tgetCurrentSelectionGroup,\n\tgetCurrentWordRangeGroup,\n\tgetSectionMovementState,\n\tdisplay.selectors.getDocumentRef,\n\t(spanGroup, selectionGroup, wordRangeGroup, movementState, documentRef) => {\n\t\treturn { spanGroup, selectionGroup, wordRangeGroup, movementState, documentRef };\n\t}\n);\n","import * as t from \"./actionTypes\";\nimport { Dispatch } from \"redux\";\nimport { getSectionMovementState, getUpdateAllowed, getSectionIndex, getSelectionType } from \"./selectors\";\nimport { SectionUpdateType, SelectionUpdateType, SelectionType } from \"./model\";\nimport analyze from \"../analyze\";\nimport { updateSelectionGroup } from \"./services/updateSelectionGroup\";\n\nexport const updateSelection = (type: SelectionUpdateType) => {\n\treturn (dispatch: any, getState: Function) => {\n\t\tconst state = getState();\n\t\tif (getUpdateAllowed(state)) {\n\t\t\tconst selectionGroups = analyze.selectors.getWordSelectionGroups(state);\n\t\t\tconst sectionIndex = getSectionIndex(state);\n\t\t\tconst updatedSelectionGroup = updateSelectionGroup(selectionGroups[sectionIndex], type);\n\t\t\tif (updatedSelectionGroup) dispatch(analyze.actions.updateSelectionGroup(updatedSelectionGroup, sectionIndex));\n\t\t}\n\t};\n};\n\nexport const toggleSectionMovementState = () => {\n\treturn (dispatch: Dispatch, getState: Function) => {\n\t\tconst state = getState();\n\t\tif (getUpdateAllowed(state)) dispatch({ type: t.SECTION_STATE });\n\t};\n};\n\nexport const updateSection = (updateType: SectionUpdateType) => {\n\treturn (dispatch: Dispatch, getState: Function) => {\n\t\tconst state = getState();\n\t\tif (getUpdateAllowed(state) && getSectionMovementState(state) === \"FREE\") {\n\t\t\tlet sectionIndex;\n\t\t\tconst lastIndex = getSectionIndex(state);\n\t\t\tconst spanGroups = analyze.selectors.getMaterialSpanGroups(state);\n\t\t\tswitch (updateType) {\n\t\t\t\tcase \"UP\":\n\t\t\t\t\tsectionIndex = lastIndex - 1;\n\t\t\t\t\tif (sectionIndex === -1) sectionIndex = spanGroups.length - 1;\n\t\t\t\t\tdispatch({ type: t.SECTION_UPDATE, payload: sectionIndex });\n\t\t\t\t\treturn;\n\t\t\t\tcase \"DOWN\":\n\t\t\t\t\tsectionIndex = lastIndex + 1;\n\t\t\t\t\tif (sectionIndex === spanGroups.length) sectionIndex = 0;\n\t\t\t\t\tdispatch({ type: t.SECTION_UPDATE, payload: sectionIndex });\n\t\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t};\n};\n\nexport const updateSelectionType = (type: SelectionType) => {\n\treturn { type: t.SELECTION_TYPE, payload: type };\n};\n\nexport const toggleSelectionType = () => (dispatch: Dispatch, getState: Function) => {\n\tdispatch(updateSelectionType(getSelectionType(getState()) === \"MOUSE\" ? \"SECTION\" : \"MOUSE\"));\n};\n\nexport const updateManuallySelectedString = (str: string) => {\n\treturn { type: t.SELECTED_STRING, payload: str };\n};\n\nexport const resetManuallySelectedString = () => {\n\treturn updateManuallySelectedString(\"\");\n};\n","import { SelectionUpdateType } from \"../model\";\n\nexport const updateSelectionGroup = (selectionGroup: (1 | 0)[][], type: SelectionUpdateType) => {\n\tlet foundSpan = false;\n\tconst newSelectionGroup = [];\n\n\tswitch (type) {\n\t\tcase \"MINUS_WORD\":\n\t\t\tfor (let index = 0; index < selectionGroup.length; index++) {\n\t\t\t\tlet spanGroup = selectionGroup[index];\n\t\t\t\tif (!foundSpan) {\n\t\t\t\t\tconst oneIndex = spanGroup.indexOf(1);\n\t\t\t\t\tif (oneIndex !== -1) {\n\t\t\t\t\t\tfoundSpan = true;\n\t\t\t\t\t\tspanGroup = [...spanGroup];\n\t\t\t\t\t\tspanGroup[oneIndex] = 0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tnewSelectionGroup.push(spanGroup);\n\t\t\t}\n\t\t\tif (foundSpan) return newSelectionGroup;\n\t\t\tbreak;\n\t\tcase \"MINUS_SPAN\":\n\t\t\tfor (let index = 0; index < selectionGroup.length; index++) {\n\t\t\t\tlet spanGroup = selectionGroup[index];\n\t\t\t\tif (!foundSpan) {\n\t\t\t\t\tconst oneIndex = spanGroup.indexOf(1);\n\t\t\t\t\tif (oneIndex !== -1) {\n\t\t\t\t\t\tfoundSpan = true;\n\t\t\t\t\t\tspanGroup = spanGroup.map((_) => 0);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tnewSelectionGroup.push(spanGroup);\n\t\t\t}\n\t\t\tif (foundSpan) return newSelectionGroup;\n\t\t\tbreak;\n\t\tcase \"PLUS_WORD\":\n\t\t\tfor (let index = selectionGroup.length - 1; index >= 0; index--) {\n\t\t\t\tlet spanGroup = selectionGroup[index];\n\t\t\t\tif (!foundSpan) {\n\t\t\t\t\tconst zeroIndex = spanGroup.lastIndexOf(0);\n\t\t\t\t\tif (zeroIndex !== -1) {\n\t\t\t\t\t\tfoundSpan = true;\n\t\t\t\t\t\tspanGroup = [...spanGroup];\n\t\t\t\t\t\tspanGroup[zeroIndex] = 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tnewSelectionGroup.push(spanGroup);\n\t\t\t}\n\t\t\tif (foundSpan) return newSelectionGroup.reverse();\n\t\t\tbreak;\n\n\t\tcase \"PLUS_SPAN\":\n\t\t\tfor (let index = selectionGroup.length - 1; index >= 0; index--) {\n\t\t\t\tlet spanGroup = selectionGroup[index];\n\t\t\t\tif (!foundSpan) {\n\t\t\t\t\tconst zeroIndex = spanGroup.lastIndexOf(0);\n\t\t\t\t\tif (zeroIndex !== -1) {\n\t\t\t\t\t\tfoundSpan = true;\n\t\t\t\t\t\tspanGroup = spanGroup.map((_) => 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tnewSelectionGroup.push(spanGroup);\n\t\t\t}\n\t\t\tif (foundSpan) return newSelectionGroup.reverse();\n\t\t\tbreak;\n\t}\n\n\treturn null;\n};\n","import React, { useMemo, useEffect } from \"react\";\nimport { Layer } from \"react-konva\";\nimport { LayerConfig } from \"konva/types/Layer\";\nimport { RectConfig } from \"konva/types/shapes/Rect\";\nimport { Rect } from \"react-konva\";\nimport { incrementer } from \"../../../shared/utils\";\n\nfunction BoundingRectRect({\n\txOffset = 0,\n\tyOffset = 0,\n\tboundingRect,\n\t...props\n}: {\n\txOffset: number;\n\tyOffset: number;\n\tboundingRect: DOMRect;\n} & RectConfig) {\n\treturn (\n\t\t<Rect\n\t\t\tx={boundingRect.x - xOffset}\n\t\t\ty={boundingRect.y - yOffset}\n\t\t\twidth={boundingRect.width}\n\t\t\theight={boundingRect.bottom - boundingRect.y}\n\t\t\t{...props}\n\t\t/>\n\t);\n}\n\nconst wordRangesToRects = (flatWordRanges: Range[], flatSelectionGroup: any, containerRect: DOMRect, color: string) => {\n\tlet increment = incrementer();\n\n\treturn flatWordRanges\n\t\t.map((range, index) =>\n\t\t\tflatSelectionGroup[index] === 1 ? (\n\t\t\t\t<BoundingRectRect\n\t\t\t\t\txOffset={containerRect.x}\n\t\t\t\t\tyOffset={containerRect.y}\n\t\t\t\t\tboundingRect={range.getBoundingClientRect()}\n\t\t\t\t\tshadowBlur={5}\n\t\t\t\t\tstroke={color}\n\t\t\t\t\topacity={0.3}\n\t\t\t\t\tkey={increment()}\n\t\t\t\t></BoundingRectRect>\n\t\t\t) : null\n\t\t)\n\t\t.filter((val) => val !== null);\n};\n\nexport function WordLayer({\n\tspanGroup,\n\twordRangeGroup,\n\tcolor,\n\tselectionGroup,\n\tcontainer,\n\tshowRects,\n\t...props\n}: {\n\tspanGroup: HTMLSpanElement[];\n\twordRangeGroup: Range[][];\n\tcontainer: HTMLDivElement;\n\tshowRects: boolean;\n} & LayerConfig) {\n\t// we want to be able to quickly show/hide the rects, so we need to memoize\n\t// dependency is on the props (which stay the same if unchanged)\n\tconst boundingRectRects = useMemo(\n\t\t() => wordRangesToRects(wordRangeGroup.flat(), selectionGroup.flat(), container.getBoundingClientRect(), color),\n\t\t[selectionGroup, wordRangeGroup, container, color]\n\t);\n\n\tuseEffect(() => {\n\t\tif (showRects) {\n\t\t\tspanGroup[0].focus();\n\t\t\tspanGroup[0].scrollIntoView({ behavior: \"smooth\", block: \"center\", inline: \"center\" });\n\t\t}\n\t}, [spanGroup, showRects]);\n\n\treturn <Layer {...props}>{showRects && boundingRectRects}</Layer>;\n}\n","import React, { useLayoutEffect, useState, RefObject } from \"react\";\nimport { Stage } from \"react-konva\";\nimport { WordLayer } from \"./WordLayer\";\nimport { getOverlayRelevantData, selectionTypeIsSection } from \"../selectors\";\nimport { SectionMovementState } from \"../model\";\nimport analyze from \"../../analyze\";\nimport { rectHeight } from \"../../../shared/rect\";\nimport { useSelector } from \"react-redux\";\n\nconst freeColor = \"green\";\nconst lockedColor = \"red\";\n\nfunction DocumentCanvas({\n\tspanGroup,\n\tmovementState,\n\tselectionGroup,\n\twordRangeGroup,\n\tparentSize,\n\tdocumentRef,\n}: {\n\tspanGroup: HTMLSpanElement[];\n\tmovementState: SectionMovementState;\n\tselectionGroup: (0 | 1)[][];\n\twordRangeGroup: Range[][];\n\tparentSize: { width: number };\n\tdocumentRef: RefObject<any>;\n}) {\n\tconst [height, setHeight] = useState(1);\n\tconst showRects = useSelector(selectionTypeIsSection);\n\n\tuseLayoutEffect(() => {\n\t\tif (documentRef.current) {\n\t\t\tsetHeight(rectHeight((documentRef.current as HTMLDivElement).getBoundingClientRect()));\n\t\t}\n\t}, [documentRef]);\n\n\treturn (\n\t\t<Stage width={parentSize.width} height={height} style={{ position: \"absolute\", pointerEvents: \"none\", zIndex: 1 }}>\n\t\t\t{documentRef.current && (\n\t\t\t\t<WordLayer\n\t\t\t\t\tshowRects={showRects}\n\t\t\t\t\tcontainer={documentRef.current as HTMLDivElement}\n\t\t\t\t\tspanGroup={spanGroup}\n\t\t\t\t\tcolor={movementState === \"FREE\" ? freeColor : lockedColor}\n\t\t\t\t\tselectionGroup={selectionGroup}\n\t\t\t\t\twordRangeGroup={wordRangeGroup}\n\t\t\t\t></WordLayer>\n\t\t\t)}\n\t\t</Stage>\n\t);\n}\n\nexport const DocumentCanvasContainer = analyze.components.DataGuardHOC(DocumentCanvas, getOverlayRelevantData);\n","import { useState } from \"react\";\nimport MouseIcon from \"@material-ui/icons/Mouse\";\nimport BorderAllIcon from \"@material-ui/icons/BorderAll\";\nimport React from \"react\";\nimport { IconButton } from \"@material-ui/core\";\nimport { useDispatch } from \"react-redux\";\nimport { toggleSelectionType } from \"../actions\";\n\nexport const SelectionTypeButton = () => {\n\tconst [outlined, setOutlined] = useState(true);\n\tconst dispatch = useDispatch();\n\n\treturn (\n\t\t<IconButton\n\t\t\ttype=\"button\"\n\t\t\tonClick={() => {\n\t\t\t\tdispatch(toggleSelectionType());\n\t\t\t\tsetOutlined(!outlined);\n\t\t\t}}\n\t\t>\n\t\t\t{outlined ? <MouseIcon></MouseIcon> : <BorderAllIcon></BorderAllIcon>}\n\t\t</IconButton>\n\t);\n};\n","import { SelectionData, SelectionType } from \"./model\";\nimport * as t from \"./actionTypes\";\nimport analyze from \"../analyze\";\nimport display from \"../display\";\n\n//TODO: prerender next few pages?\n\n//TODO: state per page\n\n//TODO: Second CardRiver, where you can choose the page! (for comparison)\n\nconst initialState: SelectionData = {\n\tsectionIndex: 1,\n\tsectionUpdateAllowed: false,\n\tsectionMovementState: \"FREE\",\n\tselectionType: \"MOUSE\",\n\tmanuallySelectedString: \"\",\n};\n\nconst selectionData = (state = initialState, { type, payload }: { type: string; payload: any }): SelectionData => {\n\tswitch (type) {\n\t\tcase t.SECTION_UPDATE:\n\t\t\treturn { ...state, sectionIndex: payload as number };\n\t\tcase t.SECTION_STATE:\n\t\t\treturn { ...state, sectionMovementState: state.sectionMovementState === \"FREE\" ? \"LOCKED\" : \"FREE\" };\n\t\tcase display.actionTypes.PAGE_UPDATE:\n\t\t\tconst disabledSectionData = { ...state, sectionUpdateAllowed: false };\n\t\t\treturn disabledSectionData;\n\t\tcase analyze.actionTypes.MATERIAL_DATA:\n\t\t\tconst resetedSectionData = { ...state, sectionIndex: 0, sectionUpdateAllowed: true };\n\t\t\treturn resetedSectionData;\n\t\tcase t.SELECTION_TYPE:\n\t\t\treturn { ...state, selectionType: payload as SelectionType };\n\t\tcase t.SELECTED_STRING:\n\t\t\treturn { ...state, manuallySelectedString: payload as string };\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n\nexport default selectionData;\n","import * as actions from \"./actions\";\nimport * as components from \"./components\";\nimport * as constants from \"./constants\";\nimport reducer from \"./reducer\";\nimport * as selectors from \"./selectors\";\n\nexport default { actions, components, constants, reducer, selectors };\n","import { useRef, useEffect, MutableRefObject } from \"react\";\n\n// only global eventListener for now\nexport const useEventListener = (eventName: string, handler: any) => {\n\tconst savedHandler: MutableRefObject<Function> = useRef(() => {});\n\n\tuseEffect(() => {\n\t\tsavedHandler.current = handler;\n\t}, [handler]);\n\n\tuseEffect(() => {\n\t\tconst eventListener = (event: Event) => savedHandler.current(event);\n\t\tdocument.addEventListener(eventName, eventListener);\n\t\treturn () => {\n\t\t\tdocument.removeEventListener(eventName, eventListener);\n\t\t};\n\t}, [eventName]);\n};\n","export const NAME = \"userFocus\";\n","import { NAME } from \"./constants\";\n\nexport const FOCUS_UPDATE = NAME + \"/FOCUS_UPDATE\";\n","import { createSelector } from \"reselect\";\nimport { NAME } from \"./constants\";\nimport { FocusState } from \"./model\";\n\nexport const getAll = (state: any) => state[NAME];\n\nexport const getFocus = createSelector(getAll, (state: FocusState) => state.focus);\n","import * as t from \"./actionTypes\";\nimport { UserFocus } from \"./model\";\nimport { Dispatch } from \"redux\";\nimport { getFocus } from \"./selectors\";\nimport analyze from \"../analyze\";\n\nexport const updateFocus = (focus: UserFocus) => {\n\treturn { type: t.FOCUS_UPDATE, payload: focus };\n};\n\nexport const tryUpdateFocus = (focus: UserFocus) => {\n\treturn (dispatch: Dispatch, getState: Function) => {\n\t\tif (getFocus(getState()) !== focus) dispatch(updateFocus(focus));\n\t};\n};\n\nexport const toggleContextMenuFocus = () => {\n\treturn (dispatch: Dispatch, getState: Function) => {\n\t\tconst state = getState();\n\t\tif (analyze.selectors.getDataExists(state)) {\n\t\t\tconst currentFocus = getFocus(getState());\n\t\t\tswitch (currentFocus) {\n\t\t\t\tcase \"CONTEXT_MENU\":\n\t\t\t\t\tdispatch(updateFocus(\"SELECTION\"));\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"SELECTION\":\n\t\t\t\t\tdispatch(updateFocus(\"CONTEXT_MENU\"));\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t};\n};\n","import { FocusState, UserFocus } from \"./model\";\nimport * as t from \"./actionTypes\";\n\nconst initialState: FocusState = { focus: \"SELECTION\" };\n\nconst focus = (state = initialState, { type, payload }: { type: string; payload: any }): FocusState => {\n\tswitch (type) {\n\t\tcase t.FOCUS_UPDATE:\n\t\t\treturn { ...state, focus: payload as UserFocus };\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n\nexport default focus;\n","import * as actions from \"./actions\";\nimport * as constants from \"./constants\";\nimport reducer from \"./reducer\";\nimport * as selectors from \"./selectors\";\n\nexport default { actions, constants, reducer, selectors };\n","export const NAME = \"creationData\";\n","import { NAME } from \"./constants\";\n\nexport const TOGGLE_CONTEXT_MENU = NAME + \"/TOGGLE_CONTEXT_MENU\";\nexport const CLOSE_CONTEXT_MENU = NAME + \"/CLOSE_CONTEXT_MENU\";\nexport const OPEN_CONTEXT_MENU = NAME + \"/OPEN_CONTEXT_MENU\";\n","import { UpdateType, CardPayloadConfig, CreationType, QACardContent, CardType } from \"../model\";\n\ntype updateContentStrFunction = (oldStr: string, newStr: string) => string;\n\ntype partialUpdateContentStrFunction = (oldStr: string) => string;\n\nconst updateContentStrFunctions: { [key in UpdateType]: updateContentStrFunction } = {\n\tREPLACE: (_: string, newStr: string) => newStr,\n\tAPPEND: (oldStr: string, newStr: string) => oldStr + newStr,\n};\n\nconst createPartialUpdateContentStrFunction = (updateType: UpdateType, newStr: string) => (oldStr: string) =>\n\tupdateContentStrFunctions[updateType](oldStr, newStr);\n\ntype creationFunction = (\n\toldConfig: CardPayloadConfig,\n\tpartialUpdateFunction: partialUpdateContentStrFunction\n) => CardPayloadConfig;\n\nconst defaultCreationFunction: creationFunction = (oldConfig, partialUpdateFunction) => {\n\treturn { ...oldConfig, content: partialUpdateFunction(oldConfig.content as string) };\n};\n\nconst creationFunctions: {\n\t[key in CreationType]: creationFunction;\n} = {\n\tNOTE: defaultCreationFunction,\n\tQ: (oldConfig, partialUpdateFunction) => {\n\t\tconst content = oldConfig.content as QACardContent;\n\t\treturn { ...oldConfig, content: { ...content, q: partialUpdateFunction(content.q) } };\n\t},\n\tA: (oldConfig, partialUpdateFunction) => {\n\t\tconst content = oldConfig.content as QACardContent;\n\t\treturn { ...oldConfig, content: { ...content, a: partialUpdateFunction(content.a) } };\n\t},\n};\n\nexport const contentStringToConfig = (\n\tcontentStr: string,\n\ttype: CardType,\n\tcreationType: CreationType,\n\tupdateType: UpdateType,\n\tcurrentCard?: CardPayloadConfig\n): CardPayloadConfig => {\n\tconst partialUpdateFunction = createPartialUpdateContentStrFunction(updateType, contentStr);\n\tconst isCardUpdate = !!currentCard;\n\treturn isCardUpdate\n\t\t? creationFunctions[creationType](currentCard as CardPayloadConfig, partialUpdateFunction)\n\t\t: creationFunctions[creationType]({ type, content: type === \"Q-A\" ? { q: \"\", a: \"\" } : \"\" }, partialUpdateFunction);\n};\n","export const NAME = \"cards\";\n","import { NAME } from \"./constants\";\n\nexport const CARD_UPDATE = NAME + \"/CARD_UPDATE\";\nexport const CARD_PUSH = NAME + \"/CARD_PUSH\";\n","import { createSelector } from \"reselect\";\nimport { CardsState } from \"./model\";\n\nexport const getAll = (state: any) => state.cards as CardsState;\n\nexport const getLastCardIDNumber = createSelector(getAll, (state) => state.lastCardIDNumber);\n\nexport const getCards = createSelector(getAll, (state: CardsState) => state.cards);\n","import { CardPayload, FinalizedCardPayload, CreationType, UpdateType, CardType } from \"./model\";\nimport * as t from \"./actionTypes\";\nimport { Dispatch } from \"redux\";\nimport { getLastCardIDNumber, getCards } from \"./selectors\";\nimport { contentStringToConfig } from \"./services/config\";\n\nconst createCardID = (lastCardIDNumber: number) => (lastCardIDNumber + 1).toString();\n\nexport const cardPush = (cardPayload: CardPayload) => {\n\treturn (dispatch: Dispatch, getState: Function) => {\n\t\tdispatch({\n\t\t\ttype: t.CARD_PUSH,\n\t\t\tpayload: {\n\t\t\t\t...cardPayload,\n\t\t\t\tcard: { ...cardPayload.card, cardID: createCardID(getLastCardIDNumber(getState())) },\n\t\t\t} as FinalizedCardPayload,\n\t\t});\n\t};\n};\n\nexport const cardUpdate = (card: CardPayload) => {\n\treturn { type: t.CARD_UPDATE, payload: card };\n};\n\nexport const updateCardContent = (\n\tcontentString: string,\n\tcardID: string,\n\tcreationType: CreationType,\n\tupdateType: UpdateType,\n\triverID: string\n) => {\n\treturn (dispatch: Dispatch, getState: Function) => {\n\t\tconst state = getState();\n\n\t\tconst currentCard = getCards(state)[cardID as string];\n\t\tconst config = contentStringToConfig(contentString, currentCard.type, creationType, updateType, currentCard);\n\n\t\tdispatch(\n\t\t\tcardUpdate({\n\t\t\t\triverID,\n\t\t\t\tcard: config,\n\t\t\t})\n\t\t);\n\t};\n};\n\nexport const pushCardContent = (\n\tcontentString: string,\n\tcreationType: CreationType,\n\tupdateType: UpdateType,\n\triverID: string,\n\ttype: CardType\n) => {\n\tconst config = contentStringToConfig(contentString, type, creationType, updateType);\n\treturn cardPush({ riverID, card: config });\n};\n","import * as t from \"./actionTypes\";\nimport { CardsState, FinalizedCardPayload } from \"./model\";\n\nconst intialState: CardsState = {\n\tcards: {\n\t\t\"0\": { cardID: \"0\", type: \"Q-A\", content: { q: \"Was ist der Sinn des Lebens?\", a: \"42\" } },\n\t\t\"1\": { cardID: \"1\", type: \"Q-A\", content: { q: \"Welches Layout macht mehr Sinn?\", a: \"??\" } },\n\t\t\"2\": { cardID: \"2\", type: \"Note\", content: \"Note here\" },\n\t},\n\tlastCardIDNumber: 2,\n};\n\nconst cards = (state = intialState, { type, payload }: { type: string; payload: FinalizedCardPayload }) => {\n\tlet cardID;\n\tlet cardObj;\n\tswitch (type) {\n\t\tcase t.CARD_PUSH:\n\t\t\tconst lastCardIDNumber = state.lastCardIDNumber + 1;\n\n\t\t\tcardObj = { ...state.cards };\n\t\t\tcardObj[payload.card.cardID] = payload.card;\n\n\t\t\treturn { ...state, cards: cardObj, lastCardIDNumber };\n\t\tcase t.CARD_UPDATE:\n\t\t\tcardID = payload.card.cardID as string;\n\t\t\tcardObj = { ...state.cards };\n\t\t\tcardObj[cardID] = payload.card;\n\n\t\t\treturn { ...state, cards: cardObj };\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n\nexport default cards;\n","import * as services from \"./services\";\nimport * as constants from \"./constants\";\nimport * as actionTypes from \"./actionTypes\";\nimport * as actions from \"./actions\";\nimport * as selectors from \"./selectors\";\nimport reducer from \"./reducer\";\n\nexport default { services, constants, actionTypes, actions, reducer, selectors };\n","import * as t from \"./actionTypes\";\nimport analyze from \"../analyze\";\nimport select from \"../select\";\nimport { CardType, CreationType } from \"../cards/model\";\nimport cards from \"../cards\";\nimport focus from \"../focus\";\n\nexport const toggleContextMenu = () => {\n\treturn (dispatch: any, getState: Function) => {\n\t\tif (analyze.selectors.getDataExists(getState())) {\n\t\t\tdispatch({ type: t.TOGGLE_CONTEXT_MENU });\n\t\t\tdispatch(focus.actions.toggleContextMenuFocus());\n\t\t}\n\t};\n};\n\nexport const closeContextMenu = () => {\n\treturn (dispatch: any, getState: Function) => {\n\t\tif (analyze.selectors.getDataExists(getState())) {\n\t\t\tdispatch({ type: t.CLOSE_CONTEXT_MENU });\n\t\t\tdispatch(focus.actions.updateFocus(\"SELECTION\"));\n\t\t}\n\t};\n};\n\nexport const openContextMenu = () => {\n\treturn (dispatch: any, getState: Function) => {\n\t\tif (analyze.selectors.getDataExists(getState())) {\n\t\t\tdispatch({ type: t.OPEN_CONTEXT_MENU });\n\t\t\tdispatch(focus.actions.updateFocus(\"SELECTION\"));\n\t\t}\n\t};\n};\n\nexport const triggerSelectionGrab = (riverID: string, type: CardType, creationType: CreationType, cardID?: string) => {\n\treturn (dispatch: Function, getState: Function) => {\n\t\tdispatch(closeContextMenu());\n\n\t\t//TODO\n\t\tconst updateType = \"REPLACE\";\n\n\t\tconst selectedString = select.selectors.getCurrentSelectedString(getState());\n\t\tconst isUpdate = cardID !== undefined;\n\n\t\tif (isUpdate) {\n\t\t\tdispatch(cards.actions.updateCardContent(selectedString, cardID as string, creationType, updateType, riverID));\n\t\t} else {\n\t\t\tdispatch(cards.actions.pushCardContent(selectedString, creationType, updateType, riverID, type));\n\t\t}\n\t};\n};\n","import * as t from \"./actionTypes\";\nimport { CreationData } from \"./model\";\nimport { createRef } from \"react\";\nimport { CardPayload } from \"../cards/model\";\nimport cards from \"../cards\";\n\nconst initialState: CreationData = { open: false, menuRef: createRef(), qaRefs: [createRef(), createRef()] };\n\nconst creationData = (state = initialState, { type, payload }: { type: string; payload: any }): CreationData => {\n\tswitch (type) {\n\t\tcase t.TOGGLE_CONTEXT_MENU:\n\t\t\treturn { ...state, open: !state.open };\n\t\tcase t.CLOSE_CONTEXT_MENU:\n\t\t\treturn { ...state, open: false };\n\t\tcase t.OPEN_CONTEXT_MENU:\n\t\t\treturn { ...state, open: true };\n\t\tcase cards.actionTypes.CARD_PUSH:\n\t\t\t//TODO: reliance on order of refs and coupling to the fact that a new card was pushed\n\t\t\t// no support for multiple rivers\n\t\t\tif ((payload as CardPayload).card.type === \"Q-A\") return { ...state, qaRefs: [...state.qaRefs, createRef()] };\n\t\t\treturn state;\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n\nexport default creationData;\n","export const NAME = \"cardRiverState\";\n","import { NAME } from \"./constants\";\nimport { createSelector } from \"reselect\";\nimport { CardRiverState } from \"./model\";\nimport cards from \"../cards\";\n\nexport const getAll = (state: any) => state[NAME];\n\nexport const getRiverMakeUps = createSelector(getAll, (state: CardRiverState) => state.riverMakeUps);\n\nexport const getActiveRiverMakeUpID = createSelector(getAll, (state: CardRiverState) => state.activeRiverMakeUpID);\n\nexport const getActiveRiverMakeUp = createSelector(\n\tgetRiverMakeUps,\n\tgetActiveRiverMakeUpID,\n\t(makeUps, id) => makeUps[id]\n);\n\nexport const getActiveRiverCardIDs = createSelector(getActiveRiverMakeUp, (makeUp) => makeUp.cardIDs);\n\nexport const getActiveRiverCards = createSelector(\n\tgetActiveRiverCardIDs,\n\tcards.selectors.getCards,\n\t(makeUpCardIDs, cards) => makeUpCardIDs.map((id) => cards[id])\n);\n\nexport const getRiverShowState = createSelector(getAll, (state: CardRiverState) => state.riverShowState);\n\nexport const riverShowStateIsShow = createSelector(getRiverShowState, (state) => state === \"SHOW\");\n","import React, { useState } from \"react\";\nimport { TextField, TextFieldProps } from \"@material-ui/core\";\nimport focus from \"../../focus\";\nimport { useDispatch } from \"react-redux\";\n\nexport const HybridCardField = ({\n\tstoreValue = \"\",\n\tsaveChanges,\n\tstyle,\n\t...rest\n}: {\n\tstoreValue?: string;\n\tsaveChanges: (value: string) => void;\n\tstyle: any;\n} & TextFieldProps) => {\n\tconst dispatch = useDispatch();\n\tconst [state, setState] = useState({ storeValue, mutableValue: storeValue });\n\n\t// reset if new storeValue, otherwise keep user-mutated value\n\tif (state.storeValue !== storeValue) {\n\t\tsetState({ storeValue, mutableValue: storeValue });\n\t}\n\n\t// need the onChange-pattern, because we want to be able to pre-fill the field from the store\n\treturn (\n\t\t<TextField\n\t\t\tonClick={() => {\n\t\t\t\tdispatch(focus.actions.tryUpdateFocus(\"EDITOR\"));\n\t\t\t}}\n\t\t\tvariant=\"filled\"\n\t\t\tvalue={state.mutableValue}\n\t\t\tonChange={(event) => {\n\t\t\t\tconst submittedValue = (event.target as HTMLTextAreaElement).value;\n\t\t\t\tsetState({ ...state, mutableValue: submittedValue });\n\t\t\t}}\n\t\t\tonBlur={(event: any) => {\n\t\t\t\tsaveChanges(event.target.value);\n\t\t\t}}\n\t\t\tstyle={style}\n\t\t\t{...rest}\n\t\t></TextField>\n\t);\n};\n","import Grid from \"@material-ui/core/Grid\";\nimport React from \"react\";\nimport { HybridCardField } from \"./HybridCardField\";\nimport { CardConfig, QACardContent } from \"../../cards/model\";\nimport { useDispatch } from \"react-redux\";\nimport cards from \"../../cards\";\n\ntype CardProps = { config: CardConfig; riverID: string };\n\nconst NoteCard = ({ config, riverID }: CardProps) => {\n\tconst dispatch = useDispatch();\n\n\treturn (\n\t\t<HybridCardField\n\t\t\tsaveChanges={(value) => {\n\t\t\t\tdispatch(cards.actions.updateCardContent(value, config.cardID, \"NOTE\", \"REPLACE\", riverID));\n\t\t\t}}\n\t\t\tstoreValue={config.content as string}\n\t\t\tfullWidth\n\t\t\tlabel=\"Note\"\n\t\t\tvariant=\"filled\"\n\t\t\tstyle={{ backgroundColor: \"#CBF3F0\" }}\n\t\t\tInputLabelProps={{ style: { color: \"#000000\" } }}\n\t\t></HybridCardField>\n\t);\n};\n\nconst QACard = ({ config, riverID }: CardProps) => {\n\tconst dispatch = useDispatch();\n\n\treturn (\n\t\t<Grid container direction=\"column\" spacing={1}>\n\t\t\t<Grid item>\n\t\t\t\t<HybridCardField\n\t\t\t\t\tsaveChanges={(value) => {\n\t\t\t\t\t\tdispatch(cards.actions.updateCardContent(value, config.cardID, \"Q\", \"REPLACE\", riverID));\n\t\t\t\t\t}}\n\t\t\t\t\tstoreValue={(config.content as QACardContent).q}\n\t\t\t\t\tfullWidth\n\t\t\t\t\tlabel={\"Question\"}\n\t\t\t\t\tvariant=\"filled\"\n\t\t\t\t\tstyle={{ backgroundColor: \"#FFBF69\" }}\n\t\t\t\t\tInputLabelProps={{ style: { color: \"#000000\" } }}\n\t\t\t\t></HybridCardField>\n\t\t\t</Grid>\n\t\t\t<Grid item>\n\t\t\t\t<HybridCardField\n\t\t\t\t\tsaveChanges={(value) => {\n\t\t\t\t\t\tdispatch(cards.actions.updateCardContent(value, config.cardID, \"A\", \"REPLACE\", riverID));\n\t\t\t\t\t}}\n\t\t\t\t\tstoreValue={(config.content as QACardContent).a}\n\t\t\t\t\tfullWidth\n\t\t\t\t\tlabel={\"Answer\"}\n\t\t\t\t\tvariant=\"filled\"\n\t\t\t\t\tstyle={{ backgroundColor: \"#2EC4B6\" }}\n\t\t\t\t\tInputLabelProps={{ style: { color: \"#000000\" } }}\n\t\t\t\t></HybridCardField>\n\t\t\t</Grid>\n\t\t</Grid>\n\t);\n};\n\nexport const Card = ({ config, riverID }: CardProps) => {\n\tswitch (config.type) {\n\t\tcase \"Note\":\n\t\t\treturn <NoteCard config={config} riverID={riverID}></NoteCard>;\n\t\tcase \"Q-A\":\n\t\t\treturn <QACard config={config} riverID={riverID}></QACard>;\n\t}\n};\n","import Accordion from \"@material-ui/core/Accordion\";\nimport AccordionSummary from \"@material-ui/core/AccordionSummary\";\nimport AccordionDetails from \"@material-ui/core/AccordionDetails\";\nimport Grid from \"@material-ui/core/Grid\";\nimport React, { useState, useMemo } from \"react\";\nimport { Divider } from \"@material-ui/core\";\nimport { useSelector } from \"react-redux\";\nimport { getActiveRiverCards, getActiveRiverMakeUpID } from \"../selectors\";\nimport { incrementer } from \"../../../shared/utils\";\nimport { Card } from \"./Card\";\nimport { CardConfig } from \"../../cards/model\";\n\n//TODO: mark cards that are hovered over in the contextmenu, so that we see where the content would end up\n// canvas?\n\n//TODO: selection in CardRiver should stay highlighted when the contextMenu opens?\n\n//TODO: contextMenu as permant element, maybe sidebar? Selected String in ContextMenu to show what was selected?\n\nconst GridDivider = () => (\n\t<Grid item>\n\t\t<Divider></Divider>\n\t</Grid>\n);\n\nconst toCardGridItemsWithDividers = (cards: CardConfig[], riverID: string) => {\n\tconst increment = incrementer();\n\n\treturn cards.reduce((prev, currentCard, index, arr) => {\n\t\tprev.push(\n\t\t\t<Grid item key={increment()}>\n\t\t\t\t<Card config={currentCard} riverID={riverID} key={increment()}></Card>\n\t\t\t</Grid>\n\t\t);\n\n\t\tconst notLastCard = index < arr.length - 1;\n\t\tif (notLastCard) prev.push(<GridDivider key={increment()}></GridDivider>);\n\t\treturn prev;\n\t}, [] as any[]);\n};\n\nexport const CardRiver = () => {\n\tconst [elevation, setElevation] = useState(3);\n\tconst riverID = useSelector(getActiveRiverMakeUpID);\n\tconst riverCards = useSelector(getActiveRiverCards);\n\n\t// this should only re-render if the store values change\n\tconst gridItems = useMemo(() => toCardGridItemsWithDividers(riverCards, riverID), [riverCards, riverID]);\n\n\treturn riverCards ? (\n\t\t<Accordion\n\t\t\tdefaultExpanded={true}\n\t\t\tonMouseEnter={() => {\n\t\t\t\tsetElevation(20);\n\t\t\t}}\n\t\t\tonMouseLeave={() => {\n\t\t\t\tsetElevation(3);\n\t\t\t}}\n\t\t\televation={elevation}\n\t\t>\n\t\t\t<AccordionSummary>CardRiver</AccordionSummary>\n\t\t\t<AccordionDetails>\n\t\t\t\t<Grid container direction=\"column\" spacing={2} justify=\"center\" alignItems=\"stretch\">\n\t\t\t\t\t{gridItems}\n\t\t\t\t</Grid>\n\t\t\t</AccordionDetails>\n\t\t</Accordion>\n\t) : null;\n};\n","import { NAME } from \"./constants\";\n\nexport const RIVER_SHOW_STATE = NAME + \"/RIVER_SHOW_STATE\";\n","import { useState } from \"react\";\nimport SpeakerNotesOutlinedIcon from \"@material-ui/icons/SpeakerNotesOutlined\";\nimport SpeakerNotesTwoToneIcon from \"@material-ui/icons/SpeakerNotesTwoTone\";\nimport React from \"react\";\nimport { IconButton } from \"@material-ui/core\";\nimport { useDispatch } from \"react-redux\";\nimport { toggleRiverShowState } from \"../actions\";\n\nexport const ShowRiverButton = () => {\n\tconst [outlined, setOutlined] = useState(true);\n\tconst dispatch = useDispatch();\n\treturn (\n\t\t<IconButton\n\t\t\ttype=\"button\"\n\t\t\tonClick={() => {\n\t\t\t\tdispatch(toggleRiverShowState());\n\t\t\t\tsetOutlined(!outlined);\n\t\t\t}}\n\t\t>\n\t\t\t{outlined ? (\n\t\t\t\t<SpeakerNotesOutlinedIcon></SpeakerNotesOutlinedIcon>\n\t\t\t) : (\n\t\t\t\t<SpeakerNotesTwoToneIcon></SpeakerNotesTwoToneIcon>\n\t\t\t)}\n\t\t</IconButton>\n\t);\n};\n","import * as t from \"./actionTypes\";\nimport { riverShowStateIsShow } from \"./selectors\";\nimport { Dispatch } from \"redux\";\n\nexport const toggleRiverShowState = () => (dispatch: Dispatch, getState: Function) => {\n\tdispatch({ type: t.RIVER_SHOW_STATE, payload: riverShowStateIsShow(getState()) ? \"HIDE\" : \"SHOW\" });\n};\n","import { CardRiverState, RiverShowState } from \"./model\";\nimport { FinalizedCardPayload } from \"../cards/model\";\nimport cards from \"../cards\";\nimport * as t from \"./actionTypes\";\n\nconst intialState: CardRiverState = {\n\triverMakeUps: {\n\t\tRiverMakeUp1: {\n\t\t\triverID: \"RiverMakeUp1\",\n\t\t\tcardIDs: [\"2\", \"0\", \"1\"],\n\t\t\tactive: true,\n\t\t},\n\t},\n\tactiveRiverMakeUpID: \"RiverMakeUp1\",\n\tlastRiverIDNumber: 1,\n\triverShowState: \"SHOW\",\n};\n\nconst cardRiverState = (\n\tstate = intialState,\n\t{ type, payload }: { type: string; payload: FinalizedCardPayload | RiverShowState }\n) => {\n\tlet riverMakeUp;\n\tlet riverMakeUps;\n\tswitch (type) {\n\t\tcase cards.actionTypes.CARD_PUSH:\n\t\t\triverMakeUp = {\n\t\t\t\t...state.riverMakeUps[(payload as FinalizedCardPayload).riverID],\n\t\t\t\tcardIDs: [\n\t\t\t\t\t...state.riverMakeUps[(payload as FinalizedCardPayload).riverID].cardIDs,\n\t\t\t\t\t(payload as FinalizedCardPayload).card.cardID,\n\t\t\t\t],\n\t\t\t};\n\t\t\triverMakeUps = { ...state.riverMakeUps };\n\t\t\triverMakeUps[(payload as FinalizedCardPayload).riverID] = riverMakeUp;\n\n\t\t\treturn { ...state, riverMakeUps: riverMakeUps };\n\t\tcase t.RIVER_SHOW_STATE:\n\t\t\treturn { ...state, riverShowState: payload as RiverShowState };\n\t\tdefault:\n\t\t\treturn state;\n\t}\n};\n\nexport default cardRiverState;\n","import * as constants from \"./constants\";\nimport * as components from \"./components\";\nimport reducer from \"./reducer\";\nimport * as selectors from \"./selectors\";\n\nexport default { constants, components, reducer, selectors };\n","import { NAME } from \"./constants\";\nimport { createSelector } from \"reselect\";\nimport { CreationData } from \"./model\";\nimport select from \"../select\";\nimport river from \"../river\";\n\nexport const getAll = (state: any) => state[NAME];\n\nexport const getContextMenuState = createSelector(getAll, (state: CreationData) => state.open);\n\nexport const getContextMenuRef = createSelector(getAll, (state: CreationData) => state.menuRef);\n\nexport const getContextMenuQARefs = createSelector(getAll, (state: CreationData) => state.qaRefs);\n\nexport const getContextMenuInitData = createSelector(\n\tselect.selectors.getCurrentBoundingRectGroup,\n\tgetContextMenuState,\n\tgetContextMenuRef,\n\tgetContextMenuQARefs,\n\triver.selectors.getActiveRiverCards,\n\t(boundingRectGroup, state, menuRef, qaRefs, riverCards) => {\n\t\treturn { boundingRectGroup, state, menuRef, qaRefs, riverCards };\n\t}\n);\n","import React, { RefObject } from \"react\";\nimport Menu from \"@material-ui/core/Menu\";\nimport NestedMenuItem from \"material-ui-nested-menu-item\";\nimport { MenuItem, Divider } from \"@material-ui/core\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { getContextMenuInitData } from \"../selectors\";\nimport { triggerSelectionGrab } from \"../actions\";\nimport { incrementer } from \"../../../shared/utils\";\nimport river from \"../../river\";\nimport { CardConfig, CardType, CreationType } from \"../../cards/model\";\nimport analyze from \"../../analyze\";\n\nconst NewQACard = ({ onClick }: any) => <MenuItem onClick={onClick}>New: Q-A</MenuItem>;\nconst NewNoteCard = ({ onClick }: any) => <MenuItem onClick={onClick}>New: Note</MenuItem>;\n\nconst SingleOptionItem = ({ cardConfig, dispatchRiver }: { cardConfig: CardConfig; dispatchRiver: dispatchRiver }) => (\n\t<MenuItem\n\t\tonClick={() => {\n\t\t\tdispatchRiver(cardConfig.type, \"NOTE\", cardConfig.cardID);\n\t\t}}\n\t>\n\t\t{cardConfig.type}\n\t</MenuItem>\n);\n\ntype dispatchRiver = (type: CardType, creationType: CreationType, cardID?: string | undefined) => void;\n\nconst QAOptionItem = ({\n\tcardConfig,\n\tdispatchRiver,\n\tqaRef,\n}: {\n\tcardConfig: CardConfig;\n\tdispatchRiver: dispatchRiver;\n\tqaRef: RefObject<any> | undefined;\n}) => (\n\t<NestedMenuItem label=\"Q-A\" parentMenuOpen={true}>\n\t\t<MenuItem\n\t\t\tref={qaRef}\n\t\t\tonClick={() => {\n\t\t\t\tdispatchRiver(\"Q-A\", \"Q\", cardConfig.cardID);\n\t\t\t}}\n\t\t>\n\t\t\tQ\n\t\t</MenuItem>\n\t\t<MenuItem\n\t\t\tonClick={() => {\n\t\t\t\tdispatchRiver(\"Q-A\", \"A\", cardConfig.cardID);\n\t\t\t}}\n\t\t>\n\t\t\tA\n\t\t</MenuItem>\n\t</NestedMenuItem>\n);\n\nconst CardConfigItem = ({\n\tcardConfig,\n\tdispatchRiver,\n\tqaRef,\n}: {\n\tcardConfig: CardConfig;\n\tdispatchRiver: dispatchRiver;\n\tqaRef?: RefObject<any>;\n}) => {\n\tswitch (cardConfig.type) {\n\t\tcase \"Q-A\":\n\t\t\treturn <QAOptionItem cardConfig={cardConfig} dispatchRiver={dispatchRiver} qaRef={qaRef}></QAOptionItem>;\n\t\tdefault:\n\t\t\treturn <SingleOptionItem cardConfig={cardConfig} dispatchRiver={dispatchRiver}></SingleOptionItem>;\n\t}\n};\n\nconst partialRiverDispatch = (riverID: string, dispatch: any) => {\n\treturn (type: CardType, creationType: CreationType, cardID?: string) => {\n\t\tdispatch(triggerSelectionGrab(riverID, type, creationType, cardID));\n\t};\n};\n\nfunction ContextMenu({\n\tboundingRectGroup,\n\tstate,\n\tmenuRef,\n\tqaRefs,\n\triverCards,\n}: {\n\tboundingRectGroup: DOMRect[];\n\tstate: boolean;\n\tmenuRef: RefObject<any>;\n\tqaRefs: RefObject<any>[];\n\triverCards: CardConfig[];\n}) {\n\tconst dispatch = useDispatch();\n\tconst riverID = useSelector(river.selectors.getActiveRiverMakeUpID);\n\tconst dispatchRiverOne = partialRiverDispatch(riverID, dispatch);\n\n\tconst increment = incrementer();\n\tconst qaRefIndex = incrementer();\n\n\t// need to check for state before rendering MenuItems,\n\t// otherwise it shows up for a split-second when switching the menu off after adding to the river\n\t// weird Race Condition even if I dispatch closeContextMenu first?\n\treturn (\n\t\t<Menu\n\t\t\tref={menuRef}\n\t\t\tkeepMounted\n\t\t\topen={state}\n\t\t\tanchorReference=\"anchorPosition\"\n\t\t\tanchorPosition={state ? { top: boundingRectGroup[0].y, left: boundingRectGroup[0].x } : undefined}\n\t\t>\n\t\t\t{state &&\n\t\t\t\triverCards.map((cardConfig) => (\n\t\t\t\t\t<CardConfigItem\n\t\t\t\t\t\tcardConfig={cardConfig}\n\t\t\t\t\t\tdispatchRiver={dispatchRiverOne}\n\t\t\t\t\t\tkey={increment()}\n\t\t\t\t\t\tqaRef={cardConfig.type === \"Q-A\" ? qaRefs[qaRefIndex()] : undefined}\n\t\t\t\t\t></CardConfigItem>\n\t\t\t\t))}\n\t\t\t{state && riverCards.length > 0 && <Divider />}\n\n\t\t\t<NewQACard\n\t\t\t\tonClick={() => {\n\t\t\t\t\tdispatchRiverOne(\"Q-A\", \"Q\");\n\t\t\t\t}}\n\t\t\t></NewQACard>\n\t\t\t<NewNoteCard\n\t\t\t\tonClick={() => {\n\t\t\t\t\tdispatchRiverOne(\"Note\", \"NOTE\");\n\t\t\t\t}}\n\t\t\t></NewNoteCard>\n\t\t</Menu>\n\t);\n}\n\nexport const ContextMenuContainer = analyze.components.DataGuardHOC(ContextMenu, getContextMenuInitData);\n","import { getContextMenuRef, getContextMenuQARefs } from \"./selectors\";\n\n// the root div for the menu invisibly covers the whole screen\n// the actual div that is visible is this\nconst baseContextMenuSelector = \"div.MuiPaper-root\";\n\nexport const contextMenuContainsTargetNode = (state: any, event: Event) => {\n\tconst menuRef = getContextMenuRef(state).current;\n\n\t// the nested items are rendered under a different menu\n\t// the current api does not allow access\n\t// so the qa-refs refer to the Q-button\n\t// we check the click against his parent,\n\t// which is the div that contains the Q and A buttons\n\tconst qaRefs = getContextMenuQARefs(state)\n\t\t.map((refObject) => refObject.current)\n\t\t.filter((cur) => !!cur)\n\t\t.map((ref) => ref.parentNode);\n\n\tconst target = event.target as Node;\n\n\tif (menuRef?.querySelector(baseContextMenuSelector)?.contains(target)) return true;\n\n\tfor (const qaRef of qaRefs) {\n\t\tif (qaRef.contains(target)) return true;\n\t}\n\n\treturn false;\n};\n","import * as actions from \"./actions\";\nimport * as constants from \"./constants\";\nimport * as actionTypes from \"./actionTypes\";\nimport reducer from \"./reducer\";\nimport * as selectors from \"./selectors\";\nimport * as components from \"./components\";\nimport * as utils from \"./utils\";\n\nexport default { actions, actionTypes, constants, components, reducer, selectors, utils };\n","import { Dispatch } from \"redux\";\nimport focus from \"../../focus\";\nimport display from \"../../display\";\nimport select from \"../../select\";\nimport creation from \"../../creation\";\nimport { UserFocus } from \"../../focus/model\";\n\ntype KeyActionMap = { [key: string]: any };\n\ntype KeyEventDispatcher = (event: KeyboardEvent, dispatch: any, state?: any) => void;\n\nconst keyEventDispatcher = (keyMap: KeyActionMap) => (event: KeyboardEvent, dispatch: any) => {\n\tconst action = keyMap[event.key];\n\tif (action) {\n\t\tevent.preventDefault();\n\t\tdispatch(action);\n\t}\n};\n\nconst pageControlKeyMap: KeyActionMap = {\n\tArrowLeft: display.actions.previousPage(),\n\tArrowRight: display.actions.nextPage(),\n};\n\nconst sectionControlKeyMap: KeyActionMap = {\n\tArrowDown: select.actions.updateSection(\"DOWN\"),\n\tArrowUp: select.actions.updateSection(\"UP\"),\n\t\" \": select.actions.toggleSectionMovementState(),\n};\n\nconst selectionControlKeyMap: KeyActionMap = {\n\ta: select.actions.updateSelection(\"PLUS_WORD\"),\n\td: select.actions.updateSelection(\"MINUS_WORD\"),\n\tw: select.actions.updateSelection(\"PLUS_SPAN\"),\n\ts: select.actions.updateSelection(\"MINUS_SPAN\"),\n};\n\nconst contextMenuControlKeyMap: KeyActionMap = {\n\tt: creation.actions.toggleContextMenu(),\n};\n\nconst selectionFocusSectionKeyMap = {\n\t...pageControlKeyMap,\n\t...contextMenuControlKeyMap,\n\t...sectionControlKeyMap,\n\t...selectionControlKeyMap,\n};\nconst selectionFocusSectionDispatcher = keyEventDispatcher(selectionFocusSectionKeyMap);\n\nconst selectionFocusMouseKeyMap = {\n\t...pageControlKeyMap,\n\t...contextMenuControlKeyMap,\n};\nconst selectionFocusMouseDispatcher = keyEventDispatcher(selectionFocusMouseKeyMap);\n\nconst selectionFocusDispatcher: KeyEventDispatcher = (event, dispatch, state) => {\n\tif (select.selectors.selectionTypeIsSection(state)) {\n\t\tselectionFocusSectionDispatcher(event, dispatch);\n\t} else {\n\t\tselectionFocusMouseDispatcher(event, dispatch);\n\t}\n};\n\nconst contextMenuFocusKeyMap = { ...contextMenuControlKeyMap };\nconst contextMenuFocusDispatcher = keyEventDispatcher(contextMenuFocusKeyMap);\n\nconst focusDispatcherMap: { [focus in UserFocus]: KeyEventDispatcher } = {\n\tSELECTION: selectionFocusDispatcher,\n\tCONTEXT_MENU: contextMenuFocusDispatcher,\n\tEDITOR: (event, dispatch) => {},\n\tCONTROL: (event, dispatch) => {},\n};\n\nexport const keyDownControl = (event: KeyboardEvent) => {\n\treturn (dispatch: Dispatch | any, getState: Function) => {\n\t\tconst state = getState();\n\t\tconst userFocus = focus.selectors.getFocus(state);\n\t\tconst dispatcher = focusDispatcherMap[userFocus];\n\n\t\tdispatcher(event, dispatch, state);\n\t};\n};\n","import { connect } from \"react-redux\";\nimport { useEventListener } from \"../hooks/useEventListener\";\nimport { keyDownControl } from \"../services/keyboardControl\";\nimport { mouseDownControl, mouseUpControl } from \"../services/mouseControl\";\n\nfunction Control({\n\tkeyDownControl,\n\tmouseDownControl,\n\tmouseUpControl,\n}: {\n\tkeyDownControl: (event: KeyboardEvent) => void;\n\tmouseDownControl: (event: MouseEvent) => void;\n\tmouseUpControl: (event: MouseEvent) => void;\n}) {\n\tuseEventListener(\"keydown\", keyDownControl);\n\tuseEventListener(\"mousedown\", mouseDownControl);\n\tuseEventListener(\"mouseup\", mouseUpControl);\n\treturn null;\n}\n\nexport const ControlContainer = connect(\n\t() => {\n\t\treturn {};\n\t},\n\t{\n\t\tkeyDownControl,\n\t\tmouseDownControl,\n\t\tmouseUpControl,\n\t}\n)(Control);\n","import creation from \"../../creation\";\nimport select from \"../../select\";\nimport focus from \"../../focus\";\n\nexport const mouseDownControl = (event: MouseEvent) => {\n\treturn (dispatch: any, getState: Function) => {\n\t\tconst state = getState();\n\t\tconst contextMenuState = creation.selectors.getContextMenuState(state);\n\t\tif (contextMenuState) {\n\t\t\tconst clickOutSideOfMenu = !creation.utils.contextMenuContainsTargetNode(state, event);\n\n\t\t\tif (clickOutSideOfMenu) {\n\t\t\t\tdispatch(creation.actions.toggleContextMenu());\n\t\t\t}\n\t\t}\n\t};\n};\n\nexport const mouseUpControl = (event: MouseEvent) => {\n\treturn (dispatch: any, getState: Function) => {\n\t\tconst selection = document.getSelection();\n\t\tif (selection) {\n\t\t\tconst selectedStr = selection.toString();\n\t\t\tif (selectedStr !== \"\") {\n\t\t\t\tconst state = getState();\n\t\t\t\tconst userFocus = focus.selectors.getFocus(state);\n\t\t\t\tif (userFocus === \"SELECTION\" || userFocus === \"EDITOR\") {\n\t\t\t\t\tdispatch(select.actions.updateManuallySelectedString(selectedStr));\n\t\t\t\t\tdispatch(creation.actions.openContextMenu());\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n};\n","import display from \"../../display\";\nimport river from \"../../river\";\nimport React from \"react\";\nimport { AppBar, Toolbar } from \"@material-ui/core\";\nimport { useSelector } from \"react-redux\";\nimport select from \"../../select\";\n\nexport const ControlBar = () => {\n\tconst totalPages = useSelector(display.selectors.getTotalPages);\n\n\treturn (\n\t\t<AppBar position=\"static\">\n\t\t\t<Toolbar variant=\"dense\">\n\t\t\t\t<river.components.ShowRiverButton></river.components.ShowRiverButton>\n\t\t\t\t{totalPages && <display.components.PageChooser></display.components.PageChooser>}\n\t\t\t\t{totalPages && <display.components.PreviousButton></display.components.PreviousButton>}\n\t\t\t\t{totalPages && <display.components.NextButton></display.components.NextButton>}\n\t\t\t\t{totalPages && <display.components.ShowMaterialButton></display.components.ShowMaterialButton>}\n\t\t\t\t{totalPages && <select.components.SelectionTypeButton></select.components.SelectionTypeButton>}\n\t\t\t</Toolbar>\n\t\t</AppBar>\n\t);\n};\n","import * as components from \"./components\";\n\nexport default { components };\n","import React, { useState } from \"react\";\nimport Grid from \"@material-ui/core/Grid\";\nimport { withSize } from \"react-sizeme\";\nimport Paper from \"@material-ui/core/Paper\";\nimport select from \"../modules/select\";\nimport display from \"../modules/display\";\nimport control from \"../modules/control\";\nimport river from \"../modules/river\";\nimport creation from \"../modules/creation\";\nimport focus from \"../modules/focus\";\nimport { Divider } from \"@material-ui/core\";\nimport { useDispatch, useSelector } from \"react-redux\";\n\nconst ReaderSceneRiverColumn = () => {\n\treturn (\n\t\t<Grid\n\t\t\titem\n\t\t\tstyle={{\n\t\t\t\twidth: \"38%\",\n\t\t\t}}\n\t\t>\n\t\t\t<Paper elevation={3}>\n\t\t\t\t<river.components.CardRiver></river.components.CardRiver>\n\t\t\t</Paper>\n\t\t</Grid>\n\t);\n};\n\nfunction ReaderSceneMaterialColumn({ size }: any) {\n\tconst dispatch = useDispatch();\n\n\tconst [elevation, setElevation] = useState(3);\n\n\treturn (\n\t\t<Grid\n\t\t\titem\n\t\t\tstyle={{\n\t\t\t\twidth: \"60%\",\n\t\t\t}}\n\t\t\tonMouseEnter={() => {\n\t\t\t\tdispatch(focus.actions.tryUpdateFocus(\"SELECTION\"));\n\t\t\t\tsetElevation(20);\n\t\t\t}}\n\t\t\tonMouseLeave={() => {\n\t\t\t\tsetElevation(3);\n\t\t\t}}\n\t\t>\n\t\t\t<Paper elevation={elevation}>\n\t\t\t\t<Divider></Divider>\n\t\t\t\t<select.components.DocumentCanvasContainer parentSize={size}></select.components.DocumentCanvasContainer>\n\t\t\t\t<display.components.PDFDocumentContainer parentSize={size}></display.components.PDFDocumentContainer>\n\t\t\t\t<display.components.PDFUploadContainer></display.components.PDFUploadContainer>\n\t\t\t</Paper>\n\t\t</Grid>\n\t);\n}\n\nconst ReaderSceneMaterialColumnWithSize = withSize({ monitorHeight: true, noPlaceholder: true })(\n\tReaderSceneMaterialColumn\n);\n\nexport function ReaderScene() {\n\tconst dispatch = useDispatch();\n\n\t// TODO: use memoize to make re-showing of pdf faster, this is wasteful right now\n\tconst showMaterial = useSelector(display.selectors.displayStatusIsShow);\n\tconst showRiver = useSelector(river.selectors.riverShowStateIsShow);\n\treturn (\n\t\t<div>\n\t\t\t<control.components.ControlContainer></control.components.ControlContainer>\n\t\t\t<Grid container justify=\"center\" direction=\"column\" alignItems=\"stretch\" spacing={1}>\n\t\t\t\t<Grid\n\t\t\t\t\titem\n\t\t\t\t\tonMouseEnter={() => {\n\t\t\t\t\t\tdispatch(focus.actions.tryUpdateFocus(\"CONTROL\"));\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<control.components.ControlBar></control.components.ControlBar>\n\t\t\t\t</Grid>\n\n\t\t\t\t<Grid item>\n\t\t\t\t\t<Grid container justify=\"space-around\" direction=\"row\" alignItems=\"stretch\">\n\t\t\t\t\t\t{showRiver && <ReaderSceneRiverColumn></ReaderSceneRiverColumn>}\n\t\t\t\t\t\t{showMaterial && <ReaderSceneMaterialColumnWithSize></ReaderSceneMaterialColumnWithSize>}\n\t\t\t\t\t</Grid>\n\t\t\t\t</Grid>\n\t\t\t</Grid>\n\t\t\t<creation.components.ContextMenuContainer></creation.components.ContextMenuContainer>\n\t\t</div>\n\t);\n}\n","import { createStore } from \"redux\";\nimport { applyMiddleware } from \"redux\";\nimport { composeWithDevTools } from \"redux-devtools-extension\";\nimport thunk from \"redux-thunk\";\nimport { combineReducers } from \"redux\";\nimport focus from \"./modules/focus\";\nimport creation from \"./modules/creation\";\nimport river from \"./modules/river\";\nimport analyze from \"./modules/analyze\";\nimport display from \"./modules/display\";\nimport select from \"./modules/select\";\nimport cards from \"./modules/cards\";\n\nconst rootReducer = combineReducers({\n\t[focus.constants.NAME]: focus.reducer,\n\t[creation.constants.NAME]: creation.reducer,\n\t[river.constants.NAME]: river.reducer,\n\t[analyze.constants.NAME]: analyze.reducer,\n\t[display.constants.NAME]: display.reducer,\n\t[select.constants.NAME]: select.reducer,\n\t[cards.constants.NAME]: cards.reducer,\n});\n\nconst stateSanitizer = (state: any) => {\n\tlet newState = state.displayData.pdf\n\t\t? { ...state, displayData: { ...state.displayData, pdf: \"PDF_FILE_IS_HERE\" } }\n\t\t: state;\n\treturn newState.materialData\n\t\t? {\n\t\t\t\t...newState,\n\t\t\t\tmaterialData: \"MATERIAL_DATA_IS_HERE\",\n\t\t  }\n\t\t: newState;\n};\n\nconst composeEnhancers = composeWithDevTools({ stateSanitizer });\nconst enhancer = composeEnhancers(applyMiddleware(thunk));\n\nexport const store = createStore(rootReducer, enhancer);\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { ReaderScene } from \"./scenes/ReaderScene\";\nimport { Provider } from \"react-redux\";\nimport { store } from \"./store\";\n\nReactDOM.render(\n\t<React.StrictMode>\n\t\t<Provider store={store}>\n\t\t\t<ReaderScene></ReaderScene>\n\t\t</Provider>\n\t</React.StrictMode>,\n\tdocument.getElementById(\"root\")\n);\n","function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = function() { return []; };\nwebpackEmptyContext.resolve = webpackEmptyContext;\nmodule.exports = webpackEmptyContext;\nwebpackEmptyContext.id = 73;"],"sourceRoot":""}